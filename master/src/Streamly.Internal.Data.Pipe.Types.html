<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-cpp">#include &quot;inline.hs&quot;
</span><span>
</span><span id="line-3"></span><span class="hs-comment">-- |</span><span>
</span><span id="line-4"></span><span class="hs-comment">-- Module      : Streamly.Internal.Data.Pipe.Types</span><span>
</span><span id="line-5"></span><span class="hs-comment">-- Copyright   : (c) 2019 Composewell Technologies</span><span>
</span><span id="line-6"></span><span class="hs-comment">-- License     : BSD3</span><span>
</span><span id="line-7"></span><span class="hs-comment">-- Maintainer  : streamly@composewell.com</span><span>
</span><span id="line-8"></span><span class="hs-comment">-- Stability   : experimental</span><span>
</span><span id="line-9"></span><span class="hs-comment">-- Portability : GHC</span><span>
</span><span id="line-10"></span><span>
</span><span id="line-11"></span><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Streamly.Internal.Data.Pipe.Types</span><span>
</span><span id="line-12"></span><span>    </span><span class="hs-special">(</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Pipe.Types.html#Step"><span class="hs-identifier">Step</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-13"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Pipe.Types.html#Pipe"><span class="hs-identifier">Pipe</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-14"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Pipe.Types.html#PipeState"><span class="hs-identifier">PipeState</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span>
</span><span id="line-15"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Pipe.Types.html#zipWith"><span class="hs-identifier">zipWith</span></a></span><span>
</span><span id="line-16"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Pipe.Types.html#tee"><span class="hs-identifier">tee</span></a></span><span>
</span><span id="line-17"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Pipe.Types.html#map"><span class="hs-identifier">map</span></a></span><span>
</span><span id="line-18"></span><span>    </span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Pipe.Types.html#compose"><span class="hs-identifier">compose</span></a></span><span>
</span><span id="line-19"></span><span>    </span><span class="hs-special">)</span><span>
</span><span id="line-20"></span><span class="hs-keyword">where</span><span>
</span><span id="line-21"></span><span>
</span><span id="line-22"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Arrow</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Arrow</span></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-23"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Control.Category</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">Category</span></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-24"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Data.Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">isJust</span></span><span class="hs-special">)</span><span class="hs-cpp">
#if __GLASGOW_HASKELL__ &lt; 808
</span><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.Semigroup</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">Semigroup</span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-cpp">
#endif
</span><span class="hs-keyword">import</span><span> </span><span class="annot"><span class="hs-identifier">Prelude</span></span><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier">zipWith</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">map</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">id</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">unzip</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier">null</span></span><span class="hs-special">)</span><span>
</span><span id="line-29"></span><span class="hs-keyword">import</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Tuple.Strict.html"><span class="hs-identifier">Streamly.Internal.Data.Tuple.Strict</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Streamly.Internal.Data.Tuple.Strict.html#Tuple%27"><span class="hs-identifier">Tuple'</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Tuple.Strict.html#Tuple3%27"><span class="hs-identifier">Tuple3'</span></a></span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-30"></span><span>
</span><span id="line-31"></span><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="annot"><span class="hs-identifier">Prelude</span></span><span>
</span><span id="line-32"></span><span>
</span><span id="line-33"></span><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><span id="line-34"></span><span class="hs-comment">-- Pipes</span><span>
</span><span id="line-35"></span><span class="hs-comment">------------------------------------------------------------------------------</span><span>
</span><span id="line-36"></span><span>
</span><span id="line-37"></span><span class="hs-comment">-- A scan is a much simpler version of pipes. A scan always produces an output</span><span>
</span><span id="line-38"></span><span class="hs-comment">-- on an input whereas a pipe does not necessarily produce an output on an</span><span>
</span><span id="line-39"></span><span class="hs-comment">-- input, it might consume multiple inputs before producing an output. That way</span><span>
</span><span id="line-40"></span><span class="hs-comment">-- it can implement filtering. Similarly, it can produce more than one output</span><span>
</span><span id="line-41"></span><span class="hs-comment">-- on an single input.</span><span>
</span><span id="line-42"></span><span class="hs-comment">--</span><span>
</span><span id="line-43"></span><span class="hs-comment">-- Therefore when two pipes are composed in parallel formation, one may run</span><span>
</span><span id="line-44"></span><span class="hs-comment">-- slower or faster than the other. If all of them are being fed from the same</span><span>
</span><span id="line-45"></span><span class="hs-comment">-- source, we may have to buffer the input to match the speeds. In case of</span><span>
</span><span id="line-46"></span><span class="hs-comment">-- scans we do not have that problem.</span><span>
</span><span id="line-47"></span><span class="hs-comment">--</span><span>
</span><span id="line-48"></span><span class="hs-comment">-- We may also need a &quot;Stop&quot; constructor to indicate that we are not generating</span><span>
</span><span id="line-49"></span><span class="hs-comment">-- any more values and we can have a &quot;Done&quot; constructor to indicate that we are</span><span>
</span><span id="line-50"></span><span class="hs-comment">-- not consuming any more values. Similarly we can have a stop with error or</span><span>
</span><span id="line-51"></span><span class="hs-comment">-- exception and a done with error or leftover values.</span><span>
</span><span id="line-52"></span><span class="hs-comment">--</span><span>
</span><span id="line-53"></span><span class="hs-comment">-- In generator mode, Continue means no output/continue. In fold mode Continue means</span><span>
</span><span id="line-54"></span><span class="hs-comment">-- need more input to produce result. we can perhaps call it Continue instead.</span><span>
</span><span id="line-55"></span><span class="hs-comment">--</span><span>
</span><span id="line-56"></span><span class="hs-keyword">data</span><span> </span><span id="Step"><span class="annot"><a href="Streamly.Internal.Data.Pipe.Types.html#Step"><span class="hs-identifier hs-var">Step</span></a></span></span><span> </span><span id="local-6989586621679364603"><span class="annot"><a href="#local-6989586621679364603"><span class="hs-identifier hs-type">s</span></a></span></span><span> </span><span id="local-6989586621679364604"><span class="annot"><a href="#local-6989586621679364604"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-57"></span><span>      </span><span id="Yield"><span class="annot"><a href="Streamly.Internal.Data.Pipe.Types.html#Yield"><span class="hs-identifier hs-var">Yield</span></a></span></span><span> </span><span class="annot"><a href="#local-6989586621679364604"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679364603"><span class="hs-identifier hs-type">s</span></a></span><span>
</span><span id="line-58"></span><span>    </span><span class="hs-glyph">|</span><span> </span><span id="Continue"><span class="annot"><a href="Streamly.Internal.Data.Pipe.Types.html#Continue"><span class="hs-identifier hs-var">Continue</span></a></span></span><span> </span><span class="annot"><a href="#local-6989586621679364603"><span class="hs-identifier hs-type">s</span></a></span><span>
</span><span id="line-59"></span><span>
</span><span id="line-60"></span><span class="hs-comment">-- | Represents a stateful transformation over an input stream of values of</span><span>
</span><span id="line-61"></span><span class="hs-comment">-- type @a@ to outputs of type @b@ in 'Monad' @m@.</span><span>
</span><span id="line-62"></span><span>
</span><span id="line-63"></span><span class="hs-comment">-- A pipe uses a consume function and a produce function. It can switch from</span><span>
</span><span id="line-64"></span><span class="hs-comment">-- consume/fold mode to a produce/source mode. The first step function is a</span><span>
</span><span id="line-65"></span><span class="hs-comment">-- fold function while the seocnd one is a stream generator function.</span><span>
</span><span id="line-66"></span><span class="hs-comment">--</span><span>
</span><span id="line-67"></span><span class="hs-comment">-- We can upgrade a stream or a fold into a pipe. However, streams are more</span><span>
</span><span id="line-68"></span><span class="hs-comment">-- efficient in generation and folds are more efficient in consumption.</span><span>
</span><span id="line-69"></span><span class="hs-comment">--</span><span>
</span><span id="line-70"></span><span class="hs-comment">-- For pure transformation we can have a 'Scan' type. A Scan would be more</span><span>
</span><span id="line-71"></span><span class="hs-comment">-- efficient in zipping whereas pipes are useful for merging and zipping where</span><span>
</span><span id="line-72"></span><span class="hs-comment">-- we know buffering can occur. A Scan type can be upgraded to a pipe.</span><span>
</span><span id="line-73"></span><span class="hs-comment">--</span><span>
</span><span id="line-74"></span><span class="hs-comment">-- XXX In general the starting state could either be for generation or for</span><span>
</span><span id="line-75"></span><span class="hs-comment">-- consumption. Currently we are only starting with a consumption state.</span><span>
</span><span id="line-76"></span><span class="hs-comment">--</span><span>
</span><span id="line-77"></span><span class="hs-comment">-- An explicit either type for better readability of the code</span><span>
</span><span id="line-78"></span><span class="hs-keyword">data</span><span> </span><span id="PipeState"><span class="annot"><a href="Streamly.Internal.Data.Pipe.Types.html#PipeState"><span class="hs-identifier hs-var">PipeState</span></a></span></span><span> </span><span id="local-6989586621679364577"><span class="annot"><a href="#local-6989586621679364577"><span class="hs-identifier hs-type">s1</span></a></span></span><span> </span><span id="local-6989586621679364576"><span class="annot"><a href="#local-6989586621679364576"><span class="hs-identifier hs-type">s2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Consume"><span class="annot"><a href="Streamly.Internal.Data.Pipe.Types.html#Consume"><span class="hs-identifier hs-var">Consume</span></a></span></span><span> </span><span class="annot"><a href="#local-6989586621679364577"><span class="hs-identifier hs-type">s1</span></a></span><span> </span><span class="hs-glyph">|</span><span> </span><span id="Produce"><span class="annot"><a href="Streamly.Internal.Data.Pipe.Types.html#Produce"><span class="hs-identifier hs-var">Produce</span></a></span></span><span> </span><span class="annot"><a href="#local-6989586621679364576"><span class="hs-identifier hs-type">s2</span></a></span><span>
</span><span id="line-79"></span><span>
</span><span id="line-80"></span><span id="local-6989586621679364540"><span id="local-6989586621679364541"><span class="annot"><a href="Streamly.Internal.Data.Pipe.Types.html#isProduce"><span class="hs-identifier hs-type">isProduce</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Pipe.Types.html#PipeState"><span class="hs-identifier hs-type">PipeState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679364541"><span class="hs-identifier hs-type">s1</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679364540"><span class="hs-identifier hs-type">s2</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span></span></span><span>
</span><span id="line-81"></span><span id="isProduce"><span class="annot"><span class="annottext">isProduce :: PipeState s1 s2 -&gt; Bool
</span><a href="Streamly.Internal.Data.Pipe.Types.html#isProduce"><span class="hs-identifier hs-var hs-var">isProduce</span></a></span></span><span> </span><span id="local-6989586621679364378"><span class="annot"><span class="annottext">s :: PipeState s1 s2
</span><a href="#local-6989586621679364378"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-82"></span><span>    </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">PipeState s1 s2
</span><a href="#local-6989586621679364378"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-83"></span><span>        </span><span class="annot"><a href="Streamly.Internal.Data.Pipe.Types.html#Produce"><span class="hs-identifier hs-type">Produce</span></a></span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-84"></span><span>        </span><span class="annot"><a href="Streamly.Internal.Data.Pipe.Types.html#Consume"><span class="hs-identifier hs-type">Consume</span></a></span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-85"></span><span>
</span><span id="line-86"></span><span class="hs-keyword">data</span><span> </span><span id="Pipe"><span class="annot"><a href="Streamly.Internal.Data.Pipe.Types.html#Pipe"><span class="hs-identifier hs-var">Pipe</span></a></span></span><span> </span><span id="local-6989586621679364612"><span class="annot"><a href="#local-6989586621679364612"><span class="hs-identifier hs-type">m</span></a></span></span><span> </span><span id="local-6989586621679364613"><span class="annot"><a href="#local-6989586621679364613"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span id="local-6989586621679364610"><span class="annot"><a href="#local-6989586621679364610"><span class="hs-identifier hs-type">b</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-87"></span><span>  </span><span class="hs-keyword">forall</span><span> </span><span id="local-6989586621679364614"><span class="annot"><a href="#local-6989586621679364614"><span class="hs-identifier hs-type">s1</span></a></span></span><span> </span><span id="local-6989586621679364611"><span class="annot"><a href="#local-6989586621679364611"><span class="hs-identifier hs-type">s2</span></a></span></span><span class="hs-operator">.</span><span> </span><span id="Pipe"><span class="annot"><a href="Streamly.Internal.Data.Pipe.Types.html#Pipe"><span class="hs-identifier hs-var">Pipe</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679364614"><span class="hs-identifier hs-type">s1</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679364613"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679364612"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Streamly.Internal.Data.Pipe.Types.html#Step"><span class="hs-identifier hs-type">Step</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Streamly.Internal.Data.Pipe.Types.html#PipeState"><span class="hs-identifier hs-type">PipeState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679364614"><span class="hs-identifier hs-type">s1</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679364611"><span class="hs-identifier hs-type">s2</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679364610"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-88"></span><span>                     </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679364611"><span class="hs-identifier hs-type">s2</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679364612"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Streamly.Internal.Data.Pipe.Types.html#Step"><span class="hs-identifier hs-type">Step</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Streamly.Internal.Data.Pipe.Types.html#PipeState"><span class="hs-identifier hs-type">PipeState</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679364614"><span class="hs-identifier hs-type">s1</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679364611"><span class="hs-identifier hs-type">s2</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679364610"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><a href="#local-6989586621679364614"><span class="hs-identifier hs-type">s1</span></a></span><span>
</span><span id="line-89"></span><span>
</span><span id="line-90"></span><span id="local-6989586621679364375"><span id="local-6989586621679364376"><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679364372"><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621679364376"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Functor</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Streamly.Internal.Data.Pipe.Types.html#Pipe"><span class="hs-identifier hs-type">Pipe</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679364376"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679364375"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-91"></span><span>    </span><span class="hs-pragma">{-# INLINE_NORMAL fmap #-}</span><span>
</span><span id="line-92"></span><span>    </span><span id="local-6989586621679364370"><span class="annot"><span class="annottext">fmap :: (a -&gt; b) -&gt; Pipe m a a -&gt; Pipe m a b
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">fmap</span></span></span><span> </span><span id="local-6989586621679364369"><span class="annot"><span class="annottext">f :: a -&gt; b
</span><a href="#local-6989586621679364369"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Streamly.Internal.Data.Pipe.Types.html#Pipe"><span class="hs-identifier hs-type">Pipe</span></a></span><span> </span><span id="local-6989586621679364368"><span class="annot"><span class="annottext">consume :: s1 -&gt; a -&gt; m (Step (PipeState s1 s2) a)
</span><a href="#local-6989586621679364368"><span class="hs-identifier hs-var">consume</span></a></span></span><span> </span><span id="local-6989586621679364367"><span class="annot"><span class="annottext">produce :: s2 -&gt; m (Step (PipeState s1 s2) a)
</span><a href="#local-6989586621679364367"><span class="hs-identifier hs-var">produce</span></a></span></span><span> </span><span id="local-6989586621679364366"><span class="annot"><span class="annottext">initial :: s1
</span><a href="#local-6989586621679364366"><span class="hs-identifier hs-var">initial</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(s1 -&gt; a -&gt; m (Step (PipeState s1 s2) b))
-&gt; (s2 -&gt; m (Step (PipeState s1 s2) b)) -&gt; s1 -&gt; Pipe m a b
forall (m :: * -&gt; *) a b s1 s2.
(s1 -&gt; a -&gt; m (Step (PipeState s1 s2) b))
-&gt; (s2 -&gt; m (Step (PipeState s1 s2) b)) -&gt; s1 -&gt; Pipe m a b
</span><a href="Streamly.Internal.Data.Pipe.Types.html#Pipe"><span class="hs-identifier hs-var">Pipe</span></a></span><span> </span><span class="annot"><span class="annottext">s1 -&gt; a -&gt; m (Step (PipeState s1 s2) b)
</span><a href="#local-6989586621679364365"><span class="hs-identifier hs-var">consume'</span></a></span><span> </span><span class="annot"><span class="annottext">s2 -&gt; m (Step (PipeState s1 s2) b)
</span><a href="#local-6989586621679364364"><span class="hs-identifier hs-var">produce'</span></a></span><span> </span><span class="annot"><span class="annottext">s1
</span><a href="#local-6989586621679364366"><span class="hs-identifier hs-var">initial</span></a></span><span>
</span><span id="line-93"></span><span>        </span><span class="hs-keyword">where</span><span>
</span><span id="line-94"></span><span>        </span><span class="hs-pragma">{-# INLINE_LATE consume' #-}</span><span>
</span><span id="line-95"></span><span>        </span><span id="local-6989586621679364365"><span class="annot"><span class="annottext">consume' :: s1 -&gt; a -&gt; m (Step (PipeState s1 s2) b)
</span><a href="#local-6989586621679364365"><span class="hs-identifier hs-var hs-var">consume'</span></a></span></span><span> </span><span id="local-6989586621679364363"><span class="annot"><span class="annottext">st :: s1
</span><a href="#local-6989586621679364363"><span class="hs-identifier hs-var">st</span></a></span></span><span> </span><span id="local-6989586621679364362"><span class="annot"><span class="annottext">a :: a
</span><a href="#local-6989586621679364362"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-96"></span><span>            </span><span id="local-6989586621679364361"><span class="annot"><span class="annottext">Step (PipeState s1 s2) a
</span><a href="#local-6989586621679364361"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">s1 -&gt; a -&gt; m (Step (PipeState s1 s2) a)
</span><a href="#local-6989586621679364368"><span class="hs-identifier hs-var">consume</span></a></span><span> </span><span class="annot"><span class="annottext">s1
</span><a href="#local-6989586621679364363"><span class="hs-identifier hs-var">st</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679364362"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-97"></span><span>            </span><span class="annot"><span class="annottext">Step (PipeState s1 s2) b -&gt; m (Step (PipeState s1 s2) b)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Step (PipeState s1 s2) b -&gt; m (Step (PipeState s1 s2) b))
-&gt; Step (PipeState s1 s2) b -&gt; m (Step (PipeState s1 s2) b)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Step (PipeState s1 s2) a
</span><a href="#local-6989586621679364361"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-98"></span><span>                </span><span class="annot"><a href="Streamly.Internal.Data.Pipe.Types.html#Yield"><span class="hs-identifier hs-type">Yield</span></a></span><span> </span><span id="local-6989586621679364360"><span class="annot"><span class="annottext">x :: a
</span><a href="#local-6989586621679364360"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621679364359"><span class="annot"><span class="annottext">s :: PipeState s1 s2
</span><a href="#local-6989586621679364359"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">b -&gt; PipeState s1 s2 -&gt; Step (PipeState s1 s2) b
forall s a. a -&gt; s -&gt; Step s a
</span><a href="Streamly.Internal.Data.Pipe.Types.html#Yield"><span class="hs-identifier hs-var">Yield</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; b
</span><a href="#local-6989586621679364369"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679364360"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">PipeState s1 s2
</span><a href="#local-6989586621679364359"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-99"></span><span>                </span><span class="annot"><a href="Streamly.Internal.Data.Pipe.Types.html#Continue"><span class="hs-identifier hs-type">Continue</span></a></span><span> </span><span id="local-6989586621679364358"><span class="annot"><span class="annottext">s :: PipeState s1 s2
</span><a href="#local-6989586621679364358"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PipeState s1 s2 -&gt; Step (PipeState s1 s2) b
forall s a. s -&gt; Step s a
</span><a href="Streamly.Internal.Data.Pipe.Types.html#Continue"><span class="hs-identifier hs-var">Continue</span></a></span><span> </span><span class="annot"><span class="annottext">PipeState s1 s2
</span><a href="#local-6989586621679364358"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-100"></span><span>
</span><span id="line-101"></span><span>        </span><span class="hs-pragma">{-# INLINE_LATE produce' #-}</span><span>
</span><span id="line-102"></span><span>        </span><span id="local-6989586621679364364"><span class="annot"><span class="annottext">produce' :: s2 -&gt; m (Step (PipeState s1 s2) b)
</span><a href="#local-6989586621679364364"><span class="hs-identifier hs-var hs-var">produce'</span></a></span></span><span> </span><span id="local-6989586621679364357"><span class="annot"><span class="annottext">st :: s2
</span><a href="#local-6989586621679364357"><span class="hs-identifier hs-var">st</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-103"></span><span>            </span><span id="local-6989586621679364356"><span class="annot"><span class="annottext">Step (PipeState s1 s2) a
</span><a href="#local-6989586621679364356"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">s2 -&gt; m (Step (PipeState s1 s2) a)
</span><a href="#local-6989586621679364367"><span class="hs-identifier hs-var">produce</span></a></span><span> </span><span class="annot"><span class="annottext">s2
</span><a href="#local-6989586621679364357"><span class="hs-identifier hs-var">st</span></a></span><span>
</span><span id="line-104"></span><span>            </span><span class="annot"><span class="annottext">Step (PipeState s1 s2) b -&gt; m (Step (PipeState s1 s2) b)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Step (PipeState s1 s2) b -&gt; m (Step (PipeState s1 s2) b))
-&gt; Step (PipeState s1 s2) b -&gt; m (Step (PipeState s1 s2) b)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Step (PipeState s1 s2) a
</span><a href="#local-6989586621679364356"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-105"></span><span>                </span><span class="annot"><a href="Streamly.Internal.Data.Pipe.Types.html#Yield"><span class="hs-identifier hs-type">Yield</span></a></span><span> </span><span id="local-6989586621679364355"><span class="annot"><span class="annottext">x :: a
</span><a href="#local-6989586621679364355"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621679364354"><span class="annot"><span class="annottext">s :: PipeState s1 s2
</span><a href="#local-6989586621679364354"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">b -&gt; PipeState s1 s2 -&gt; Step (PipeState s1 s2) b
forall s a. a -&gt; s -&gt; Step s a
</span><a href="Streamly.Internal.Data.Pipe.Types.html#Yield"><span class="hs-identifier hs-var">Yield</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; b
</span><a href="#local-6989586621679364369"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679364355"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">PipeState s1 s2
</span><a href="#local-6989586621679364354"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-106"></span><span>                </span><span class="annot"><a href="Streamly.Internal.Data.Pipe.Types.html#Continue"><span class="hs-identifier hs-type">Continue</span></a></span><span> </span><span id="local-6989586621679364353"><span class="annot"><span class="annottext">s :: PipeState s1 s2
</span><a href="#local-6989586621679364353"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PipeState s1 s2 -&gt; Step (PipeState s1 s2) b
forall s a. s -&gt; Step s a
</span><a href="Streamly.Internal.Data.Pipe.Types.html#Continue"><span class="hs-identifier hs-var">Continue</span></a></span><span> </span><span class="annot"><span class="annottext">PipeState s1 s2
</span><a href="#local-6989586621679364353"><span class="hs-identifier hs-var">s</span></a></span></span></span><span>
</span><span id="line-107"></span><span>
</span><span id="line-108"></span><span class="hs-comment">-- XXX move this to a separate module</span><span>
</span><span id="line-109"></span><span class="hs-keyword">data</span><span> </span><span id="Deque"><span class="annot"><a href="Streamly.Internal.Data.Pipe.Types.html#Deque"><span class="hs-identifier hs-var">Deque</span></a></span></span><span> </span><span id="local-6989586621679364599"><span class="annot"><a href="#local-6989586621679364599"><span class="hs-identifier hs-type">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span id="Deque"><span class="annot"><a href="Streamly.Internal.Data.Pipe.Types.html#Deque"><span class="hs-identifier hs-var">Deque</span></a></span></span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679364599"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="annot"><a href="#local-6989586621679364599"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">]</span><span>
</span><span id="line-110"></span><span>
</span><span id="line-111"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Pipe.Types.html#null"><span class="hs-pragma hs-type">null</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-112"></span><span id="local-6989586621679364542"><span class="annot"><a href="Streamly.Internal.Data.Pipe.Types.html#null"><span class="hs-identifier hs-type">null</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Pipe.Types.html#Deque"><span class="hs-identifier hs-type">Deque</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679364542"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Bool</span></span></span><span>
</span><span id="line-113"></span><span id="null"><span class="annot"><span class="annottext">null :: Deque a -&gt; Bool
</span><a href="Streamly.Internal.Data.Pipe.Types.html#null"><span class="hs-identifier hs-var hs-var">null</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Streamly.Internal.Data.Pipe.Types.html#Deque"><span class="hs-identifier hs-type">Deque</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">True</span></span><span>
</span><span id="line-114"></span><span class="annot"><a href="Streamly.Internal.Data.Pipe.Types.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Bool
</span><span class="hs-identifier hs-var">False</span></span><span>
</span><span id="line-115"></span><span>
</span><span id="line-116"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Pipe.Types.html#snoc"><span class="hs-pragma hs-type">snoc</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-117"></span><span id="local-6989586621679364557"><span class="annot"><a href="Streamly.Internal.Data.Pipe.Types.html#snoc"><span class="hs-identifier hs-type">snoc</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="#local-6989586621679364557"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Pipe.Types.html#Deque"><span class="hs-identifier hs-type">Deque</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679364557"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Pipe.Types.html#Deque"><span class="hs-identifier hs-type">Deque</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679364557"><span class="hs-identifier hs-type">a</span></a></span></span><span>
</span><span id="line-118"></span><span id="snoc"><span class="annot"><span class="annottext">snoc :: a -&gt; Deque a -&gt; Deque a
</span><a href="Streamly.Internal.Data.Pipe.Types.html#snoc"><span class="hs-identifier hs-var hs-var">snoc</span></a></span></span><span> </span><span id="local-6989586621679364349"><span class="annot"><span class="annottext">a :: a
</span><a href="#local-6989586621679364349"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Streamly.Internal.Data.Pipe.Types.html#Deque"><span class="hs-identifier hs-type">Deque</span></a></span><span> </span><span id="local-6989586621679364348"><span class="annot"><span class="annottext">snocList :: [a]
</span><a href="#local-6989586621679364348"><span class="hs-identifier hs-var">snocList</span></a></span></span><span> </span><span id="local-6989586621679364347"><span class="annot"><span class="annottext">consList :: [a]
</span><a href="#local-6989586621679364347"><span class="hs-identifier hs-var">consList</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">[a] -&gt; [a] -&gt; Deque a
forall a. [a] -&gt; [a] -&gt; Deque a
</span><a href="Streamly.Internal.Data.Pipe.Types.html#Deque"><span class="hs-identifier hs-var">Deque</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679364349"><span class="hs-identifier hs-var">a</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; [a] -&gt; [a]
forall a. a -&gt; [a] -&gt; [a]
</span><span class="hs-glyph hs-var">:</span></span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679364348"><span class="hs-identifier hs-var">snocList</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679364347"><span class="hs-identifier hs-var">consList</span></a></span><span>
</span><span id="line-119"></span><span>
</span><span id="line-120"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Pipe.Types.html#uncons"><span class="hs-pragma hs-type">uncons</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-121"></span><span id="local-6989586621679364556"><span class="annot"><a href="Streamly.Internal.Data.Pipe.Types.html#uncons"><span class="hs-identifier hs-type">uncons</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Pipe.Types.html#Deque"><span class="hs-identifier hs-type">Deque</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679364556"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Maybe</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679364556"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Pipe.Types.html#Deque"><span class="hs-identifier hs-type">Deque</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679364556"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span><span>
</span><span id="line-122"></span><span id="uncons"><span class="annot"><span class="annottext">uncons :: Deque a -&gt; Maybe (a, Deque a)
</span><a href="Streamly.Internal.Data.Pipe.Types.html#uncons"><span class="hs-identifier hs-var hs-var">uncons</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Streamly.Internal.Data.Pipe.Types.html#Deque"><span class="hs-identifier hs-type">Deque</span></a></span><span> </span><span id="local-6989586621679364345"><span class="annot"><span class="annottext">snocList :: [a]
</span><a href="#local-6989586621679364345"><span class="hs-identifier hs-var">snocList</span></a></span></span><span> </span><span id="local-6989586621679364344"><span class="annot"><span class="annottext">consList :: [a]
</span><a href="#local-6989586621679364344"><span class="hs-identifier hs-var">consList</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-123"></span><span>  </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679364344"><span class="hs-identifier hs-var">consList</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-124"></span><span>    </span><span id="local-6989586621679364343"><span class="annot"><span class="annottext">h :: a
</span><a href="#local-6989586621679364343"><span class="hs-identifier hs-var">h</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621679364342"><span class="annot"><span class="annottext">t :: [a]
</span><a href="#local-6989586621679364342"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(a, Deque a) -&gt; Maybe (a, Deque a)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679364343"><span class="hs-identifier hs-var">h</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[a] -&gt; [a] -&gt; Deque a
forall a. [a] -&gt; [a] -&gt; Deque a
</span><a href="Streamly.Internal.Data.Pipe.Types.html#Deque"><span class="hs-identifier hs-var">Deque</span></a></span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679364345"><span class="hs-identifier hs-var">snocList</span></a></span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679364342"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-125"></span><span>    </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-126"></span><span>      </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">[a] -&gt; [a]
forall a. [a] -&gt; [a]
</span><span class="hs-identifier hs-var">Prelude.reverse</span></span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679364345"><span class="hs-identifier hs-var">snocList</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-127"></span><span>        </span><span id="local-6989586621679364340"><span class="annot"><span class="annottext">h :: a
</span><a href="#local-6989586621679364340"><span class="hs-identifier hs-var">h</span></a></span></span><span> </span><span class="annot"><span class="hs-glyph hs-type">:</span></span><span> </span><span id="local-6989586621679364339"><span class="annot"><span class="annottext">t :: [a]
</span><a href="#local-6989586621679364339"><span class="hs-identifier hs-var">t</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(a, Deque a) -&gt; Maybe (a, Deque a)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679364340"><span class="hs-identifier hs-var">h</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">[a] -&gt; [a] -&gt; Deque a
forall a. [a] -&gt; [a] -&gt; Deque a
</span><a href="Streamly.Internal.Data.Pipe.Types.html#Deque"><span class="hs-identifier hs-var">Deque</span></a></span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="annot"><span class="annottext">[a]
</span><a href="#local-6989586621679364339"><span class="hs-identifier hs-var">t</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-128"></span><span>        </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Maybe (a, Deque a)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-129"></span><span>
</span><span id="line-130"></span><span class="hs-comment">-- | The composed pipe distributes the input to both the constituent pipes and</span><span>
</span><span id="line-131"></span><span class="hs-comment">-- zips the output of the two using a supplied zipping function.</span><span>
</span><span id="line-132"></span><span class="hs-comment">--</span><span>
</span><span id="line-133"></span><span class="hs-comment">-- @since 0.7.0</span><span>
</span><span id="line-134"></span><span class="hs-pragma">{-# INLINE_NORMAL zipWith #-}</span><span>
</span><span id="line-135"></span><span id="local-6989586621679364507"><span id="local-6989586621679364508"><span id="local-6989586621679364509"><span id="local-6989586621679364510"><span id="local-6989586621679364511"><span class="annot"><a href="Streamly.Internal.Data.Pipe.Types.html#zipWith"><span class="hs-identifier hs-type">zipWith</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621679364511"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679364510"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679364509"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679364508"><span class="hs-identifier hs-type">c</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Pipe.Types.html#Pipe"><span class="hs-identifier hs-type">Pipe</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679364511"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679364507"><span class="hs-identifier hs-type">i</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679364510"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Pipe.Types.html#Pipe"><span class="hs-identifier hs-type">Pipe</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679364511"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679364507"><span class="hs-identifier hs-type">i</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679364509"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Pipe.Types.html#Pipe"><span class="hs-identifier hs-type">Pipe</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679364511"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679364507"><span class="hs-identifier hs-type">i</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679364508"><span class="hs-identifier hs-type">c</span></a></span></span></span></span></span></span><span>
</span><span id="line-136"></span><span id="zipWith"><span class="annot"><span class="annottext">zipWith :: (a -&gt; b -&gt; c) -&gt; Pipe m i a -&gt; Pipe m i b -&gt; Pipe m i c
</span><a href="Streamly.Internal.Data.Pipe.Types.html#zipWith"><span class="hs-identifier hs-var hs-var">zipWith</span></a></span></span><span> </span><span id="local-6989586621679364338"><span class="annot"><span class="annottext">f :: a -&gt; b -&gt; c
</span><a href="#local-6989586621679364338"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Streamly.Internal.Data.Pipe.Types.html#Pipe"><span class="hs-identifier hs-type">Pipe</span></a></span><span> </span><span id="local-6989586621679364337"><span class="annot"><span class="annottext">consumeL :: s1 -&gt; i -&gt; m (Step (PipeState s1 s2) a)
</span><a href="#local-6989586621679364337"><span class="hs-identifier hs-var">consumeL</span></a></span></span><span> </span><span id="local-6989586621679364336"><span class="annot"><span class="annottext">produceL :: s2 -&gt; m (Step (PipeState s1 s2) a)
</span><a href="#local-6989586621679364336"><span class="hs-identifier hs-var">produceL</span></a></span></span><span> </span><span id="local-6989586621679364335"><span class="annot"><span class="annottext">stateL :: s1
</span><a href="#local-6989586621679364335"><span class="hs-identifier hs-var">stateL</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Streamly.Internal.Data.Pipe.Types.html#Pipe"><span class="hs-identifier hs-type">Pipe</span></a></span><span> </span><span id="local-6989586621679364334"><span class="annot"><span class="annottext">consumeR :: s1 -&gt; i -&gt; m (Step (PipeState s1 s2) b)
</span><a href="#local-6989586621679364334"><span class="hs-identifier hs-var">consumeR</span></a></span></span><span> </span><span id="local-6989586621679364333"><span class="annot"><span class="annottext">produceR :: s2 -&gt; m (Step (PipeState s1 s2) b)
</span><a href="#local-6989586621679364333"><span class="hs-identifier hs-var">produceR</span></a></span></span><span> </span><span id="local-6989586621679364332"><span class="annot"><span class="annottext">stateR :: s1
</span><a href="#local-6989586621679364332"><span class="hs-identifier hs-var">stateR</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-137"></span><span>                    </span><span class="annot"><span class="annottext">(Tuple'
   (PipeState s1 s2, Maybe a, Maybe (Deque i))
   (PipeState s1 s2, Maybe b, Maybe (Deque i))
 -&gt; i
 -&gt; m (Step
         (PipeState
            (Tuple'
               (PipeState s1 s2, Maybe a, Maybe (Deque i))
               (PipeState s1 s2, Maybe b, Maybe (Deque i)))
            (Tuple'
               (PipeState s1 s2, Maybe a, Maybe (Deque i))
               (PipeState s1 s2, Maybe b, Maybe (Deque i))))
         c))
-&gt; (Tuple'
      (PipeState s1 s2, Maybe a, Maybe (Deque i))
      (PipeState s1 s2, Maybe b, Maybe (Deque i))
    -&gt; m (Step
            (PipeState
               (Tuple'
                  (PipeState s1 s2, Maybe a, Maybe (Deque i))
                  (PipeState s1 s2, Maybe b, Maybe (Deque i)))
               (Tuple'
                  (PipeState s1 s2, Maybe a, Maybe (Deque i))
                  (PipeState s1 s2, Maybe b, Maybe (Deque i))))
            c))
-&gt; Tuple'
     (PipeState s1 s2, Maybe a, Maybe (Deque i))
     (PipeState s1 s2, Maybe b, Maybe (Deque i))
-&gt; Pipe m i c
forall (m :: * -&gt; *) a b s1 s2.
(s1 -&gt; a -&gt; m (Step (PipeState s1 s2) b))
-&gt; (s2 -&gt; m (Step (PipeState s1 s2) b)) -&gt; s1 -&gt; Pipe m a b
</span><a href="Streamly.Internal.Data.Pipe.Types.html#Pipe"><span class="hs-identifier hs-var">Pipe</span></a></span><span> </span><span class="annot"><span class="annottext">Tuple'
  (PipeState s1 s2, Maybe a, Maybe (Deque i))
  (PipeState s1 s2, Maybe b, Maybe (Deque i))
-&gt; i
-&gt; m (Step
        (PipeState
           (Tuple'
              (PipeState s1 s2, Maybe a, Maybe (Deque i))
              (PipeState s1 s2, Maybe b, Maybe (Deque i)))
           (Tuple'
              (PipeState s1 s2, Maybe a, Maybe (Deque i))
              (PipeState s1 s2, Maybe b, Maybe (Deque i))))
        c)
</span><a href="#local-6989586621679364331"><span class="hs-identifier hs-var">consume</span></a></span><span> </span><span class="annot"><span class="annottext">Tuple'
  (PipeState s1 s2, Maybe a, Maybe (Deque i))
  (PipeState s1 s2, Maybe b, Maybe (Deque i))
-&gt; m (Step
        (PipeState
           (Tuple'
              (PipeState s1 s2, Maybe a, Maybe (Deque i))
              (PipeState s1 s2, Maybe b, Maybe (Deque i)))
           (Tuple'
              (PipeState s1 s2, Maybe a, Maybe (Deque i))
              (PipeState s1 s2, Maybe b, Maybe (Deque i))))
        c)
</span><a href="#local-6989586621679364330"><span class="hs-identifier hs-var">produce</span></a></span><span> </span><span class="annot"><span class="annottext">Tuple'
  (PipeState s1 s2, Maybe a, Maybe (Deque i))
  (PipeState s1 s2, Maybe b, Maybe (Deque i))
forall s2 a a s2 a a.
Tuple'
  (PipeState s1 s2, Maybe a, Maybe a)
  (PipeState s1 s2, Maybe a, Maybe a)
</span><a href="#local-6989586621679364329"><span class="hs-identifier hs-var">state</span></a></span><span>
</span><span id="line-138"></span><span>        </span><span class="hs-keyword">where</span><span>
</span><span id="line-139"></span><span>
</span><span id="line-140"></span><span>        </span><span class="hs-comment">-- Left state means we need to consume input from the source. A Right</span><span>
</span><span id="line-141"></span><span>        </span><span class="hs-comment">-- state means we either have buffered input or we are in generation</span><span>
</span><span id="line-142"></span><span>        </span><span class="hs-comment">-- mode so we do not need input from source in either case.</span><span>
</span><span id="line-143"></span><span>        </span><span class="hs-comment">--</span><span>
</span><span id="line-144"></span><span>        </span><span id="local-6989586621679364329"><span class="annot"><span class="annottext">state :: Tuple'
  (PipeState s1 s2, Maybe a, Maybe a)
  (PipeState s1 s2, Maybe a, Maybe a)
</span><a href="#local-6989586621679364329"><span class="hs-identifier hs-var hs-var">state</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(PipeState s1 s2, Maybe a, Maybe a)
-&gt; (PipeState s1 s2, Maybe a, Maybe a)
-&gt; Tuple'
     (PipeState s1 s2, Maybe a, Maybe a)
     (PipeState s1 s2, Maybe a, Maybe a)
forall a b. a -&gt; b -&gt; Tuple' a b
</span><a href="Streamly.Internal.Data.Tuple.Strict.html#Tuple%27"><span class="hs-identifier hs-var">Tuple'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">s1 -&gt; PipeState s1 s2
forall s1 s2. s1 -&gt; PipeState s1 s2
</span><a href="Streamly.Internal.Data.Pipe.Types.html#Consume"><span class="hs-identifier hs-var">Consume</span></a></span><span> </span><span class="annot"><span class="annottext">s1
</span><a href="#local-6989586621679364335"><span class="hs-identifier hs-var">stateL</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe a
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe a
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">)</span><span>
</span><span id="line-145"></span><span>                       </span><span class="hs-special">(</span><span class="annot"><span class="annottext">s1 -&gt; PipeState s1 s2
forall s1 s2. s1 -&gt; PipeState s1 s2
</span><a href="Streamly.Internal.Data.Pipe.Types.html#Consume"><span class="hs-identifier hs-var">Consume</span></a></span><span> </span><span class="annot"><span class="annottext">s1
</span><a href="#local-6989586621679364332"><span class="hs-identifier hs-var">stateR</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe a
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe a
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">)</span><span>
</span><span id="line-146"></span><span>
</span><span id="line-147"></span><span>        </span><span class="hs-comment">-- XXX for heavy buffering we need to have the (ring) buffer in pinned</span><span>
</span><span id="line-148"></span><span>        </span><span class="hs-comment">-- memory using the Storable instance.</span><span>
</span><span id="line-149"></span><span>        </span><span class="hs-pragma">{-# INLINE_LATE consume #-}</span><span>
</span><span id="line-150"></span><span>        </span><span id="local-6989586621679364331"><span class="annot"><span class="annottext">consume :: Tuple'
  (PipeState s1 s2, Maybe a, Maybe (Deque i))
  (PipeState s1 s2, Maybe b, Maybe (Deque i))
-&gt; i
-&gt; m (Step
        (PipeState
           (Tuple'
              (PipeState s1 s2, Maybe a, Maybe (Deque i))
              (PipeState s1 s2, Maybe b, Maybe (Deque i)))
           (Tuple'
              (PipeState s1 s2, Maybe a, Maybe (Deque i))
              (PipeState s1 s2, Maybe b, Maybe (Deque i))))
        c)
</span><a href="#local-6989586621679364331"><span class="hs-identifier hs-var hs-var">consume</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Streamly.Internal.Data.Tuple.Strict.html#Tuple%27"><span class="hs-identifier hs-type">Tuple'</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679364327"><span class="annot"><span class="annottext">sL :: PipeState s1 s2
</span><a href="#local-6989586621679364327"><span class="hs-identifier hs-var">sL</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679364326"><span class="annot"><span class="annottext">resL :: Maybe a
</span><a href="#local-6989586621679364326"><span class="hs-identifier hs-var">resL</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679364325"><span class="annot"><span class="annottext">lq :: Maybe (Deque i)
</span><a href="#local-6989586621679364325"><span class="hs-identifier hs-var">lq</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679364324"><span class="annot"><span class="annottext">sR :: PipeState s1 s2
</span><a href="#local-6989586621679364324"><span class="hs-identifier hs-var">sR</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679364323"><span class="annot"><span class="annottext">resR :: Maybe b
</span><a href="#local-6989586621679364323"><span class="hs-identifier hs-var">resR</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679364322"><span class="annot"><span class="annottext">rq :: Maybe (Deque i)
</span><a href="#local-6989586621679364322"><span class="hs-identifier hs-var">rq</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span id="local-6989586621679364321"><span class="annot"><span class="annottext">a :: i
</span><a href="#local-6989586621679364321"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-151"></span><span>            </span><span id="local-6989586621679364320"><span class="annot"><span class="annottext">(PipeState s1 s2, Maybe a, Maybe (Deque i))
</span><a href="#local-6989586621679364320"><span class="hs-identifier hs-var">s1</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PipeState s1 s2
-&gt; Maybe a
-&gt; Maybe (Deque i)
-&gt; (s1 -&gt; i -&gt; m (Step (PipeState s1 s2) a))
-&gt; (s2 -&gt; m (Step (PipeState s1 s2) a))
-&gt; i
-&gt; m (PipeState s1 s2, Maybe a, Maybe (Deque i))
forall (m :: * -&gt; *) t t a a.
Monad m =&gt;
PipeState t t
-&gt; Maybe a
-&gt; Maybe (Deque a)
-&gt; (t -&gt; a -&gt; m (Step (PipeState t t) a))
-&gt; (t -&gt; m (Step (PipeState t t) a))
-&gt; a
-&gt; m (PipeState t t, Maybe a, Maybe (Deque a))
</span><a href="#local-6989586621679364319"><span class="hs-identifier hs-var">drive</span></a></span><span> </span><span class="annot"><span class="annottext">PipeState s1 s2
</span><a href="#local-6989586621679364327"><span class="hs-identifier hs-var">sL</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe a
</span><a href="#local-6989586621679364326"><span class="hs-identifier hs-var">resL</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (Deque i)
</span><a href="#local-6989586621679364325"><span class="hs-identifier hs-var">lq</span></a></span><span> </span><span class="annot"><span class="annottext">s1 -&gt; i -&gt; m (Step (PipeState s1 s2) a)
</span><a href="#local-6989586621679364337"><span class="hs-identifier hs-var">consumeL</span></a></span><span> </span><span class="annot"><span class="annottext">s2 -&gt; m (Step (PipeState s1 s2) a)
</span><a href="#local-6989586621679364336"><span class="hs-identifier hs-var">produceL</span></a></span><span> </span><span class="annot"><span class="annottext">i
</span><a href="#local-6989586621679364321"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-152"></span><span>            </span><span id="local-6989586621679364318"><span class="annot"><span class="annottext">(PipeState s1 s2, Maybe b, Maybe (Deque i))
</span><a href="#local-6989586621679364318"><span class="hs-identifier hs-var">s2</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PipeState s1 s2
-&gt; Maybe b
-&gt; Maybe (Deque i)
-&gt; (s1 -&gt; i -&gt; m (Step (PipeState s1 s2) b))
-&gt; (s2 -&gt; m (Step (PipeState s1 s2) b))
-&gt; i
-&gt; m (PipeState s1 s2, Maybe b, Maybe (Deque i))
forall (m :: * -&gt; *) t t a a.
Monad m =&gt;
PipeState t t
-&gt; Maybe a
-&gt; Maybe (Deque a)
-&gt; (t -&gt; a -&gt; m (Step (PipeState t t) a))
-&gt; (t -&gt; m (Step (PipeState t t) a))
-&gt; a
-&gt; m (PipeState t t, Maybe a, Maybe (Deque a))
</span><a href="#local-6989586621679364319"><span class="hs-identifier hs-var">drive</span></a></span><span> </span><span class="annot"><span class="annottext">PipeState s1 s2
</span><a href="#local-6989586621679364324"><span class="hs-identifier hs-var">sR</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe b
</span><a href="#local-6989586621679364323"><span class="hs-identifier hs-var">resR</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (Deque i)
</span><a href="#local-6989586621679364322"><span class="hs-identifier hs-var">rq</span></a></span><span> </span><span class="annot"><span class="annottext">s1 -&gt; i -&gt; m (Step (PipeState s1 s2) b)
</span><a href="#local-6989586621679364334"><span class="hs-identifier hs-var">consumeR</span></a></span><span> </span><span class="annot"><span class="annottext">s2 -&gt; m (Step (PipeState s1 s2) b)
</span><a href="#local-6989586621679364333"><span class="hs-identifier hs-var">produceR</span></a></span><span> </span><span class="annot"><span class="annottext">i
</span><a href="#local-6989586621679364321"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-153"></span><span>            </span><span class="annot"><span class="annottext">(PipeState s1 s2, Maybe a, Maybe (Deque i))
-&gt; (PipeState s1 s2, Maybe b, Maybe (Deque i))
-&gt; m (Step
        (PipeState
           (Tuple'
              (PipeState s1 s2, Maybe a, Maybe (Deque i))
              (PipeState s1 s2, Maybe b, Maybe (Deque i)))
           (Tuple'
              (PipeState s1 s2, Maybe a, Maybe (Deque i))
              (PipeState s1 s2, Maybe b, Maybe (Deque i))))
        c)
forall (m :: * -&gt; *) s1 s2 a s1 s2 a.
Monad m =&gt;
(PipeState s1 s2, Maybe a, Maybe a)
-&gt; (PipeState s1 s2, Maybe b, Maybe a)
-&gt; m (Step
        (PipeState
           (Tuple'
              (PipeState s1 s2, Maybe a, Maybe a)
              (PipeState s1 s2, Maybe b, Maybe a))
           (Tuple'
              (PipeState s1 s2, Maybe a, Maybe a)
              (PipeState s1 s2, Maybe b, Maybe a)))
        c)
</span><a href="#local-6989586621679364317"><span class="hs-identifier hs-var">yieldOutput</span></a></span><span> </span><span class="annot"><span class="annottext">(PipeState s1 s2, Maybe a, Maybe (Deque i))
</span><a href="#local-6989586621679364320"><span class="hs-identifier hs-var">s1</span></a></span><span> </span><span class="annot"><span class="annottext">(PipeState s1 s2, Maybe b, Maybe (Deque i))
</span><a href="#local-6989586621679364318"><span class="hs-identifier hs-var">s2</span></a></span><span>
</span><span id="line-154"></span><span>
</span><span id="line-155"></span><span>            </span><span class="hs-keyword">where</span><span>
</span><span id="line-156"></span><span>
</span><span id="line-157"></span><span>            </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="#local-6989586621679364319"><span class="hs-pragma hs-type">drive</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-158"></span><span>            </span><span id="local-6989586621679364319"><span class="annot"><span class="annottext">drive :: PipeState t t
-&gt; Maybe a
-&gt; Maybe (Deque a)
-&gt; (t -&gt; a -&gt; m (Step (PipeState t t) a))
-&gt; (t -&gt; m (Step (PipeState t t) a))
-&gt; a
-&gt; m (PipeState t t, Maybe a, Maybe (Deque a))
</span><a href="#local-6989586621679364319"><span class="hs-identifier hs-var hs-var">drive</span></a></span></span><span> </span><span id="local-6989586621679364316"><span class="annot"><span class="annottext">st :: PipeState t t
</span><a href="#local-6989586621679364316"><span class="hs-identifier hs-var">st</span></a></span></span><span> </span><span id="local-6989586621679364315"><span class="annot"><span class="annottext">res :: Maybe a
</span><a href="#local-6989586621679364315"><span class="hs-identifier hs-var">res</span></a></span></span><span> </span><span id="local-6989586621679364314"><span class="annot"><span class="annottext">queue :: Maybe (Deque a)
</span><a href="#local-6989586621679364314"><span class="hs-identifier hs-var">queue</span></a></span></span><span> </span><span id="local-6989586621679364313"><span class="annot"><span class="annottext">fConsume :: t -&gt; a -&gt; m (Step (PipeState t t) a)
</span><a href="#local-6989586621679364313"><span class="hs-identifier hs-var">fConsume</span></a></span></span><span> </span><span id="local-6989586621679364312"><span class="annot"><span class="annottext">fProduce :: t -&gt; m (Step (PipeState t t) a)
</span><a href="#local-6989586621679364312"><span class="hs-identifier hs-var">fProduce</span></a></span></span><span> </span><span id="local-6989586621679364311"><span class="annot"><span class="annottext">val :: a
</span><a href="#local-6989586621679364311"><span class="hs-identifier hs-var">val</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-159"></span><span>                </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe a
</span><a href="#local-6989586621679364315"><span class="hs-identifier hs-var">res</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-160"></span><span>                    </span><span class="annot"><span class="hs-identifier hs-type">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PipeState t t
-&gt; Maybe (Deque a)
-&gt; a
-&gt; (t -&gt; a -&gt; m (Step (PipeState t t) a))
-&gt; (t -&gt; m (Step (PipeState t t) a))
-&gt; m (PipeState t t, Maybe a, Maybe (Deque a))
forall (m :: * -&gt; *) t t t a a.
Monad m =&gt;
PipeState t t
-&gt; Maybe (Deque t)
-&gt; t
-&gt; (t -&gt; t -&gt; m (Step a a))
-&gt; (t -&gt; m (Step a a))
-&gt; m (a, Maybe a, Maybe (Deque t))
</span><a href="#local-6989586621679364310"><span class="hs-identifier hs-var">goConsume</span></a></span><span> </span><span class="annot"><span class="annottext">PipeState t t
</span><a href="#local-6989586621679364316"><span class="hs-identifier hs-var">st</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (Deque a)
</span><a href="#local-6989586621679364314"><span class="hs-identifier hs-var">queue</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679364311"><span class="hs-identifier hs-var">val</span></a></span><span> </span><span class="annot"><span class="annottext">t -&gt; a -&gt; m (Step (PipeState t t) a)
</span><a href="#local-6989586621679364313"><span class="hs-identifier hs-var">fConsume</span></a></span><span> </span><span class="annot"><span class="annottext">t -&gt; m (Step (PipeState t t) a)
</span><a href="#local-6989586621679364312"><span class="hs-identifier hs-var">fProduce</span></a></span><span>
</span><span id="line-161"></span><span>                    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679364309"><span class="annot"><span class="annottext">x :: a
</span><a href="#local-6989586621679364309"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(PipeState t t, Maybe a, Maybe (Deque a))
-&gt; m (PipeState t t, Maybe a, Maybe (Deque a))
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">((PipeState t t, Maybe a, Maybe (Deque a))
 -&gt; m (PipeState t t, Maybe a, Maybe (Deque a)))
-&gt; (PipeState t t, Maybe a, Maybe (Deque a))
-&gt; m (PipeState t t, Maybe a, Maybe (Deque a))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-162"></span><span>                        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe (Deque a)
</span><a href="#local-6989586621679364314"><span class="hs-identifier hs-var">queue</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-163"></span><span>                            </span><span class="annot"><span class="hs-identifier hs-type">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PipeState t t
</span><a href="#local-6989586621679364316"><span class="hs-identifier hs-var">st</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">a -&gt; Maybe a
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679364309"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Deque a -&gt; Maybe (Deque a)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(Deque a -&gt; Maybe (Deque a)) -&gt; Deque a -&gt; Maybe (Deque a)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">[a] -&gt; [a] -&gt; Deque a
forall a. [a] -&gt; [a] -&gt; Deque a
</span><a href="Streamly.Internal.Data.Pipe.Types.html#Deque"><span class="hs-identifier hs-var">Deque</span></a></span><span> </span><span class="hs-special">[</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679364311"><span class="hs-identifier hs-var">val</span></a></span><span class="hs-special">]</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><span id="line-164"></span><span>                            </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679364308"><span class="annot"><span class="annottext">q :: Deque a
</span><a href="#local-6989586621679364308"><span class="hs-identifier hs-var">q</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PipeState t t
</span><a href="#local-6989586621679364316"><span class="hs-identifier hs-var">st</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">a -&gt; Maybe a
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679364309"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Deque a -&gt; Maybe (Deque a)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">(Deque a -&gt; Maybe (Deque a)) -&gt; Deque a -&gt; Maybe (Deque a)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; Deque a -&gt; Deque a
forall a. a -&gt; Deque a -&gt; Deque a
</span><a href="Streamly.Internal.Data.Pipe.Types.html#snoc"><span class="hs-identifier hs-var">snoc</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679364311"><span class="hs-identifier hs-var">val</span></a></span><span> </span><span class="annot"><span class="annottext">Deque a
</span><a href="#local-6989586621679364308"><span class="hs-identifier hs-var">q</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-165"></span><span>
</span><span id="line-166"></span><span>            </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="#local-6989586621679364310"><span class="hs-pragma hs-type">goConsume</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-167"></span><span>            </span><span id="local-6989586621679364310"><span class="annot"><span class="annottext">goConsume :: PipeState t t
-&gt; Maybe (Deque t)
-&gt; t
-&gt; (t -&gt; t -&gt; m (Step a a))
-&gt; (t -&gt; m (Step a a))
-&gt; m (a, Maybe a, Maybe (Deque t))
</span><a href="#local-6989586621679364310"><span class="hs-identifier hs-var hs-var">goConsume</span></a></span></span><span> </span><span id="local-6989586621679364307"><span class="annot"><span class="annottext">stt :: PipeState t t
</span><a href="#local-6989586621679364307"><span class="hs-identifier hs-var">stt</span></a></span></span><span> </span><span id="local-6989586621679364306"><span class="annot"><span class="annottext">queue :: Maybe (Deque t)
</span><a href="#local-6989586621679364306"><span class="hs-identifier hs-var">queue</span></a></span></span><span> </span><span id="local-6989586621679364305"><span class="annot"><span class="annottext">val :: t
</span><a href="#local-6989586621679364305"><span class="hs-identifier hs-var">val</span></a></span></span><span> </span><span id="local-6989586621679364304"><span class="annot"><span class="annottext">fConsume :: t -&gt; t -&gt; m (Step a a)
</span><a href="#local-6989586621679364304"><span class="hs-identifier hs-var">fConsume</span></a></span></span><span> </span><span id="local-6989586621679364303"><span class="annot"><span class="annottext">stp2 :: t -&gt; m (Step a a)
</span><a href="#local-6989586621679364303"><span class="hs-identifier hs-var">stp2</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-168"></span><span>                </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">PipeState t t
</span><a href="#local-6989586621679364307"><span class="hs-identifier hs-var">stt</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-169"></span><span>                    </span><span class="annot"><a href="Streamly.Internal.Data.Pipe.Types.html#Consume"><span class="hs-identifier hs-type">Consume</span></a></span><span> </span><span id="local-6989586621679364302"><span class="annot"><span class="annottext">st :: t
</span><a href="#local-6989586621679364302"><span class="hs-identifier hs-var">st</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-170"></span><span>                        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe (Deque t)
</span><a href="#local-6989586621679364306"><span class="hs-identifier hs-var">queue</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-171"></span><span>                            </span><span class="annot"><span class="hs-identifier hs-type">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-172"></span><span>                                </span><span id="local-6989586621679364301"><span class="annot"><span class="annottext">Step a a
</span><a href="#local-6989586621679364301"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">t -&gt; t -&gt; m (Step a a)
</span><a href="#local-6989586621679364304"><span class="hs-identifier hs-var">fConsume</span></a></span><span> </span><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621679364302"><span class="hs-identifier hs-var">st</span></a></span><span> </span><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621679364305"><span class="hs-identifier hs-var">val</span></a></span><span>
</span><span id="line-173"></span><span>                                </span><span class="annot"><span class="annottext">(a, Maybe a, Maybe (Deque t)) -&gt; m (a, Maybe a, Maybe (Deque t))
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">((a, Maybe a, Maybe (Deque t)) -&gt; m (a, Maybe a, Maybe (Deque t)))
-&gt; (a, Maybe a, Maybe (Deque t)) -&gt; m (a, Maybe a, Maybe (Deque t))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Step a a
</span><a href="#local-6989586621679364301"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-174"></span><span>                                    </span><span class="annot"><a href="Streamly.Internal.Data.Pipe.Types.html#Yield"><span class="hs-identifier hs-type">Yield</span></a></span><span> </span><span id="local-6989586621679364300"><span class="annot"><span class="annottext">x :: a
</span><a href="#local-6989586621679364300"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621679364299"><span class="annot"><span class="annottext">s :: a
</span><a href="#local-6989586621679364299"><span class="hs-identifier hs-var">s</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679364299"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">a -&gt; Maybe a
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679364300"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe (Deque t)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">)</span><span>
</span><span id="line-175"></span><span>                                    </span><span class="annot"><a href="Streamly.Internal.Data.Pipe.Types.html#Continue"><span class="hs-identifier hs-type">Continue</span></a></span><span> </span><span id="local-6989586621679364298"><span class="annot"><span class="annottext">s :: a
</span><a href="#local-6989586621679364298"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679364298"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe a
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe (Deque t)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">)</span><span>
</span><span id="line-176"></span><span>                            </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679364297"><span class="annot"><span class="annottext">queue' :: Deque t
</span><a href="#local-6989586621679364297"><span class="hs-identifier hs-var">queue'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-177"></span><span>                                </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Deque t -&gt; Maybe (t, Deque t)
forall a. Deque a -&gt; Maybe (a, Deque a)
</span><a href="Streamly.Internal.Data.Pipe.Types.html#uncons"><span class="hs-identifier hs-var">uncons</span></a></span><span> </span><span class="annot"><span class="annottext">Deque t
</span><a href="#local-6989586621679364297"><span class="hs-identifier hs-var">queue'</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-178"></span><span>                                    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679364296"><span class="annot"><span class="annottext">v :: t
</span><a href="#local-6989586621679364296"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679364295"><span class="annot"><span class="annottext">q :: Deque t
</span><a href="#local-6989586621679364295"><span class="hs-identifier hs-var">q</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-179"></span><span>                                        </span><span id="local-6989586621679364294"><span class="annot"><span class="annottext">Step a a
</span><a href="#local-6989586621679364294"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">t -&gt; t -&gt; m (Step a a)
</span><a href="#local-6989586621679364304"><span class="hs-identifier hs-var">fConsume</span></a></span><span> </span><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621679364302"><span class="hs-identifier hs-var">st</span></a></span><span> </span><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621679364296"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-180"></span><span>                                        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679364293"><span class="annot"><span class="annottext">q' :: Deque t
</span><a href="#local-6989586621679364293"><span class="hs-identifier hs-var hs-var">q'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">t -&gt; Deque t -&gt; Deque t
forall a. a -&gt; Deque a -&gt; Deque a
</span><a href="Streamly.Internal.Data.Pipe.Types.html#snoc"><span class="hs-identifier hs-var">snoc</span></a></span><span> </span><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621679364305"><span class="hs-identifier hs-var">val</span></a></span><span> </span><span class="annot"><span class="annottext">Deque t
</span><a href="#local-6989586621679364295"><span class="hs-identifier hs-var">q</span></a></span><span>
</span><span id="line-181"></span><span>                                        </span><span class="annot"><span class="annottext">(a, Maybe a, Maybe (Deque t)) -&gt; m (a, Maybe a, Maybe (Deque t))
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">((a, Maybe a, Maybe (Deque t)) -&gt; m (a, Maybe a, Maybe (Deque t)))
-&gt; (a, Maybe a, Maybe (Deque t)) -&gt; m (a, Maybe a, Maybe (Deque t))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Step a a
</span><a href="#local-6989586621679364294"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-182"></span><span>                                            </span><span class="annot"><a href="Streamly.Internal.Data.Pipe.Types.html#Yield"><span class="hs-identifier hs-type">Yield</span></a></span><span> </span><span id="local-6989586621679364292"><span class="annot"><span class="annottext">x :: a
</span><a href="#local-6989586621679364292"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621679364291"><span class="annot"><span class="annottext">s :: a
</span><a href="#local-6989586621679364291"><span class="hs-identifier hs-var">s</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679364291"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">a -&gt; Maybe a
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679364292"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Deque t -&gt; Maybe (Deque t)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Deque t
</span><a href="#local-6989586621679364293"><span class="hs-identifier hs-var">q'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-183"></span><span>                                            </span><span class="annot"><a href="Streamly.Internal.Data.Pipe.Types.html#Continue"><span class="hs-identifier hs-type">Continue</span></a></span><span> </span><span id="local-6989586621679364290"><span class="annot"><span class="annottext">s :: a
</span><a href="#local-6989586621679364290"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679364290"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe a
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Deque t -&gt; Maybe (Deque t)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Deque t
</span><a href="#local-6989586621679364293"><span class="hs-identifier hs-var">q'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-184"></span><span>                                    </span><span class="annot"><span class="hs-identifier hs-type">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">m (a, Maybe a, Maybe (Deque t))
forall a. HasCallStack =&gt; a
</span><span class="hs-identifier hs-var">undefined</span></span><span> </span><span class="hs-comment">-- never occurs</span><span>
</span><span id="line-185"></span><span>                    </span><span class="annot"><a href="Streamly.Internal.Data.Pipe.Types.html#Produce"><span class="hs-identifier hs-type">Produce</span></a></span><span> </span><span id="local-6989586621679364288"><span class="annot"><span class="annottext">st :: t
</span><a href="#local-6989586621679364288"><span class="hs-identifier hs-var">st</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-186"></span><span>                        </span><span id="local-6989586621679364287"><span class="annot"><span class="annottext">Step a a
</span><a href="#local-6989586621679364287"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">t -&gt; m (Step a a)
</span><a href="#local-6989586621679364303"><span class="hs-identifier hs-var">stp2</span></a></span><span> </span><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621679364288"><span class="hs-identifier hs-var">st</span></a></span><span>
</span><span id="line-187"></span><span>                        </span><span class="annot"><span class="annottext">(a, Maybe a, Maybe (Deque t)) -&gt; m (a, Maybe a, Maybe (Deque t))
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">((a, Maybe a, Maybe (Deque t)) -&gt; m (a, Maybe a, Maybe (Deque t)))
-&gt; (a, Maybe a, Maybe (Deque t)) -&gt; m (a, Maybe a, Maybe (Deque t))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Step a a
</span><a href="#local-6989586621679364287"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-188"></span><span>                            </span><span class="annot"><a href="Streamly.Internal.Data.Pipe.Types.html#Yield"><span class="hs-identifier hs-type">Yield</span></a></span><span> </span><span id="local-6989586621679364286"><span class="annot"><span class="annottext">x :: a
</span><a href="#local-6989586621679364286"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621679364285"><span class="annot"><span class="annottext">s :: a
</span><a href="#local-6989586621679364285"><span class="hs-identifier hs-var">s</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679364285"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">a -&gt; Maybe a
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679364286"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe (Deque t)
</span><a href="#local-6989586621679364306"><span class="hs-identifier hs-var">queue</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-189"></span><span>                            </span><span class="annot"><a href="Streamly.Internal.Data.Pipe.Types.html#Continue"><span class="hs-identifier hs-type">Continue</span></a></span><span> </span><span id="local-6989586621679364284"><span class="annot"><span class="annottext">s :: a
</span><a href="#local-6989586621679364284"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679364284"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe a
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe (Deque t)
</span><a href="#local-6989586621679364306"><span class="hs-identifier hs-var">queue</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-190"></span><span>
</span><span id="line-191"></span><span>        </span><span class="hs-pragma">{-# INLINE_LATE produce #-}</span><span>
</span><span id="line-192"></span><span>        </span><span id="local-6989586621679364330"><span class="annot"><span class="annottext">produce :: Tuple'
  (PipeState s1 s2, Maybe a, Maybe (Deque i))
  (PipeState s1 s2, Maybe b, Maybe (Deque i))
-&gt; m (Step
        (PipeState
           (Tuple'
              (PipeState s1 s2, Maybe a, Maybe (Deque i))
              (PipeState s1 s2, Maybe b, Maybe (Deque i)))
           (Tuple'
              (PipeState s1 s2, Maybe a, Maybe (Deque i))
              (PipeState s1 s2, Maybe b, Maybe (Deque i))))
        c)
</span><a href="#local-6989586621679364330"><span class="hs-identifier hs-var hs-var">produce</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Streamly.Internal.Data.Tuple.Strict.html#Tuple%27"><span class="hs-identifier hs-type">Tuple'</span></a></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679364283"><span class="annot"><span class="annottext">sL :: PipeState s1 s2
</span><a href="#local-6989586621679364283"><span class="hs-identifier hs-var">sL</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679364282"><span class="annot"><span class="annottext">resL :: Maybe a
</span><a href="#local-6989586621679364282"><span class="hs-identifier hs-var">resL</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679364281"><span class="annot"><span class="annottext">lq :: Maybe (Deque i)
</span><a href="#local-6989586621679364281"><span class="hs-identifier hs-var">lq</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span id="local-6989586621679364280"><span class="annot"><span class="annottext">sR :: PipeState s1 s2
</span><a href="#local-6989586621679364280"><span class="hs-identifier hs-var">sR</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679364279"><span class="annot"><span class="annottext">resR :: Maybe b
</span><a href="#local-6989586621679364279"><span class="hs-identifier hs-var">resR</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679364278"><span class="annot"><span class="annottext">rq :: Maybe (Deque i)
</span><a href="#local-6989586621679364278"><span class="hs-identifier hs-var">rq</span></a></span></span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-193"></span><span>            </span><span id="local-6989586621679364277"><span class="annot"><span class="annottext">(PipeState s1 s2, Maybe a, Maybe (Deque i))
</span><a href="#local-6989586621679364277"><span class="hs-identifier hs-var">s1</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PipeState s1 s2
-&gt; Maybe a
-&gt; Maybe (Deque i)
-&gt; (s1 -&gt; i -&gt; m (Step (PipeState s1 s2) a))
-&gt; (s2 -&gt; m (Step (PipeState s1 s2) a))
-&gt; m (PipeState s1 s2, Maybe a, Maybe (Deque i))
forall (m :: * -&gt; *) t t a t.
Monad m =&gt;
PipeState t t
-&gt; Maybe a
-&gt; Maybe (Deque t)
-&gt; (t -&gt; t -&gt; m (Step (PipeState t t) a))
-&gt; (t -&gt; m (Step (PipeState t t) a))
-&gt; m (PipeState t t, Maybe a, Maybe (Deque t))
</span><a href="#local-6989586621679364276"><span class="hs-identifier hs-var">drive</span></a></span><span> </span><span class="annot"><span class="annottext">PipeState s1 s2
</span><a href="#local-6989586621679364283"><span class="hs-identifier hs-var">sL</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe a
</span><a href="#local-6989586621679364282"><span class="hs-identifier hs-var">resL</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (Deque i)
</span><a href="#local-6989586621679364281"><span class="hs-identifier hs-var">lq</span></a></span><span> </span><span class="annot"><span class="annottext">s1 -&gt; i -&gt; m (Step (PipeState s1 s2) a)
</span><a href="#local-6989586621679364337"><span class="hs-identifier hs-var">consumeL</span></a></span><span> </span><span class="annot"><span class="annottext">s2 -&gt; m (Step (PipeState s1 s2) a)
</span><a href="#local-6989586621679364336"><span class="hs-identifier hs-var">produceL</span></a></span><span>
</span><span id="line-194"></span><span>            </span><span id="local-6989586621679364275"><span class="annot"><span class="annottext">(PipeState s1 s2, Maybe b, Maybe (Deque i))
</span><a href="#local-6989586621679364275"><span class="hs-identifier hs-var">s2</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">PipeState s1 s2
-&gt; Maybe b
-&gt; Maybe (Deque i)
-&gt; (s1 -&gt; i -&gt; m (Step (PipeState s1 s2) b))
-&gt; (s2 -&gt; m (Step (PipeState s1 s2) b))
-&gt; m (PipeState s1 s2, Maybe b, Maybe (Deque i))
forall (m :: * -&gt; *) t t a t.
Monad m =&gt;
PipeState t t
-&gt; Maybe a
-&gt; Maybe (Deque t)
-&gt; (t -&gt; t -&gt; m (Step (PipeState t t) a))
-&gt; (t -&gt; m (Step (PipeState t t) a))
-&gt; m (PipeState t t, Maybe a, Maybe (Deque t))
</span><a href="#local-6989586621679364276"><span class="hs-identifier hs-var">drive</span></a></span><span> </span><span class="annot"><span class="annottext">PipeState s1 s2
</span><a href="#local-6989586621679364280"><span class="hs-identifier hs-var">sR</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe b
</span><a href="#local-6989586621679364279"><span class="hs-identifier hs-var">resR</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (Deque i)
</span><a href="#local-6989586621679364278"><span class="hs-identifier hs-var">rq</span></a></span><span> </span><span class="annot"><span class="annottext">s1 -&gt; i -&gt; m (Step (PipeState s1 s2) b)
</span><a href="#local-6989586621679364334"><span class="hs-identifier hs-var">consumeR</span></a></span><span> </span><span class="annot"><span class="annottext">s2 -&gt; m (Step (PipeState s1 s2) b)
</span><a href="#local-6989586621679364333"><span class="hs-identifier hs-var">produceR</span></a></span><span>
</span><span id="line-195"></span><span>            </span><span class="annot"><span class="annottext">(PipeState s1 s2, Maybe a, Maybe (Deque i))
-&gt; (PipeState s1 s2, Maybe b, Maybe (Deque i))
-&gt; m (Step
        (PipeState
           (Tuple'
              (PipeState s1 s2, Maybe a, Maybe (Deque i))
              (PipeState s1 s2, Maybe b, Maybe (Deque i)))
           (Tuple'
              (PipeState s1 s2, Maybe a, Maybe (Deque i))
              (PipeState s1 s2, Maybe b, Maybe (Deque i))))
        c)
forall (m :: * -&gt; *) s1 s2 a s1 s2 a.
Monad m =&gt;
(PipeState s1 s2, Maybe a, Maybe a)
-&gt; (PipeState s1 s2, Maybe b, Maybe a)
-&gt; m (Step
        (PipeState
           (Tuple'
              (PipeState s1 s2, Maybe a, Maybe a)
              (PipeState s1 s2, Maybe b, Maybe a))
           (Tuple'
              (PipeState s1 s2, Maybe a, Maybe a)
              (PipeState s1 s2, Maybe b, Maybe a)))
        c)
</span><a href="#local-6989586621679364317"><span class="hs-identifier hs-var">yieldOutput</span></a></span><span> </span><span class="annot"><span class="annottext">(PipeState s1 s2, Maybe a, Maybe (Deque i))
</span><a href="#local-6989586621679364277"><span class="hs-identifier hs-var">s1</span></a></span><span> </span><span class="annot"><span class="annottext">(PipeState s1 s2, Maybe b, Maybe (Deque i))
</span><a href="#local-6989586621679364275"><span class="hs-identifier hs-var">s2</span></a></span><span>
</span><span id="line-196"></span><span>
</span><span id="line-197"></span><span>            </span><span class="hs-keyword">where</span><span>
</span><span id="line-198"></span><span>
</span><span id="line-199"></span><span>            </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="#local-6989586621679364276"><span class="hs-pragma hs-type">drive</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-200"></span><span>            </span><span id="local-6989586621679364276"><span class="annot"><span class="annottext">drive :: PipeState t t
-&gt; Maybe a
-&gt; Maybe (Deque t)
-&gt; (t -&gt; t -&gt; m (Step (PipeState t t) a))
-&gt; (t -&gt; m (Step (PipeState t t) a))
-&gt; m (PipeState t t, Maybe a, Maybe (Deque t))
</span><a href="#local-6989586621679364276"><span class="hs-identifier hs-var hs-var">drive</span></a></span></span><span> </span><span id="local-6989586621679364274"><span class="annot"><span class="annottext">stt :: PipeState t t
</span><a href="#local-6989586621679364274"><span class="hs-identifier hs-var">stt</span></a></span></span><span> </span><span id="local-6989586621679364273"><span class="annot"><span class="annottext">res :: Maybe a
</span><a href="#local-6989586621679364273"><span class="hs-identifier hs-var">res</span></a></span></span><span> </span><span id="local-6989586621679364272"><span class="annot"><span class="annottext">q :: Maybe (Deque t)
</span><a href="#local-6989586621679364272"><span class="hs-identifier hs-var">q</span></a></span></span><span> </span><span id="local-6989586621679364271"><span class="annot"><span class="annottext">fConsume :: t -&gt; t -&gt; m (Step (PipeState t t) a)
</span><a href="#local-6989586621679364271"><span class="hs-identifier hs-var">fConsume</span></a></span></span><span> </span><span id="local-6989586621679364270"><span class="annot"><span class="annottext">fProduce :: t -&gt; m (Step (PipeState t t) a)
</span><a href="#local-6989586621679364270"><span class="hs-identifier hs-var">fProduce</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-201"></span><span>                </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe a
</span><a href="#local-6989586621679364273"><span class="hs-identifier hs-var">res</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-202"></span><span>                    </span><span class="annot"><span class="hs-identifier hs-type">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PipeState t t
-&gt; Maybe (Deque t)
-&gt; (t -&gt; t -&gt; m (Step (PipeState t t) a))
-&gt; (t -&gt; m (Step (PipeState t t) a))
-&gt; m (PipeState t t, Maybe a, Maybe (Deque t))
forall (m :: * -&gt; *) t t t a.
Monad m =&gt;
PipeState t t
-&gt; Maybe (Deque t)
-&gt; (t -&gt; t -&gt; m (Step (PipeState t t) a))
-&gt; (t -&gt; m (Step (PipeState t t) a))
-&gt; m (PipeState t t, Maybe a, Maybe (Deque t))
</span><a href="#local-6989586621679364269"><span class="hs-identifier hs-var">goProduce</span></a></span><span> </span><span class="annot"><span class="annottext">PipeState t t
</span><a href="#local-6989586621679364274"><span class="hs-identifier hs-var">stt</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe (Deque t)
</span><a href="#local-6989586621679364272"><span class="hs-identifier hs-var">q</span></a></span><span> </span><span class="annot"><span class="annottext">t -&gt; t -&gt; m (Step (PipeState t t) a)
</span><a href="#local-6989586621679364271"><span class="hs-identifier hs-var">fConsume</span></a></span><span> </span><span class="annot"><span class="annottext">t -&gt; m (Step (PipeState t t) a)
</span><a href="#local-6989586621679364270"><span class="hs-identifier hs-var">fProduce</span></a></span><span>
</span><span id="line-203"></span><span>                    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679364268"><span class="annot"><span class="annottext">x :: a
</span><a href="#local-6989586621679364268"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(PipeState t t, Maybe a, Maybe (Deque t))
-&gt; m (PipeState t t, Maybe a, Maybe (Deque t))
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PipeState t t
</span><a href="#local-6989586621679364274"><span class="hs-identifier hs-var">stt</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">a -&gt; Maybe a
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679364268"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe (Deque t)
</span><a href="#local-6989586621679364272"><span class="hs-identifier hs-var">q</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-204"></span><span>
</span><span id="line-205"></span><span>            </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="#local-6989586621679364269"><span class="hs-pragma hs-type">goProduce</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-206"></span><span>            </span><span id="local-6989586621679364269"><span class="annot"><span class="annottext">goProduce :: PipeState t t
-&gt; Maybe (Deque t)
-&gt; (t -&gt; t -&gt; m (Step (PipeState t t) a))
-&gt; (t -&gt; m (Step (PipeState t t) a))
-&gt; m (PipeState t t, Maybe a, Maybe (Deque t))
</span><a href="#local-6989586621679364269"><span class="hs-identifier hs-var hs-var">goProduce</span></a></span></span><span> </span><span id="local-6989586621679364267"><span class="annot"><span class="annottext">stt :: PipeState t t
</span><a href="#local-6989586621679364267"><span class="hs-identifier hs-var">stt</span></a></span></span><span> </span><span id="local-6989586621679364266"><span class="annot"><span class="annottext">queue :: Maybe (Deque t)
</span><a href="#local-6989586621679364266"><span class="hs-identifier hs-var">queue</span></a></span></span><span> </span><span id="local-6989586621679364265"><span class="annot"><span class="annottext">fConsume :: t -&gt; t -&gt; m (Step (PipeState t t) a)
</span><a href="#local-6989586621679364265"><span class="hs-identifier hs-var">fConsume</span></a></span></span><span> </span><span id="local-6989586621679364264"><span class="annot"><span class="annottext">fProduce :: t -&gt; m (Step (PipeState t t) a)
</span><a href="#local-6989586621679364264"><span class="hs-identifier hs-var">fProduce</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-207"></span><span>                </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">PipeState t t
</span><a href="#local-6989586621679364267"><span class="hs-identifier hs-var">stt</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-208"></span><span>                    </span><span class="annot"><a href="Streamly.Internal.Data.Pipe.Types.html#Consume"><span class="hs-identifier hs-type">Consume</span></a></span><span> </span><span id="local-6989586621679364263"><span class="annot"><span class="annottext">st :: t
</span><a href="#local-6989586621679364263"><span class="hs-identifier hs-var">st</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-209"></span><span>                        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Maybe (Deque t)
</span><a href="#local-6989586621679364266"><span class="hs-identifier hs-var">queue</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-210"></span><span>                            </span><span class="hs-comment">-- See yieldOutput. We enter produce mode only when</span><span>
</span><span id="line-211"></span><span>                            </span><span class="hs-comment">-- each pipe is either in Produce state or the</span><span>
</span><span id="line-212"></span><span>                            </span><span class="hs-comment">-- queue is non-empty. So this case cannot occur.</span><span>
</span><span id="line-213"></span><span>                            </span><span class="annot"><span class="hs-identifier hs-type">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">m (PipeState t t, Maybe a, Maybe (Deque t))
forall a. HasCallStack =&gt; a
</span><span class="hs-identifier hs-var">undefined</span></span><span>
</span><span id="line-214"></span><span>                            </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679364262"><span class="annot"><span class="annottext">queue' :: Deque t
</span><a href="#local-6989586621679364262"><span class="hs-identifier hs-var">queue'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-215"></span><span>                                </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Deque t -&gt; Maybe (t, Deque t)
forall a. Deque a -&gt; Maybe (a, Deque a)
</span><a href="Streamly.Internal.Data.Pipe.Types.html#uncons"><span class="hs-identifier hs-var">uncons</span></a></span><span> </span><span class="annot"><span class="annottext">Deque t
</span><a href="#local-6989586621679364262"><span class="hs-identifier hs-var">queue'</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-216"></span><span>                                    </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679364261"><span class="annot"><span class="annottext">v :: t
</span><a href="#local-6989586621679364261"><span class="hs-identifier hs-var">v</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679364260"><span class="annot"><span class="annottext">q :: Deque t
</span><a href="#local-6989586621679364260"><span class="hs-identifier hs-var">q</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-217"></span><span>                                        </span><span id="local-6989586621679364259"><span class="annot"><span class="annottext">Step (PipeState t t) a
</span><a href="#local-6989586621679364259"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">t -&gt; t -&gt; m (Step (PipeState t t) a)
</span><a href="#local-6989586621679364265"><span class="hs-identifier hs-var">fConsume</span></a></span><span> </span><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621679364263"><span class="hs-identifier hs-var">st</span></a></span><span> </span><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621679364261"><span class="hs-identifier hs-var">v</span></a></span><span>
</span><span id="line-218"></span><span>                                        </span><span class="hs-comment">-- We provide a guarantee that if the</span><span>
</span><span id="line-219"></span><span>                                        </span><span class="hs-comment">-- queue is &quot;Just&quot; it is always</span><span>
</span><span id="line-220"></span><span>                                        </span><span class="hs-comment">-- non-empty. yieldOutput and goConsume</span><span>
</span><span id="line-221"></span><span>                                        </span><span class="hs-comment">-- depend on it.</span><span>
</span><span id="line-222"></span><span>                                        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679364258"><span class="annot"><span class="annottext">q' :: Maybe (Deque t)
</span><a href="#local-6989586621679364258"><span class="hs-identifier hs-var hs-var">q'</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">Deque t -&gt; Bool
forall a. Deque a -&gt; Bool
</span><a href="Streamly.Internal.Data.Pipe.Types.html#null"><span class="hs-identifier hs-var">null</span></a></span><span> </span><span class="annot"><span class="annottext">Deque t
</span><a href="#local-6989586621679364260"><span class="hs-identifier hs-var">q</span></a></span><span>
</span><span id="line-223"></span><span>                                                 </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">Maybe (Deque t)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span>
</span><span id="line-224"></span><span>                                                 </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">Deque t -&gt; Maybe (Deque t)
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">Deque t
</span><a href="#local-6989586621679364260"><span class="hs-identifier hs-var">q</span></a></span><span>
</span><span id="line-225"></span><span>                                        </span><span class="annot"><span class="annottext">(PipeState t t, Maybe a, Maybe (Deque t))
-&gt; m (PipeState t t, Maybe a, Maybe (Deque t))
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">((PipeState t t, Maybe a, Maybe (Deque t))
 -&gt; m (PipeState t t, Maybe a, Maybe (Deque t)))
-&gt; (PipeState t t, Maybe a, Maybe (Deque t))
-&gt; m (PipeState t t, Maybe a, Maybe (Deque t))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Step (PipeState t t) a
</span><a href="#local-6989586621679364259"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-226"></span><span>                                            </span><span class="annot"><a href="Streamly.Internal.Data.Pipe.Types.html#Yield"><span class="hs-identifier hs-type">Yield</span></a></span><span> </span><span id="local-6989586621679364257"><span class="annot"><span class="annottext">x :: a
</span><a href="#local-6989586621679364257"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621679364256"><span class="annot"><span class="annottext">s :: PipeState t t
</span><a href="#local-6989586621679364256"><span class="hs-identifier hs-var">s</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PipeState t t
</span><a href="#local-6989586621679364256"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">a -&gt; Maybe a
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679364257"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe (Deque t)
</span><a href="#local-6989586621679364258"><span class="hs-identifier hs-var">q'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-227"></span><span>                                            </span><span class="annot"><a href="Streamly.Internal.Data.Pipe.Types.html#Continue"><span class="hs-identifier hs-type">Continue</span></a></span><span> </span><span id="local-6989586621679364255"><span class="annot"><span class="annottext">s :: PipeState t t
</span><a href="#local-6989586621679364255"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PipeState t t
</span><a href="#local-6989586621679364255"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe a
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe (Deque t)
</span><a href="#local-6989586621679364258"><span class="hs-identifier hs-var">q'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-228"></span><span>                                    </span><span class="annot"><span class="hs-identifier hs-type">Nothing</span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">(PipeState t t, Maybe a, Maybe (Deque t))
-&gt; m (PipeState t t, Maybe a, Maybe (Deque t))
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PipeState t t
</span><a href="#local-6989586621679364267"><span class="hs-identifier hs-var">stt</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe a
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe (Deque t)
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">)</span><span>
</span><span id="line-229"></span><span>                    </span><span class="annot"><a href="Streamly.Internal.Data.Pipe.Types.html#Produce"><span class="hs-identifier hs-type">Produce</span></a></span><span> </span><span id="local-6989586621679364254"><span class="annot"><span class="annottext">st :: t
</span><a href="#local-6989586621679364254"><span class="hs-identifier hs-var">st</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-230"></span><span>                        </span><span id="local-6989586621679364253"><span class="annot"><span class="annottext">Step (PipeState t t) a
</span><a href="#local-6989586621679364253"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">t -&gt; m (Step (PipeState t t) a)
</span><a href="#local-6989586621679364264"><span class="hs-identifier hs-var">fProduce</span></a></span><span> </span><span class="annot"><span class="annottext">t
</span><a href="#local-6989586621679364254"><span class="hs-identifier hs-var">st</span></a></span><span>
</span><span id="line-231"></span><span>                        </span><span class="annot"><span class="annottext">(PipeState t t, Maybe a, Maybe (Deque t))
-&gt; m (PipeState t t, Maybe a, Maybe (Deque t))
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">((PipeState t t, Maybe a, Maybe (Deque t))
 -&gt; m (PipeState t t, Maybe a, Maybe (Deque t)))
-&gt; (PipeState t t, Maybe a, Maybe (Deque t))
-&gt; m (PipeState t t, Maybe a, Maybe (Deque t))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Step (PipeState t t) a
</span><a href="#local-6989586621679364253"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-232"></span><span>                            </span><span class="annot"><a href="Streamly.Internal.Data.Pipe.Types.html#Yield"><span class="hs-identifier hs-type">Yield</span></a></span><span> </span><span id="local-6989586621679364252"><span class="annot"><span class="annottext">x :: a
</span><a href="#local-6989586621679364252"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621679364251"><span class="annot"><span class="annottext">s :: PipeState t t
</span><a href="#local-6989586621679364251"><span class="hs-identifier hs-var">s</span></a></span></span><span>  </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PipeState t t
</span><a href="#local-6989586621679364251"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">a -&gt; Maybe a
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679364252"><span class="hs-identifier hs-var">x</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe (Deque t)
</span><a href="#local-6989586621679364266"><span class="hs-identifier hs-var">queue</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-233"></span><span>                            </span><span class="annot"><a href="Streamly.Internal.Data.Pipe.Types.html#Continue"><span class="hs-identifier hs-type">Continue</span></a></span><span> </span><span id="local-6989586621679364250"><span class="annot"><span class="annottext">s :: PipeState t t
</span><a href="#local-6989586621679364250"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PipeState t t
</span><a href="#local-6989586621679364250"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe a
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe (Deque t)
</span><a href="#local-6989586621679364266"><span class="hs-identifier hs-var">queue</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-234"></span><span>
</span><span id="line-235"></span><span>        </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="#local-6989586621679364317"><span class="hs-pragma hs-type">yieldOutput</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-236"></span><span>        </span><span id="local-6989586621679364317"><span class="annot"><span class="annottext">yieldOutput :: (PipeState s1 s2, Maybe a, Maybe a)
-&gt; (PipeState s1 s2, Maybe b, Maybe a)
-&gt; m (Step
        (PipeState
           (Tuple'
              (PipeState s1 s2, Maybe a, Maybe a)
              (PipeState s1 s2, Maybe b, Maybe a))
           (Tuple'
              (PipeState s1 s2, Maybe a, Maybe a)
              (PipeState s1 s2, Maybe b, Maybe a)))
        c)
</span><a href="#local-6989586621679364317"><span class="hs-identifier hs-var hs-var">yieldOutput</span></a></span></span><span> </span><span id="local-6989586621679364249"><span class="annot"><span class="annottext">s1 :: (PipeState s1 s2, Maybe a, Maybe a)
</span><a href="#local-6989586621679364249"><span class="hs-identifier hs-var">s1</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span id="local-6989586621679364248"><span class="annot"><span class="annottext">sL' :: PipeState s1 s2
</span><a href="#local-6989586621679364248"><span class="hs-identifier hs-var">sL'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679364247"><span class="annot"><span class="annottext">resL' :: Maybe a
</span><a href="#local-6989586621679364247"><span class="hs-identifier hs-var">resL'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679364246"><span class="annot"><span class="annottext">lq' :: Maybe a
</span><a href="#local-6989586621679364246"><span class="hs-identifier hs-var">lq'</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679364245"><span class="annot"><span class="annottext">s2 :: (PipeState s1 s2, Maybe b, Maybe a)
</span><a href="#local-6989586621679364245"><span class="hs-identifier hs-var">s2</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span id="local-6989586621679364244"><span class="annot"><span class="annottext">sR' :: PipeState s1 s2
</span><a href="#local-6989586621679364244"><span class="hs-identifier hs-var">sR'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679364243"><span class="annot"><span class="annottext">resR' :: Maybe b
</span><a href="#local-6989586621679364243"><span class="hs-identifier hs-var">resR'</span></a></span></span><span class="hs-special">,</span><span> </span><span id="local-6989586621679364242"><span class="annot"><span class="annottext">rq' :: Maybe a
</span><a href="#local-6989586621679364242"><span class="hs-identifier hs-var">rq'</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Step
  (PipeState
     (Tuple'
        (PipeState s1 s2, Maybe a, Maybe a)
        (PipeState s1 s2, Maybe b, Maybe a))
     (Tuple'
        (PipeState s1 s2, Maybe a, Maybe a)
        (PipeState s1 s2, Maybe b, Maybe a)))
  c
-&gt; m (Step
        (PipeState
           (Tuple'
              (PipeState s1 s2, Maybe a, Maybe a)
              (PipeState s1 s2, Maybe b, Maybe a))
           (Tuple'
              (PipeState s1 s2, Maybe a, Maybe a)
              (PipeState s1 s2, Maybe b, Maybe a)))
        c)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Step
   (PipeState
      (Tuple'
         (PipeState s1 s2, Maybe a, Maybe a)
         (PipeState s1 s2, Maybe b, Maybe a))
      (Tuple'
         (PipeState s1 s2, Maybe a, Maybe a)
         (PipeState s1 s2, Maybe b, Maybe a)))
   c
 -&gt; m (Step
         (PipeState
            (Tuple'
               (PipeState s1 s2, Maybe a, Maybe a)
               (PipeState s1 s2, Maybe b, Maybe a))
            (Tuple'
               (PipeState s1 s2, Maybe a, Maybe a)
               (PipeState s1 s2, Maybe b, Maybe a)))
         c))
-&gt; Step
     (PipeState
        (Tuple'
           (PipeState s1 s2, Maybe a, Maybe a)
           (PipeState s1 s2, Maybe b, Maybe a))
        (Tuple'
           (PipeState s1 s2, Maybe a, Maybe a)
           (PipeState s1 s2, Maybe b, Maybe a)))
     c
-&gt; m (Step
        (PipeState
           (Tuple'
              (PipeState s1 s2, Maybe a, Maybe a)
              (PipeState s1 s2, Maybe b, Maybe a))
           (Tuple'
              (PipeState s1 s2, Maybe a, Maybe a)
              (PipeState s1 s2, Maybe b, Maybe a)))
        c)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span>
</span><span id="line-237"></span><span>            </span><span class="hs-comment">-- switch to produce mode if we do not need input</span><span>
</span><span id="line-238"></span><span>            </span><span class="hs-keyword">if</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PipeState s1 s2 -&gt; Bool
forall s1 s2. PipeState s1 s2 -&gt; Bool
</span><a href="Streamly.Internal.Data.Pipe.Types.html#isProduce"><span class="hs-identifier hs-var">isProduce</span></a></span><span> </span><span class="annot"><span class="annottext">PipeState s1 s2
</span><a href="#local-6989586621679364248"><span class="hs-identifier hs-var">sL'</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Maybe a -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><span class="hs-identifier hs-var">isJust</span></span><span> </span><span class="annot"><span class="annottext">Maybe a
</span><a href="#local-6989586621679364246"><span class="hs-identifier hs-var">lq'</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">&amp;&amp;</span></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PipeState s1 s2 -&gt; Bool
forall s1 s2. PipeState s1 s2 -&gt; Bool
</span><a href="Streamly.Internal.Data.Pipe.Types.html#isProduce"><span class="hs-identifier hs-var">isProduce</span></a></span><span> </span><span class="annot"><span class="annottext">PipeState s1 s2
</span><a href="#local-6989586621679364244"><span class="hs-identifier hs-var">sR'</span></a></span><span> </span><span class="annot"><span class="annottext">Bool -&gt; Bool -&gt; Bool
</span><span class="hs-operator hs-var">||</span></span><span> </span><span class="annot"><span class="annottext">Maybe a -&gt; Bool
forall a. Maybe a -&gt; Bool
</span><span class="hs-identifier hs-var">isJust</span></span><span> </span><span class="annot"><span class="annottext">Maybe a
</span><a href="#local-6989586621679364242"><span class="hs-identifier hs-var">rq'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-239"></span><span>            </span><span class="hs-keyword">then</span><span>
</span><span id="line-240"></span><span>                </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe a
</span><a href="#local-6989586621679364247"><span class="hs-identifier hs-var">resL'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe b
</span><a href="#local-6989586621679364243"><span class="hs-identifier hs-var">resR'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-241"></span><span>                    </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679364239"><span class="annot"><span class="annottext">xL :: a
</span><a href="#local-6989586621679364239"><span class="hs-identifier hs-var">xL</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679364238"><span class="annot"><span class="annottext">xR :: b
</span><a href="#local-6989586621679364238"><span class="hs-identifier hs-var">xR</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-242"></span><span>                        </span><span class="annot"><span class="annottext">c
-&gt; PipeState
     (Tuple'
        (PipeState s1 s2, Maybe a, Maybe a)
        (PipeState s1 s2, Maybe b, Maybe a))
     (Tuple'
        (PipeState s1 s2, Maybe a, Maybe a)
        (PipeState s1 s2, Maybe b, Maybe a))
-&gt; Step
     (PipeState
        (Tuple'
           (PipeState s1 s2, Maybe a, Maybe a)
           (PipeState s1 s2, Maybe b, Maybe a))
        (Tuple'
           (PipeState s1 s2, Maybe a, Maybe a)
           (PipeState s1 s2, Maybe b, Maybe a)))
     c
forall s a. a -&gt; s -&gt; Step s a
</span><a href="Streamly.Internal.Data.Pipe.Types.html#Yield"><span class="hs-identifier hs-var">Yield</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; b -&gt; c
</span><a href="#local-6989586621679364338"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679364239"><span class="hs-identifier hs-var">xL</span></a></span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679364238"><span class="hs-identifier hs-var">xR</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Tuple'
  (PipeState s1 s2, Maybe a, Maybe a)
  (PipeState s1 s2, Maybe b, Maybe a)
-&gt; PipeState
     (Tuple'
        (PipeState s1 s2, Maybe a, Maybe a)
        (PipeState s1 s2, Maybe b, Maybe a))
     (Tuple'
        (PipeState s1 s2, Maybe a, Maybe a)
        (PipeState s1 s2, Maybe b, Maybe a))
forall s1 s2. s2 -&gt; PipeState s1 s2
</span><a href="Streamly.Internal.Data.Pipe.Types.html#Produce"><span class="hs-identifier hs-var">Produce</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(PipeState s1 s2, Maybe a, Maybe a)
-&gt; (PipeState s1 s2, Maybe b, Maybe a)
-&gt; Tuple'
     (PipeState s1 s2, Maybe a, Maybe a)
     (PipeState s1 s2, Maybe b, Maybe a)
forall a b. a -&gt; b -&gt; Tuple' a b
</span><a href="Streamly.Internal.Data.Tuple.Strict.html#Tuple%27"><span class="hs-identifier hs-var">Tuple'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(PipeState s1 s2, Maybe a, Maybe a)
-&gt; (PipeState s1 s2, Maybe a, Maybe a)
forall a b c a. (a, b, c) -&gt; (a, Maybe a, c)
</span><a href="#local-6989586621679364237"><span class="hs-identifier hs-var">clear</span></a></span><span> </span><span class="annot"><span class="annottext">(PipeState s1 s2, Maybe a, Maybe a)
</span><a href="#local-6989586621679364249"><span class="hs-identifier hs-var">s1</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(PipeState s1 s2, Maybe b, Maybe a)
-&gt; (PipeState s1 s2, Maybe b, Maybe a)
forall a b c a. (a, b, c) -&gt; (a, Maybe a, c)
</span><a href="#local-6989586621679364237"><span class="hs-identifier hs-var">clear</span></a></span><span> </span><span class="annot"><span class="annottext">(PipeState s1 s2, Maybe b, Maybe a)
</span><a href="#local-6989586621679364245"><span class="hs-identifier hs-var">s2</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-243"></span><span>                    </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PipeState
  (Tuple'
     (PipeState s1 s2, Maybe a, Maybe a)
     (PipeState s1 s2, Maybe b, Maybe a))
  (Tuple'
     (PipeState s1 s2, Maybe a, Maybe a)
     (PipeState s1 s2, Maybe b, Maybe a))
-&gt; Step
     (PipeState
        (Tuple'
           (PipeState s1 s2, Maybe a, Maybe a)
           (PipeState s1 s2, Maybe b, Maybe a))
        (Tuple'
           (PipeState s1 s2, Maybe a, Maybe a)
           (PipeState s1 s2, Maybe b, Maybe a)))
     c
forall s a. s -&gt; Step s a
</span><a href="Streamly.Internal.Data.Pipe.Types.html#Continue"><span class="hs-identifier hs-var">Continue</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Tuple'
  (PipeState s1 s2, Maybe a, Maybe a)
  (PipeState s1 s2, Maybe b, Maybe a)
-&gt; PipeState
     (Tuple'
        (PipeState s1 s2, Maybe a, Maybe a)
        (PipeState s1 s2, Maybe b, Maybe a))
     (Tuple'
        (PipeState s1 s2, Maybe a, Maybe a)
        (PipeState s1 s2, Maybe b, Maybe a))
forall s1 s2. s2 -&gt; PipeState s1 s2
</span><a href="Streamly.Internal.Data.Pipe.Types.html#Produce"><span class="hs-identifier hs-var">Produce</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(PipeState s1 s2, Maybe a, Maybe a)
-&gt; (PipeState s1 s2, Maybe b, Maybe a)
-&gt; Tuple'
     (PipeState s1 s2, Maybe a, Maybe a)
     (PipeState s1 s2, Maybe b, Maybe a)
forall a b. a -&gt; b -&gt; Tuple' a b
</span><a href="Streamly.Internal.Data.Tuple.Strict.html#Tuple%27"><span class="hs-identifier hs-var">Tuple'</span></a></span><span> </span><span class="annot"><span class="annottext">(PipeState s1 s2, Maybe a, Maybe a)
</span><a href="#local-6989586621679364249"><span class="hs-identifier hs-var">s1</span></a></span><span> </span><span class="annot"><span class="annottext">(PipeState s1 s2, Maybe b, Maybe a)
</span><a href="#local-6989586621679364245"><span class="hs-identifier hs-var">s2</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-244"></span><span>            </span><span class="hs-keyword">else</span><span>
</span><span id="line-245"></span><span>                </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe a
</span><a href="#local-6989586621679364247"><span class="hs-identifier hs-var">resL'</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe b
</span><a href="#local-6989586621679364243"><span class="hs-identifier hs-var">resR'</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-246"></span><span>                    </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679364236"><span class="annot"><span class="annottext">xL :: a
</span><a href="#local-6989586621679364236"><span class="hs-identifier hs-var">xL</span></a></span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679364235"><span class="annot"><span class="annottext">xR :: b
</span><a href="#local-6989586621679364235"><span class="hs-identifier hs-var">xR</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-247"></span><span>                        </span><span class="annot"><span class="annottext">c
-&gt; PipeState
     (Tuple'
        (PipeState s1 s2, Maybe a, Maybe a)
        (PipeState s1 s2, Maybe b, Maybe a))
     (Tuple'
        (PipeState s1 s2, Maybe a, Maybe a)
        (PipeState s1 s2, Maybe b, Maybe a))
-&gt; Step
     (PipeState
        (Tuple'
           (PipeState s1 s2, Maybe a, Maybe a)
           (PipeState s1 s2, Maybe b, Maybe a))
        (Tuple'
           (PipeState s1 s2, Maybe a, Maybe a)
           (PipeState s1 s2, Maybe b, Maybe a)))
     c
forall s a. a -&gt; s -&gt; Step s a
</span><a href="Streamly.Internal.Data.Pipe.Types.html#Yield"><span class="hs-identifier hs-var">Yield</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; b -&gt; c
</span><a href="#local-6989586621679364338"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679364236"><span class="hs-identifier hs-var">xL</span></a></span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679364235"><span class="hs-identifier hs-var">xR</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Tuple'
  (PipeState s1 s2, Maybe a, Maybe a)
  (PipeState s1 s2, Maybe b, Maybe a)
-&gt; PipeState
     (Tuple'
        (PipeState s1 s2, Maybe a, Maybe a)
        (PipeState s1 s2, Maybe b, Maybe a))
     (Tuple'
        (PipeState s1 s2, Maybe a, Maybe a)
        (PipeState s1 s2, Maybe b, Maybe a))
forall s1 s2. s1 -&gt; PipeState s1 s2
</span><a href="Streamly.Internal.Data.Pipe.Types.html#Consume"><span class="hs-identifier hs-var">Consume</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(PipeState s1 s2, Maybe a, Maybe a)
-&gt; (PipeState s1 s2, Maybe b, Maybe a)
-&gt; Tuple'
     (PipeState s1 s2, Maybe a, Maybe a)
     (PipeState s1 s2, Maybe b, Maybe a)
forall a b. a -&gt; b -&gt; Tuple' a b
</span><a href="Streamly.Internal.Data.Tuple.Strict.html#Tuple%27"><span class="hs-identifier hs-var">Tuple'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(PipeState s1 s2, Maybe a, Maybe a)
-&gt; (PipeState s1 s2, Maybe a, Maybe a)
forall a b c a. (a, b, c) -&gt; (a, Maybe a, c)
</span><a href="#local-6989586621679364237"><span class="hs-identifier hs-var">clear</span></a></span><span> </span><span class="annot"><span class="annottext">(PipeState s1 s2, Maybe a, Maybe a)
</span><a href="#local-6989586621679364249"><span class="hs-identifier hs-var">s1</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(PipeState s1 s2, Maybe b, Maybe a)
-&gt; (PipeState s1 s2, Maybe b, Maybe a)
forall a b c a. (a, b, c) -&gt; (a, Maybe a, c)
</span><a href="#local-6989586621679364237"><span class="hs-identifier hs-var">clear</span></a></span><span> </span><span class="annot"><span class="annottext">(PipeState s1 s2, Maybe b, Maybe a)
</span><a href="#local-6989586621679364245"><span class="hs-identifier hs-var">s2</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-248"></span><span>                    </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PipeState
  (Tuple'
     (PipeState s1 s2, Maybe a, Maybe a)
     (PipeState s1 s2, Maybe b, Maybe a))
  (Tuple'
     (PipeState s1 s2, Maybe a, Maybe a)
     (PipeState s1 s2, Maybe b, Maybe a))
-&gt; Step
     (PipeState
        (Tuple'
           (PipeState s1 s2, Maybe a, Maybe a)
           (PipeState s1 s2, Maybe b, Maybe a))
        (Tuple'
           (PipeState s1 s2, Maybe a, Maybe a)
           (PipeState s1 s2, Maybe b, Maybe a)))
     c
forall s a. s -&gt; Step s a
</span><a href="Streamly.Internal.Data.Pipe.Types.html#Continue"><span class="hs-identifier hs-var">Continue</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Tuple'
  (PipeState s1 s2, Maybe a, Maybe a)
  (PipeState s1 s2, Maybe b, Maybe a)
-&gt; PipeState
     (Tuple'
        (PipeState s1 s2, Maybe a, Maybe a)
        (PipeState s1 s2, Maybe b, Maybe a))
     (Tuple'
        (PipeState s1 s2, Maybe a, Maybe a)
        (PipeState s1 s2, Maybe b, Maybe a))
forall s1 s2. s1 -&gt; PipeState s1 s2
</span><a href="Streamly.Internal.Data.Pipe.Types.html#Consume"><span class="hs-identifier hs-var">Consume</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">(PipeState s1 s2, Maybe a, Maybe a)
-&gt; (PipeState s1 s2, Maybe b, Maybe a)
-&gt; Tuple'
     (PipeState s1 s2, Maybe a, Maybe a)
     (PipeState s1 s2, Maybe b, Maybe a)
forall a b. a -&gt; b -&gt; Tuple' a b
</span><a href="Streamly.Internal.Data.Tuple.Strict.html#Tuple%27"><span class="hs-identifier hs-var">Tuple'</span></a></span><span> </span><span class="annot"><span class="annottext">(PipeState s1 s2, Maybe a, Maybe a)
</span><a href="#local-6989586621679364249"><span class="hs-identifier hs-var">s1</span></a></span><span> </span><span class="annot"><span class="annottext">(PipeState s1 s2, Maybe b, Maybe a)
</span><a href="#local-6989586621679364245"><span class="hs-identifier hs-var">s2</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-249"></span><span>            </span><span class="hs-keyword">where</span><span> </span><span id="local-6989586621679364237"><span class="annot"><span class="annottext">clear :: (a, b, c) -&gt; (a, Maybe a, c)
</span><a href="#local-6989586621679364237"><span class="hs-identifier hs-var hs-var">clear</span></a></span></span><span> </span><span class="hs-special">(</span><span id="local-6989586621679364234"><span class="annot"><span class="annottext">s :: a
</span><a href="#local-6989586621679364234"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><span id="local-6989586621679364233"><span class="annot"><span class="annottext">q :: c
</span><a href="#local-6989586621679364233"><span class="hs-identifier hs-var">q</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679364234"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">Maybe a
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span class="hs-special">,</span><span> </span><span class="annot"><span class="annottext">c
</span><a href="#local-6989586621679364233"><span class="hs-identifier hs-var">q</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-250"></span><span>
</span><span id="line-251"></span><span id="local-6989586621679364231"><span id="local-6989586621679364232"><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679364222"><span id="local-6989586621679364224"><span id="local-6989586621679364226"><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621679364232"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Applicative</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Streamly.Internal.Data.Pipe.Types.html#Pipe"><span class="hs-identifier hs-type">Pipe</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679364232"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679364231"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">)</span></span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-252"></span><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><span class="hs-pragma hs-type">pure</span></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-253"></span><span>    </span><span id="local-6989586621679364220"><span class="annot"><span class="annottext">pure :: a -&gt; Pipe m a a
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">pure</span></span></span><span> </span><span id="local-6989586621679364219"><span class="annot"><span class="annottext">b :: a
</span><a href="#local-6989586621679364219"><span class="hs-identifier hs-var">b</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(() -&gt; a -&gt; m (Step (PipeState () Any) a))
-&gt; (Any -&gt; m (Step (PipeState () Any) a)) -&gt; () -&gt; Pipe m a a
forall (m :: * -&gt; *) a b s1 s2.
(s1 -&gt; a -&gt; m (Step (PipeState s1 s2) b))
-&gt; (s2 -&gt; m (Step (PipeState s1 s2) b)) -&gt; s1 -&gt; Pipe m a b
</span><a href="Streamly.Internal.Data.Pipe.Types.html#Pipe"><span class="hs-identifier hs-var">Pipe</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Step (PipeState () Any) a -&gt; m (Step (PipeState () Any) a)
forall (f :: * -&gt; *) a. Applicative f =&gt; a -&gt; f a
</span><span class="hs-identifier hs-var">pure</span></span><span> </span><span class="annot"><span class="annottext">(Step (PipeState () Any) a -&gt; m (Step (PipeState () Any) a))
-&gt; Step (PipeState () Any) a -&gt; m (Step (PipeState () Any) a)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">a -&gt; PipeState () Any -&gt; Step (PipeState () Any) a
forall s a. a -&gt; s -&gt; Step s a
</span><a href="Streamly.Internal.Data.Pipe.Types.html#Yield"><span class="hs-identifier hs-var">Yield</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679364219"><span class="hs-identifier hs-var">b</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">() -&gt; PipeState () Any
forall s1 s2. s1 -&gt; PipeState s1 s2
</span><a href="Streamly.Internal.Data.Pipe.Types.html#Consume"><span class="hs-identifier hs-var">Consume</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">Any -&gt; m (Step (PipeState () Any) a)
forall a. HasCallStack =&gt; a
</span><span class="hs-identifier hs-var">undefined</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-254"></span><span>
</span><span id="line-255"></span><span>    </span><span id="local-6989586621679364218"><span class="annot"><span class="annottext">&lt;*&gt; :: Pipe m a (a -&gt; b) -&gt; Pipe m a a -&gt; Pipe m a b
</span><span class="hs-operator hs-var hs-var hs-var hs-var">(&lt;*&gt;)</span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">((a -&gt; b) -&gt; a -&gt; b)
-&gt; Pipe m a (a -&gt; b) -&gt; Pipe m a a -&gt; Pipe m a b
forall (m :: * -&gt; *) a b c i.
Monad m =&gt;
(a -&gt; b -&gt; c) -&gt; Pipe m i a -&gt; Pipe m i b -&gt; Pipe m i c
</span><a href="Streamly.Internal.Data.Pipe.Types.html#zipWith"><span class="hs-identifier hs-var">zipWith</span></a></span><span> </span><span class="annot"><span class="annottext">(a -&gt; b) -&gt; a -&gt; b
forall k (cat :: k -&gt; k -&gt; *) (a :: k). Category cat =&gt; cat a a
</span><span class="hs-identifier hs-var">id</span></span></span></span><span>
</span><span id="line-256"></span><span>
</span><span id="line-257"></span><span class="hs-comment">-- | The composed pipe distributes the input to both the constituent pipes and</span><span>
</span><span id="line-258"></span><span class="hs-comment">-- merges the outputs of the two.</span><span>
</span><span id="line-259"></span><span class="hs-comment">--</span><span>
</span><span id="line-260"></span><span class="hs-comment">-- @since 0.7.0</span><span>
</span><span id="line-261"></span><span class="hs-pragma">{-# INLINE_NORMAL tee #-}</span><span>
</span><span id="line-262"></span><span id="local-6989586621679364214"><span id="local-6989586621679364215"><span id="local-6989586621679364216"><span class="annot"><a href="Streamly.Internal.Data.Pipe.Types.html#tee"><span class="hs-identifier hs-type">tee</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621679364216"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Pipe.Types.html#Pipe"><span class="hs-identifier hs-type">Pipe</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679364216"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679364215"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679364214"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Pipe.Types.html#Pipe"><span class="hs-identifier hs-type">Pipe</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679364216"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679364215"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679364214"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Pipe.Types.html#Pipe"><span class="hs-identifier hs-type">Pipe</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679364216"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679364215"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679364214"><span class="hs-identifier hs-type">b</span></a></span></span></span></span><span>
</span><span id="line-263"></span><span id="tee"><span class="annot"><span class="annottext">tee :: Pipe m a b -&gt; Pipe m a b -&gt; Pipe m a b
</span><a href="Streamly.Internal.Data.Pipe.Types.html#tee"><span class="hs-identifier hs-var hs-var">tee</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Streamly.Internal.Data.Pipe.Types.html#Pipe"><span class="hs-identifier hs-type">Pipe</span></a></span><span> </span><span id="local-6989586621679364213"><span class="annot"><span class="annottext">consumeL :: s1 -&gt; a -&gt; m (Step (PipeState s1 s2) b)
</span><a href="#local-6989586621679364213"><span class="hs-identifier hs-var">consumeL</span></a></span></span><span> </span><span id="local-6989586621679364212"><span class="annot"><span class="annottext">produceL :: s2 -&gt; m (Step (PipeState s1 s2) b)
</span><a href="#local-6989586621679364212"><span class="hs-identifier hs-var">produceL</span></a></span></span><span> </span><span id="local-6989586621679364211"><span class="annot"><span class="annottext">stateL :: s1
</span><a href="#local-6989586621679364211"><span class="hs-identifier hs-var">stateL</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Streamly.Internal.Data.Pipe.Types.html#Pipe"><span class="hs-identifier hs-type">Pipe</span></a></span><span> </span><span id="local-6989586621679364210"><span class="annot"><span class="annottext">consumeR :: s1 -&gt; a -&gt; m (Step (PipeState s1 s2) b)
</span><a href="#local-6989586621679364210"><span class="hs-identifier hs-var">consumeR</span></a></span></span><span> </span><span id="local-6989586621679364209"><span class="annot"><span class="annottext">produceR :: s2 -&gt; m (Step (PipeState s1 s2) b)
</span><a href="#local-6989586621679364209"><span class="hs-identifier hs-var">produceR</span></a></span></span><span> </span><span id="local-6989586621679364208"><span class="annot"><span class="annottext">stateR :: s1
</span><a href="#local-6989586621679364208"><span class="hs-identifier hs-var">stateR</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-264"></span><span>        </span><span class="annot"><span class="annottext">(Tuple' (PipeState s1 s2) (PipeState s1 s2)
 -&gt; a
 -&gt; m (Step
         (PipeState
            (Tuple' (PipeState s1 s2) (PipeState s1 s2))
            (Tuple3' (Maybe a) (PipeState s1 s2) (PipeState s1 s2)))
         b))
-&gt; (Tuple3' (Maybe a) (PipeState s1 s2) (PipeState s1 s2)
    -&gt; m (Step
            (PipeState
               (Tuple' (PipeState s1 s2) (PipeState s1 s2))
               (Tuple3' (Maybe a) (PipeState s1 s2) (PipeState s1 s2)))
            b))
-&gt; Tuple' (PipeState s1 s2) (PipeState s1 s2)
-&gt; Pipe m a b
forall (m :: * -&gt; *) a b s1 s2.
(s1 -&gt; a -&gt; m (Step (PipeState s1 s2) b))
-&gt; (s2 -&gt; m (Step (PipeState s1 s2) b)) -&gt; s1 -&gt; Pipe m a b
</span><a href="Streamly.Internal.Data.Pipe.Types.html#Pipe"><span class="hs-identifier hs-var">Pipe</span></a></span><span> </span><span class="annot"><span class="annottext">Tuple' (PipeState s1 s2) (PipeState s1 s2)
-&gt; a
-&gt; m (Step
        (PipeState
           (Tuple' (PipeState s1 s2) (PipeState s1 s2))
           (Tuple3' (Maybe a) (PipeState s1 s2) (PipeState s1 s2)))
        b)
forall s2 c s1.
Tuple' (PipeState s1 s2) c
-&gt; a
-&gt; m (Step
        (PipeState s1 (Tuple3' (Maybe a) (PipeState s1 s2) c)) b)
</span><a href="#local-6989586621679364207"><span class="hs-identifier hs-var">consume</span></a></span><span> </span><span class="annot"><span class="annottext">Tuple3' (Maybe a) (PipeState s1 s2) (PipeState s1 s2)
-&gt; m (Step
        (PipeState
           (Tuple' (PipeState s1 s2) (PipeState s1 s2))
           (Tuple3' (Maybe a) (PipeState s1 s2) (PipeState s1 s2)))
        b)
</span><a href="#local-6989586621679364206"><span class="hs-identifier hs-var">produce</span></a></span><span> </span><span class="annot"><span class="annottext">Tuple' (PipeState s1 s2) (PipeState s1 s2)
forall s2 s2. Tuple' (PipeState s1 s2) (PipeState s1 s2)
</span><a href="#local-6989586621679364205"><span class="hs-identifier hs-var">state</span></a></span><span>
</span><span id="line-265"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-266"></span><span>
</span><span id="line-267"></span><span>    </span><span id="local-6989586621679364205"><span class="annot"><span class="annottext">state :: Tuple' (PipeState s1 s2) (PipeState s1 s2)
</span><a href="#local-6989586621679364205"><span class="hs-identifier hs-var hs-var">state</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PipeState s1 s2
-&gt; PipeState s1 s2 -&gt; Tuple' (PipeState s1 s2) (PipeState s1 s2)
forall a b. a -&gt; b -&gt; Tuple' a b
</span><a href="Streamly.Internal.Data.Tuple.Strict.html#Tuple%27"><span class="hs-identifier hs-var">Tuple'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">s1 -&gt; PipeState s1 s2
forall s1 s2. s1 -&gt; PipeState s1 s2
</span><a href="Streamly.Internal.Data.Pipe.Types.html#Consume"><span class="hs-identifier hs-var">Consume</span></a></span><span> </span><span class="annot"><span class="annottext">s1
</span><a href="#local-6989586621679364211"><span class="hs-identifier hs-var">stateL</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">s1 -&gt; PipeState s1 s2
forall s1 s2. s1 -&gt; PipeState s1 s2
</span><a href="Streamly.Internal.Data.Pipe.Types.html#Consume"><span class="hs-identifier hs-var">Consume</span></a></span><span> </span><span class="annot"><span class="annottext">s1
</span><a href="#local-6989586621679364208"><span class="hs-identifier hs-var">stateR</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-268"></span><span>
</span><span id="line-269"></span><span>    </span><span id="local-6989586621679364207"><span class="annot"><span class="annottext">consume :: Tuple' (PipeState s1 s2) c
-&gt; a
-&gt; m (Step
        (PipeState s1 (Tuple3' (Maybe a) (PipeState s1 s2) c)) b)
</span><a href="#local-6989586621679364207"><span class="hs-identifier hs-var hs-var">consume</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Streamly.Internal.Data.Tuple.Strict.html#Tuple%27"><span class="hs-identifier hs-type">Tuple'</span></a></span><span> </span><span id="local-6989586621679364204"><span class="annot"><span class="annottext">sL :: PipeState s1 s2
</span><a href="#local-6989586621679364204"><span class="hs-identifier hs-var">sL</span></a></span></span><span> </span><span id="local-6989586621679364203"><span class="annot"><span class="annottext">sR :: c
</span><a href="#local-6989586621679364203"><span class="hs-identifier hs-var">sR</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679364202"><span class="annot"><span class="annottext">a :: a
</span><a href="#local-6989586621679364202"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-270"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">PipeState s1 s2
</span><a href="#local-6989586621679364204"><span class="hs-identifier hs-var">sL</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-271"></span><span>            </span><span class="annot"><a href="Streamly.Internal.Data.Pipe.Types.html#Consume"><span class="hs-identifier hs-type">Consume</span></a></span><span> </span><span id="local-6989586621679364201"><span class="annot"><span class="annottext">st :: s1
</span><a href="#local-6989586621679364201"><span class="hs-identifier hs-var">st</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-272"></span><span>                </span><span id="local-6989586621679364200"><span class="annot"><span class="annottext">Step (PipeState s1 s2) b
</span><a href="#local-6989586621679364200"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">s1 -&gt; a -&gt; m (Step (PipeState s1 s2) b)
</span><a href="#local-6989586621679364213"><span class="hs-identifier hs-var">consumeL</span></a></span><span> </span><span class="annot"><span class="annottext">s1
</span><a href="#local-6989586621679364201"><span class="hs-identifier hs-var">st</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679364202"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-273"></span><span>                </span><span class="annot"><span class="annottext">Step (PipeState s1 (Tuple3' (Maybe a) (PipeState s1 s2) c)) b
-&gt; m (Step
        (PipeState s1 (Tuple3' (Maybe a) (PipeState s1 s2) c)) b)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Step (PipeState s1 (Tuple3' (Maybe a) (PipeState s1 s2) c)) b
 -&gt; m (Step
         (PipeState s1 (Tuple3' (Maybe a) (PipeState s1 s2) c)) b))
-&gt; Step (PipeState s1 (Tuple3' (Maybe a) (PipeState s1 s2) c)) b
-&gt; m (Step
        (PipeState s1 (Tuple3' (Maybe a) (PipeState s1 s2) c)) b)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Step (PipeState s1 s2) b
</span><a href="#local-6989586621679364200"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-274"></span><span>                    </span><span class="annot"><a href="Streamly.Internal.Data.Pipe.Types.html#Yield"><span class="hs-identifier hs-type">Yield</span></a></span><span> </span><span id="local-6989586621679364199"><span class="annot"><span class="annottext">x :: b
</span><a href="#local-6989586621679364199"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621679364198"><span class="annot"><span class="annottext">s :: PipeState s1 s2
</span><a href="#local-6989586621679364198"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">b
-&gt; PipeState s1 (Tuple3' (Maybe a) (PipeState s1 s2) c)
-&gt; Step (PipeState s1 (Tuple3' (Maybe a) (PipeState s1 s2) c)) b
forall s a. a -&gt; s -&gt; Step s a
</span><a href="Streamly.Internal.Data.Pipe.Types.html#Yield"><span class="hs-identifier hs-var">Yield</span></a></span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679364199"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Tuple3' (Maybe a) (PipeState s1 s2) c
-&gt; PipeState s1 (Tuple3' (Maybe a) (PipeState s1 s2) c)
forall s1 s2. s2 -&gt; PipeState s1 s2
</span><a href="Streamly.Internal.Data.Pipe.Types.html#Produce"><span class="hs-identifier hs-var">Produce</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe a
-&gt; PipeState s1 s2 -&gt; c -&gt; Tuple3' (Maybe a) (PipeState s1 s2) c
forall a b c. a -&gt; b -&gt; c -&gt; Tuple3' a b c
</span><a href="Streamly.Internal.Data.Tuple.Strict.html#Tuple3%27"><span class="hs-identifier hs-var">Tuple3'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; Maybe a
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679364202"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">PipeState s1 s2
</span><a href="#local-6989586621679364198"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">c
</span><a href="#local-6989586621679364203"><span class="hs-identifier hs-var">sR</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-275"></span><span>                    </span><span class="annot"><a href="Streamly.Internal.Data.Pipe.Types.html#Continue"><span class="hs-identifier hs-type">Continue</span></a></span><span> </span><span id="local-6989586621679364196"><span class="annot"><span class="annottext">s :: PipeState s1 s2
</span><a href="#local-6989586621679364196"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PipeState s1 (Tuple3' (Maybe a) (PipeState s1 s2) c)
-&gt; Step (PipeState s1 (Tuple3' (Maybe a) (PipeState s1 s2) c)) b
forall s a. s -&gt; Step s a
</span><a href="Streamly.Internal.Data.Pipe.Types.html#Continue"><span class="hs-identifier hs-var">Continue</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Tuple3' (Maybe a) (PipeState s1 s2) c
-&gt; PipeState s1 (Tuple3' (Maybe a) (PipeState s1 s2) c)
forall s1 s2. s2 -&gt; PipeState s1 s2
</span><a href="Streamly.Internal.Data.Pipe.Types.html#Produce"><span class="hs-identifier hs-var">Produce</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe a
-&gt; PipeState s1 s2 -&gt; c -&gt; Tuple3' (Maybe a) (PipeState s1 s2) c
forall a b c. a -&gt; b -&gt; c -&gt; Tuple3' a b c
</span><a href="Streamly.Internal.Data.Tuple.Strict.html#Tuple3%27"><span class="hs-identifier hs-var">Tuple3'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; Maybe a
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679364202"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">PipeState s1 s2
</span><a href="#local-6989586621679364196"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">c
</span><a href="#local-6989586621679364203"><span class="hs-identifier hs-var">sR</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-276"></span><span>            </span><span class="hs-comment">-- XXX we should never come here unless the initial state of the</span><span>
</span><span id="line-277"></span><span>            </span><span class="hs-comment">-- first pipe is set to &quot;Right&quot;.</span><span>
</span><span id="line-278"></span><span>            </span><span class="annot"><a href="Streamly.Internal.Data.Pipe.Types.html#Produce"><span class="hs-identifier hs-type">Produce</span></a></span><span> </span><span id="local-6989586621679364195"><span class="annot"><span class="annottext">_st :: s2
</span><a href="#local-6989586621679364195"><span class="hs-identifier hs-var">_st</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">m (Step (PipeState s1 (Tuple3' (Maybe a) (PipeState s1 s2) c)) b)
forall a. HasCallStack =&gt; a
</span><span class="hs-identifier hs-var">undefined</span></span><span> </span><span class="hs-comment">-- do</span><span>
</span><span id="line-279"></span><span>            </span><span class="hs-comment">{-
                r &lt;- produceL st
                return $ case r of
                    Yield x s -&gt; Yield x (Right (Tuple3' (Just a) s sR))
                    Continue s -&gt; Continue (Right (Tuple3' (Just a) s sR))
                -}</span><span>
</span><span id="line-285"></span><span>
</span><span id="line-286"></span><span>    </span><span id="local-6989586621679364206"><span class="annot"><span class="annottext">produce :: Tuple3' (Maybe a) (PipeState s1 s2) (PipeState s1 s2)
-&gt; m (Step
        (PipeState
           (Tuple' (PipeState s1 s2) (PipeState s1 s2))
           (Tuple3' (Maybe a) (PipeState s1 s2) (PipeState s1 s2)))
        b)
</span><a href="#local-6989586621679364206"><span class="hs-identifier hs-var hs-var">produce</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Streamly.Internal.Data.Tuple.Strict.html#Tuple3%27"><span class="hs-identifier hs-type">Tuple3'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="hs-identifier hs-type">Just</span></span><span> </span><span id="local-6989586621679364194"><span class="annot"><span class="annottext">a :: a
</span><a href="#local-6989586621679364194"><span class="hs-identifier hs-var">a</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679364193"><span class="annot"><span class="annottext">sL :: PipeState s1 s2
</span><a href="#local-6989586621679364193"><span class="hs-identifier hs-var">sL</span></a></span></span><span> </span><span id="local-6989586621679364192"><span class="annot"><span class="annottext">sR :: PipeState s1 s2
</span><a href="#local-6989586621679364192"><span class="hs-identifier hs-var">sR</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-287"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">PipeState s1 s2
</span><a href="#local-6989586621679364193"><span class="hs-identifier hs-var">sL</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-288"></span><span>            </span><span class="annot"><a href="Streamly.Internal.Data.Pipe.Types.html#Consume"><span class="hs-identifier hs-type">Consume</span></a></span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-289"></span><span>                </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">PipeState s1 s2
</span><a href="#local-6989586621679364192"><span class="hs-identifier hs-var">sR</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-290"></span><span>                    </span><span class="annot"><a href="Streamly.Internal.Data.Pipe.Types.html#Consume"><span class="hs-identifier hs-type">Consume</span></a></span><span> </span><span id="local-6989586621679364191"><span class="annot"><span class="annottext">st :: s1
</span><a href="#local-6989586621679364191"><span class="hs-identifier hs-var">st</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-291"></span><span>                        </span><span id="local-6989586621679364190"><span class="annot"><span class="annottext">Step (PipeState s1 s2) b
</span><a href="#local-6989586621679364190"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">s1 -&gt; a -&gt; m (Step (PipeState s1 s2) b)
</span><a href="#local-6989586621679364210"><span class="hs-identifier hs-var">consumeR</span></a></span><span> </span><span class="annot"><span class="annottext">s1
</span><a href="#local-6989586621679364191"><span class="hs-identifier hs-var">st</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679364194"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-292"></span><span>                        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679364189"><span class="annot"><span class="annottext">nextL :: b -&gt; PipeState (Tuple' (PipeState s1 s2) b) s2
</span><a href="#local-6989586621679364189"><span class="hs-identifier hs-var hs-var">nextL</span></a></span></span><span> </span><span id="local-6989586621679364188"><span class="annot"><span class="annottext">s :: b
</span><a href="#local-6989586621679364188"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Tuple' (PipeState s1 s2) b
-&gt; PipeState (Tuple' (PipeState s1 s2) b) s2
forall s1 s2. s1 -&gt; PipeState s1 s2
</span><a href="Streamly.Internal.Data.Pipe.Types.html#Consume"><span class="hs-identifier hs-var">Consume</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PipeState s1 s2 -&gt; b -&gt; Tuple' (PipeState s1 s2) b
forall a b. a -&gt; b -&gt; Tuple' a b
</span><a href="Streamly.Internal.Data.Tuple.Strict.html#Tuple%27"><span class="hs-identifier hs-var">Tuple'</span></a></span><span> </span><span class="annot"><span class="annottext">PipeState s1 s2
</span><a href="#local-6989586621679364193"><span class="hs-identifier hs-var">sL</span></a></span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679364188"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-293"></span><span>                        </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679364187"><span class="annot"><span class="annottext">nextR :: c -&gt; PipeState s1 (Tuple3' (Maybe a) (PipeState s1 s2) c)
</span><a href="#local-6989586621679364187"><span class="hs-identifier hs-var hs-var">nextR</span></a></span></span><span> </span><span id="local-6989586621679364186"><span class="annot"><span class="annottext">s :: c
</span><a href="#local-6989586621679364186"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Tuple3' (Maybe a) (PipeState s1 s2) c
-&gt; PipeState s1 (Tuple3' (Maybe a) (PipeState s1 s2) c)
forall s1 s2. s2 -&gt; PipeState s1 s2
</span><a href="Streamly.Internal.Data.Pipe.Types.html#Produce"><span class="hs-identifier hs-var">Produce</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe a
-&gt; PipeState s1 s2 -&gt; c -&gt; Tuple3' (Maybe a) (PipeState s1 s2) c
forall a b c. a -&gt; b -&gt; c -&gt; Tuple3' a b c
</span><a href="Streamly.Internal.Data.Tuple.Strict.html#Tuple3%27"><span class="hs-identifier hs-var">Tuple3'</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe a
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="annot"><span class="annottext">PipeState s1 s2
</span><a href="#local-6989586621679364193"><span class="hs-identifier hs-var">sL</span></a></span><span> </span><span class="annot"><span class="annottext">c
</span><a href="#local-6989586621679364186"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-294"></span><span>                        </span><span class="annot"><span class="annottext">Step
  (PipeState
     (Tuple' (PipeState s1 s2) (PipeState s1 s2))
     (Tuple3' (Maybe a) (PipeState s1 s2) (PipeState s1 s2)))
  b
-&gt; m (Step
        (PipeState
           (Tuple' (PipeState s1 s2) (PipeState s1 s2))
           (Tuple3' (Maybe a) (PipeState s1 s2) (PipeState s1 s2)))
        b)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Step
   (PipeState
      (Tuple' (PipeState s1 s2) (PipeState s1 s2))
      (Tuple3' (Maybe a) (PipeState s1 s2) (PipeState s1 s2)))
   b
 -&gt; m (Step
         (PipeState
            (Tuple' (PipeState s1 s2) (PipeState s1 s2))
            (Tuple3' (Maybe a) (PipeState s1 s2) (PipeState s1 s2)))
         b))
-&gt; Step
     (PipeState
        (Tuple' (PipeState s1 s2) (PipeState s1 s2))
        (Tuple3' (Maybe a) (PipeState s1 s2) (PipeState s1 s2)))
     b
-&gt; m (Step
        (PipeState
           (Tuple' (PipeState s1 s2) (PipeState s1 s2))
           (Tuple3' (Maybe a) (PipeState s1 s2) (PipeState s1 s2)))
        b)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Step (PipeState s1 s2) b
</span><a href="#local-6989586621679364190"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-295"></span><span>                            </span><span class="annot"><a href="Streamly.Internal.Data.Pipe.Types.html#Yield"><span class="hs-identifier hs-type">Yield</span></a></span><span> </span><span id="local-6989586621679364185"><span class="annot"><span class="annottext">x :: b
</span><a href="#local-6989586621679364185"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621679364184"><span class="annot"><span class="annottext">s :: PipeState s1 s2
</span><a href="#local-6989586621679364184"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Streamly.Internal.Data.Pipe.Types.html#Consume"><span class="hs-identifier hs-type">Consume</span></a></span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">b
-&gt; PipeState
     (Tuple' (PipeState s1 s2) (PipeState s1 s2))
     (Tuple3' (Maybe a) (PipeState s1 s2) (PipeState s1 s2))
-&gt; Step
     (PipeState
        (Tuple' (PipeState s1 s2) (PipeState s1 s2))
        (Tuple3' (Maybe a) (PipeState s1 s2) (PipeState s1 s2)))
     b
forall s a. a -&gt; s -&gt; Step s a
</span><a href="Streamly.Internal.Data.Pipe.Types.html#Yield"><span class="hs-identifier hs-var">Yield</span></a></span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679364185"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PipeState s1 s2
-&gt; PipeState
     (Tuple' (PipeState s1 s2) (PipeState s1 s2))
     (Tuple3' (Maybe a) (PipeState s1 s2) (PipeState s1 s2))
forall b s2. b -&gt; PipeState (Tuple' (PipeState s1 s2) b) s2
</span><a href="#local-6989586621679364189"><span class="hs-identifier hs-var">nextL</span></a></span><span> </span><span class="annot"><span class="annottext">PipeState s1 s2
</span><a href="#local-6989586621679364184"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-296"></span><span>                            </span><span class="annot"><a href="Streamly.Internal.Data.Pipe.Types.html#Yield"><span class="hs-identifier hs-type">Yield</span></a></span><span> </span><span id="local-6989586621679364183"><span class="annot"><span class="annottext">x :: b
</span><a href="#local-6989586621679364183"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621679364182"><span class="annot"><span class="annottext">s :: PipeState s1 s2
</span><a href="#local-6989586621679364182"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Streamly.Internal.Data.Pipe.Types.html#Produce"><span class="hs-identifier hs-type">Produce</span></a></span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">b
-&gt; PipeState
     (Tuple' (PipeState s1 s2) (PipeState s1 s2))
     (Tuple3' (Maybe a) (PipeState s1 s2) (PipeState s1 s2))
-&gt; Step
     (PipeState
        (Tuple' (PipeState s1 s2) (PipeState s1 s2))
        (Tuple3' (Maybe a) (PipeState s1 s2) (PipeState s1 s2)))
     b
forall s a. a -&gt; s -&gt; Step s a
</span><a href="Streamly.Internal.Data.Pipe.Types.html#Yield"><span class="hs-identifier hs-var">Yield</span></a></span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679364183"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PipeState s1 s2
-&gt; PipeState
     (Tuple' (PipeState s1 s2) (PipeState s1 s2))
     (Tuple3' (Maybe a) (PipeState s1 s2) (PipeState s1 s2))
forall c s1 a.
c -&gt; PipeState s1 (Tuple3' (Maybe a) (PipeState s1 s2) c)
</span><a href="#local-6989586621679364187"><span class="hs-identifier hs-var">nextR</span></a></span><span> </span><span class="annot"><span class="annottext">PipeState s1 s2
</span><a href="#local-6989586621679364182"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-297"></span><span>                            </span><span class="annot"><a href="Streamly.Internal.Data.Pipe.Types.html#Continue"><span class="hs-identifier hs-type">Continue</span></a></span><span> </span><span id="local-6989586621679364181"><span class="annot"><span class="annottext">s :: PipeState s1 s2
</span><a href="#local-6989586621679364181"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Streamly.Internal.Data.Pipe.Types.html#Consume"><span class="hs-identifier hs-type">Consume</span></a></span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PipeState
  (Tuple' (PipeState s1 s2) (PipeState s1 s2))
  (Tuple3' (Maybe a) (PipeState s1 s2) (PipeState s1 s2))
-&gt; Step
     (PipeState
        (Tuple' (PipeState s1 s2) (PipeState s1 s2))
        (Tuple3' (Maybe a) (PipeState s1 s2) (PipeState s1 s2)))
     b
forall s a. s -&gt; Step s a
</span><a href="Streamly.Internal.Data.Pipe.Types.html#Continue"><span class="hs-identifier hs-var">Continue</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PipeState s1 s2
-&gt; PipeState
     (Tuple' (PipeState s1 s2) (PipeState s1 s2))
     (Tuple3' (Maybe a) (PipeState s1 s2) (PipeState s1 s2))
forall b s2. b -&gt; PipeState (Tuple' (PipeState s1 s2) b) s2
</span><a href="#local-6989586621679364189"><span class="hs-identifier hs-var">nextL</span></a></span><span> </span><span class="annot"><span class="annottext">PipeState s1 s2
</span><a href="#local-6989586621679364181"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-298"></span><span>                            </span><span class="annot"><a href="Streamly.Internal.Data.Pipe.Types.html#Continue"><span class="hs-identifier hs-type">Continue</span></a></span><span> </span><span id="local-6989586621679364180"><span class="annot"><span class="annottext">s :: PipeState s1 s2
</span><a href="#local-6989586621679364180"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Streamly.Internal.Data.Pipe.Types.html#Produce"><span class="hs-identifier hs-type">Produce</span></a></span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PipeState
  (Tuple' (PipeState s1 s2) (PipeState s1 s2))
  (Tuple3' (Maybe a) (PipeState s1 s2) (PipeState s1 s2))
-&gt; Step
     (PipeState
        (Tuple' (PipeState s1 s2) (PipeState s1 s2))
        (Tuple3' (Maybe a) (PipeState s1 s2) (PipeState s1 s2)))
     b
forall s a. s -&gt; Step s a
</span><a href="Streamly.Internal.Data.Pipe.Types.html#Continue"><span class="hs-identifier hs-var">Continue</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PipeState s1 s2
-&gt; PipeState
     (Tuple' (PipeState s1 s2) (PipeState s1 s2))
     (Tuple3' (Maybe a) (PipeState s1 s2) (PipeState s1 s2))
forall c s1 a.
c -&gt; PipeState s1 (Tuple3' (Maybe a) (PipeState s1 s2) c)
</span><a href="#local-6989586621679364187"><span class="hs-identifier hs-var">nextR</span></a></span><span> </span><span class="annot"><span class="annottext">PipeState s1 s2
</span><a href="#local-6989586621679364180"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-299"></span><span>                    </span><span class="hs-comment">-- We will never come here unless the initial state of</span><span>
</span><span id="line-300"></span><span>                    </span><span class="hs-comment">-- second pipe is set to &quot;Right&quot;.</span><span>
</span><span id="line-301"></span><span>                    </span><span class="annot"><a href="Streamly.Internal.Data.Pipe.Types.html#Produce"><span class="hs-identifier hs-type">Produce</span></a></span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">m (Step
     (PipeState
        (Tuple' (PipeState s1 s2) (PipeState s1 s2))
        (Tuple3' (Maybe a) (PipeState s1 s2) (PipeState s1 s2)))
     b)
forall a. HasCallStack =&gt; a
</span><span class="hs-identifier hs-var">undefined</span></span><span>
</span><span id="line-302"></span><span>            </span><span class="annot"><a href="Streamly.Internal.Data.Pipe.Types.html#Produce"><span class="hs-identifier hs-type">Produce</span></a></span><span> </span><span id="local-6989586621679364179"><span class="annot"><span class="annottext">st :: s2
</span><a href="#local-6989586621679364179"><span class="hs-identifier hs-var">st</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-303"></span><span>                </span><span id="local-6989586621679364178"><span class="annot"><span class="annottext">Step (PipeState s1 s2) b
</span><a href="#local-6989586621679364178"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">s2 -&gt; m (Step (PipeState s1 s2) b)
</span><a href="#local-6989586621679364212"><span class="hs-identifier hs-var">produceL</span></a></span><span> </span><span class="annot"><span class="annottext">s2
</span><a href="#local-6989586621679364179"><span class="hs-identifier hs-var">st</span></a></span><span>
</span><span id="line-304"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679364177"><span class="annot"><span class="annottext">next :: b -&gt; PipeState s1 (Tuple3' (Maybe a) b (PipeState s1 s2))
</span><a href="#local-6989586621679364177"><span class="hs-identifier hs-var hs-var">next</span></a></span></span><span> </span><span id="local-6989586621679364176"><span class="annot"><span class="annottext">s :: b
</span><a href="#local-6989586621679364176"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Tuple3' (Maybe a) b (PipeState s1 s2)
-&gt; PipeState s1 (Tuple3' (Maybe a) b (PipeState s1 s2))
forall s1 s2. s2 -&gt; PipeState s1 s2
</span><a href="Streamly.Internal.Data.Pipe.Types.html#Produce"><span class="hs-identifier hs-var">Produce</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe a
-&gt; b -&gt; PipeState s1 s2 -&gt; Tuple3' (Maybe a) b (PipeState s1 s2)
forall a b c. a -&gt; b -&gt; c -&gt; Tuple3' a b c
</span><a href="Streamly.Internal.Data.Tuple.Strict.html#Tuple3%27"><span class="hs-identifier hs-var">Tuple3'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; Maybe a
forall a. a -&gt; Maybe a
</span><span class="hs-identifier hs-var">Just</span></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679364194"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679364176"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">PipeState s1 s2
</span><a href="#local-6989586621679364192"><span class="hs-identifier hs-var">sR</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-305"></span><span>                </span><span class="annot"><span class="annottext">Step
  (PipeState
     (Tuple' (PipeState s1 s2) (PipeState s1 s2))
     (Tuple3' (Maybe a) (PipeState s1 s2) (PipeState s1 s2)))
  b
-&gt; m (Step
        (PipeState
           (Tuple' (PipeState s1 s2) (PipeState s1 s2))
           (Tuple3' (Maybe a) (PipeState s1 s2) (PipeState s1 s2)))
        b)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Step
   (PipeState
      (Tuple' (PipeState s1 s2) (PipeState s1 s2))
      (Tuple3' (Maybe a) (PipeState s1 s2) (PipeState s1 s2)))
   b
 -&gt; m (Step
         (PipeState
            (Tuple' (PipeState s1 s2) (PipeState s1 s2))
            (Tuple3' (Maybe a) (PipeState s1 s2) (PipeState s1 s2)))
         b))
-&gt; Step
     (PipeState
        (Tuple' (PipeState s1 s2) (PipeState s1 s2))
        (Tuple3' (Maybe a) (PipeState s1 s2) (PipeState s1 s2)))
     b
-&gt; m (Step
        (PipeState
           (Tuple' (PipeState s1 s2) (PipeState s1 s2))
           (Tuple3' (Maybe a) (PipeState s1 s2) (PipeState s1 s2)))
        b)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Step (PipeState s1 s2) b
</span><a href="#local-6989586621679364178"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-306"></span><span>                    </span><span class="annot"><a href="Streamly.Internal.Data.Pipe.Types.html#Yield"><span class="hs-identifier hs-type">Yield</span></a></span><span> </span><span id="local-6989586621679364175"><span class="annot"><span class="annottext">x :: b
</span><a href="#local-6989586621679364175"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621679364174"><span class="annot"><span class="annottext">s :: PipeState s1 s2
</span><a href="#local-6989586621679364174"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">b
-&gt; PipeState
     (Tuple' (PipeState s1 s2) (PipeState s1 s2))
     (Tuple3' (Maybe a) (PipeState s1 s2) (PipeState s1 s2))
-&gt; Step
     (PipeState
        (Tuple' (PipeState s1 s2) (PipeState s1 s2))
        (Tuple3' (Maybe a) (PipeState s1 s2) (PipeState s1 s2)))
     b
forall s a. a -&gt; s -&gt; Step s a
</span><a href="Streamly.Internal.Data.Pipe.Types.html#Yield"><span class="hs-identifier hs-var">Yield</span></a></span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679364175"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PipeState s1 s2
-&gt; PipeState
     (Tuple' (PipeState s1 s2) (PipeState s1 s2))
     (Tuple3' (Maybe a) (PipeState s1 s2) (PipeState s1 s2))
forall b s1.
b -&gt; PipeState s1 (Tuple3' (Maybe a) b (PipeState s1 s2))
</span><a href="#local-6989586621679364177"><span class="hs-identifier hs-var">next</span></a></span><span> </span><span class="annot"><span class="annottext">PipeState s1 s2
</span><a href="#local-6989586621679364174"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-307"></span><span>                    </span><span class="annot"><a href="Streamly.Internal.Data.Pipe.Types.html#Continue"><span class="hs-identifier hs-type">Continue</span></a></span><span> </span><span id="local-6989586621679364173"><span class="annot"><span class="annottext">s :: PipeState s1 s2
</span><a href="#local-6989586621679364173"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PipeState
  (Tuple' (PipeState s1 s2) (PipeState s1 s2))
  (Tuple3' (Maybe a) (PipeState s1 s2) (PipeState s1 s2))
-&gt; Step
     (PipeState
        (Tuple' (PipeState s1 s2) (PipeState s1 s2))
        (Tuple3' (Maybe a) (PipeState s1 s2) (PipeState s1 s2)))
     b
forall s a. s -&gt; Step s a
</span><a href="Streamly.Internal.Data.Pipe.Types.html#Continue"><span class="hs-identifier hs-var">Continue</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PipeState s1 s2
-&gt; PipeState
     (Tuple' (PipeState s1 s2) (PipeState s1 s2))
     (Tuple3' (Maybe a) (PipeState s1 s2) (PipeState s1 s2))
forall b s1.
b -&gt; PipeState s1 (Tuple3' (Maybe a) b (PipeState s1 s2))
</span><a href="#local-6989586621679364177"><span class="hs-identifier hs-var">next</span></a></span><span> </span><span class="annot"><span class="annottext">PipeState s1 s2
</span><a href="#local-6989586621679364173"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-308"></span><span>
</span><span id="line-309"></span><span>    </span><span class="annot"><a href="#local-6989586621679364206"><span class="hs-identifier hs-var">produce</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Streamly.Internal.Data.Tuple.Strict.html#Tuple3%27"><span class="hs-identifier hs-type">Tuple3'</span></a></span><span> </span><span class="annot"><span class="hs-identifier hs-type">Nothing</span></span><span> </span><span id="local-6989586621679364172"><span class="annot"><span class="annottext">sL :: PipeState s1 s2
</span><a href="#local-6989586621679364172"><span class="hs-identifier hs-var">sL</span></a></span></span><span> </span><span id="local-6989586621679364171"><span class="annot"><span class="annottext">sR :: PipeState s1 s2
</span><a href="#local-6989586621679364171"><span class="hs-identifier hs-var">sR</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-310"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">PipeState s1 s2
</span><a href="#local-6989586621679364171"><span class="hs-identifier hs-var">sR</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-311"></span><span>            </span><span class="annot"><a href="Streamly.Internal.Data.Pipe.Types.html#Consume"><span class="hs-identifier hs-type">Consume</span></a></span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">m (Step
     (PipeState
        (Tuple' (PipeState s1 s2) (PipeState s1 s2))
        (Tuple3' (Maybe a) (PipeState s1 s2) (PipeState s1 s2)))
     b)
forall a. HasCallStack =&gt; a
</span><span class="hs-identifier hs-var">undefined</span></span><span> </span><span class="hs-comment">-- should never occur</span><span>
</span><span id="line-312"></span><span>            </span><span class="annot"><a href="Streamly.Internal.Data.Pipe.Types.html#Produce"><span class="hs-identifier hs-type">Produce</span></a></span><span> </span><span id="local-6989586621679364170"><span class="annot"><span class="annottext">st :: s2
</span><a href="#local-6989586621679364170"><span class="hs-identifier hs-var">st</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-313"></span><span>                </span><span id="local-6989586621679364169"><span class="annot"><span class="annottext">Step (PipeState s1 s2) b
</span><a href="#local-6989586621679364169"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">s2 -&gt; m (Step (PipeState s1 s2) b)
</span><a href="#local-6989586621679364209"><span class="hs-identifier hs-var">produceR</span></a></span><span> </span><span class="annot"><span class="annottext">s2
</span><a href="#local-6989586621679364170"><span class="hs-identifier hs-var">st</span></a></span><span>
</span><span id="line-314"></span><span>                </span><span class="annot"><span class="annottext">Step
  (PipeState
     (Tuple' (PipeState s1 s2) (PipeState s1 s2))
     (Tuple3' (Maybe a) (PipeState s1 s2) (PipeState s1 s2)))
  b
-&gt; m (Step
        (PipeState
           (Tuple' (PipeState s1 s2) (PipeState s1 s2))
           (Tuple3' (Maybe a) (PipeState s1 s2) (PipeState s1 s2)))
        b)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Step
   (PipeState
      (Tuple' (PipeState s1 s2) (PipeState s1 s2))
      (Tuple3' (Maybe a) (PipeState s1 s2) (PipeState s1 s2)))
   b
 -&gt; m (Step
         (PipeState
            (Tuple' (PipeState s1 s2) (PipeState s1 s2))
            (Tuple3' (Maybe a) (PipeState s1 s2) (PipeState s1 s2)))
         b))
-&gt; Step
     (PipeState
        (Tuple' (PipeState s1 s2) (PipeState s1 s2))
        (Tuple3' (Maybe a) (PipeState s1 s2) (PipeState s1 s2)))
     b
-&gt; m (Step
        (PipeState
           (Tuple' (PipeState s1 s2) (PipeState s1 s2))
           (Tuple3' (Maybe a) (PipeState s1 s2) (PipeState s1 s2)))
        b)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Step (PipeState s1 s2) b
</span><a href="#local-6989586621679364169"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-315"></span><span>                    </span><span class="annot"><a href="Streamly.Internal.Data.Pipe.Types.html#Yield"><span class="hs-identifier hs-type">Yield</span></a></span><span> </span><span id="local-6989586621679364168"><span class="annot"><span class="annottext">x :: b
</span><a href="#local-6989586621679364168"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621679364167"><span class="annot"><span class="annottext">s :: PipeState s1 s2
</span><a href="#local-6989586621679364167"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Streamly.Internal.Data.Pipe.Types.html#Consume"><span class="hs-identifier hs-type">Consume</span></a></span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-316"></span><span>                        </span><span class="annot"><span class="annottext">b
-&gt; PipeState
     (Tuple' (PipeState s1 s2) (PipeState s1 s2))
     (Tuple3' (Maybe a) (PipeState s1 s2) (PipeState s1 s2))
-&gt; Step
     (PipeState
        (Tuple' (PipeState s1 s2) (PipeState s1 s2))
        (Tuple3' (Maybe a) (PipeState s1 s2) (PipeState s1 s2)))
     b
forall s a. a -&gt; s -&gt; Step s a
</span><a href="Streamly.Internal.Data.Pipe.Types.html#Yield"><span class="hs-identifier hs-var">Yield</span></a></span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679364168"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Tuple' (PipeState s1 s2) (PipeState s1 s2)
-&gt; PipeState
     (Tuple' (PipeState s1 s2) (PipeState s1 s2))
     (Tuple3' (Maybe a) (PipeState s1 s2) (PipeState s1 s2))
forall s1 s2. s1 -&gt; PipeState s1 s2
</span><a href="Streamly.Internal.Data.Pipe.Types.html#Consume"><span class="hs-identifier hs-var">Consume</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PipeState s1 s2
-&gt; PipeState s1 s2 -&gt; Tuple' (PipeState s1 s2) (PipeState s1 s2)
forall a b. a -&gt; b -&gt; Tuple' a b
</span><a href="Streamly.Internal.Data.Tuple.Strict.html#Tuple%27"><span class="hs-identifier hs-var">Tuple'</span></a></span><span> </span><span class="annot"><span class="annottext">PipeState s1 s2
</span><a href="#local-6989586621679364172"><span class="hs-identifier hs-var">sL</span></a></span><span> </span><span class="annot"><span class="annottext">PipeState s1 s2
</span><a href="#local-6989586621679364167"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-317"></span><span>                    </span><span class="annot"><a href="Streamly.Internal.Data.Pipe.Types.html#Yield"><span class="hs-identifier hs-type">Yield</span></a></span><span> </span><span id="local-6989586621679364166"><span class="annot"><span class="annottext">x :: b
</span><a href="#local-6989586621679364166"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621679364165"><span class="annot"><span class="annottext">s :: PipeState s1 s2
</span><a href="#local-6989586621679364165"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Streamly.Internal.Data.Pipe.Types.html#Produce"><span class="hs-identifier hs-type">Produce</span></a></span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-318"></span><span>                        </span><span class="annot"><span class="annottext">b
-&gt; PipeState
     (Tuple' (PipeState s1 s2) (PipeState s1 s2))
     (Tuple3' (Maybe a) (PipeState s1 s2) (PipeState s1 s2))
-&gt; Step
     (PipeState
        (Tuple' (PipeState s1 s2) (PipeState s1 s2))
        (Tuple3' (Maybe a) (PipeState s1 s2) (PipeState s1 s2)))
     b
forall s a. a -&gt; s -&gt; Step s a
</span><a href="Streamly.Internal.Data.Pipe.Types.html#Yield"><span class="hs-identifier hs-var">Yield</span></a></span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679364166"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Tuple3' (Maybe a) (PipeState s1 s2) (PipeState s1 s2)
-&gt; PipeState
     (Tuple' (PipeState s1 s2) (PipeState s1 s2))
     (Tuple3' (Maybe a) (PipeState s1 s2) (PipeState s1 s2))
forall s1 s2. s2 -&gt; PipeState s1 s2
</span><a href="Streamly.Internal.Data.Pipe.Types.html#Produce"><span class="hs-identifier hs-var">Produce</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe a
-&gt; PipeState s1 s2
-&gt; PipeState s1 s2
-&gt; Tuple3' (Maybe a) (PipeState s1 s2) (PipeState s1 s2)
forall a b c. a -&gt; b -&gt; c -&gt; Tuple3' a b c
</span><a href="Streamly.Internal.Data.Tuple.Strict.html#Tuple3%27"><span class="hs-identifier hs-var">Tuple3'</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe a
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="annot"><span class="annottext">PipeState s1 s2
</span><a href="#local-6989586621679364172"><span class="hs-identifier hs-var">sL</span></a></span><span> </span><span class="annot"><span class="annottext">PipeState s1 s2
</span><a href="#local-6989586621679364165"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-319"></span><span>                    </span><span class="annot"><a href="Streamly.Internal.Data.Pipe.Types.html#Continue"><span class="hs-identifier hs-type">Continue</span></a></span><span> </span><span id="local-6989586621679364164"><span class="annot"><span class="annottext">s :: PipeState s1 s2
</span><a href="#local-6989586621679364164"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Streamly.Internal.Data.Pipe.Types.html#Consume"><span class="hs-identifier hs-type">Consume</span></a></span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-320"></span><span>                        </span><span class="annot"><span class="annottext">PipeState
  (Tuple' (PipeState s1 s2) (PipeState s1 s2))
  (Tuple3' (Maybe a) (PipeState s1 s2) (PipeState s1 s2))
-&gt; Step
     (PipeState
        (Tuple' (PipeState s1 s2) (PipeState s1 s2))
        (Tuple3' (Maybe a) (PipeState s1 s2) (PipeState s1 s2)))
     b
forall s a. s -&gt; Step s a
</span><a href="Streamly.Internal.Data.Pipe.Types.html#Continue"><span class="hs-identifier hs-var">Continue</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Tuple' (PipeState s1 s2) (PipeState s1 s2)
-&gt; PipeState
     (Tuple' (PipeState s1 s2) (PipeState s1 s2))
     (Tuple3' (Maybe a) (PipeState s1 s2) (PipeState s1 s2))
forall s1 s2. s1 -&gt; PipeState s1 s2
</span><a href="Streamly.Internal.Data.Pipe.Types.html#Consume"><span class="hs-identifier hs-var">Consume</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">PipeState s1 s2
-&gt; PipeState s1 s2 -&gt; Tuple' (PipeState s1 s2) (PipeState s1 s2)
forall a b. a -&gt; b -&gt; Tuple' a b
</span><a href="Streamly.Internal.Data.Tuple.Strict.html#Tuple%27"><span class="hs-identifier hs-var">Tuple'</span></a></span><span> </span><span class="annot"><span class="annottext">PipeState s1 s2
</span><a href="#local-6989586621679364172"><span class="hs-identifier hs-var">sL</span></a></span><span> </span><span class="annot"><span class="annottext">PipeState s1 s2
</span><a href="#local-6989586621679364164"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-321"></span><span>                    </span><span class="annot"><a href="Streamly.Internal.Data.Pipe.Types.html#Continue"><span class="hs-identifier hs-type">Continue</span></a></span><span> </span><span id="local-6989586621679364163"><span class="annot"><span class="annottext">s :: PipeState s1 s2
</span><a href="#local-6989586621679364163"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Streamly.Internal.Data.Pipe.Types.html#Produce"><span class="hs-identifier hs-type">Produce</span></a></span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-322"></span><span>                        </span><span class="annot"><span class="annottext">PipeState
  (Tuple' (PipeState s1 s2) (PipeState s1 s2))
  (Tuple3' (Maybe a) (PipeState s1 s2) (PipeState s1 s2))
-&gt; Step
     (PipeState
        (Tuple' (PipeState s1 s2) (PipeState s1 s2))
        (Tuple3' (Maybe a) (PipeState s1 s2) (PipeState s1 s2)))
     b
forall s a. s -&gt; Step s a
</span><a href="Streamly.Internal.Data.Pipe.Types.html#Continue"><span class="hs-identifier hs-var">Continue</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Tuple3' (Maybe a) (PipeState s1 s2) (PipeState s1 s2)
-&gt; PipeState
     (Tuple' (PipeState s1 s2) (PipeState s1 s2))
     (Tuple3' (Maybe a) (PipeState s1 s2) (PipeState s1 s2))
forall s1 s2. s2 -&gt; PipeState s1 s2
</span><a href="Streamly.Internal.Data.Pipe.Types.html#Produce"><span class="hs-identifier hs-var">Produce</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Maybe a
-&gt; PipeState s1 s2
-&gt; PipeState s1 s2
-&gt; Tuple3' (Maybe a) (PipeState s1 s2) (PipeState s1 s2)
forall a b c. a -&gt; b -&gt; c -&gt; Tuple3' a b c
</span><a href="Streamly.Internal.Data.Tuple.Strict.html#Tuple3%27"><span class="hs-identifier hs-var">Tuple3'</span></a></span><span> </span><span class="annot"><span class="annottext">Maybe a
forall a. Maybe a
</span><span class="hs-identifier hs-var">Nothing</span></span><span> </span><span class="annot"><span class="annottext">PipeState s1 s2
</span><a href="#local-6989586621679364172"><span class="hs-identifier hs-var">sL</span></a></span><span> </span><span class="annot"><span class="annottext">PipeState s1 s2
</span><a href="#local-6989586621679364163"><span class="hs-identifier hs-var">s</span></a></span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-323"></span><span>
</span><span id="line-324"></span><span id="local-6989586621679364160"><span id="local-6989586621679364161"><span id="local-6989586621679364162"><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679364155"><span id="local-6989586621679364157"><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621679364162"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Semigroup</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Streamly.Internal.Data.Pipe.Types.html#Pipe"><span class="hs-identifier hs-type">Pipe</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679364162"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679364161"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679364160"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-325"></span><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">(</span><span class="hs-pragma">&lt;&gt;</span><span class="hs-pragma">)</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-326"></span><span>    </span><span id="local-6989586621679364153"><span class="annot"><span class="annottext">&lt;&gt; :: Pipe m a b -&gt; Pipe m a b -&gt; Pipe m a b
</span><span class="hs-operator hs-var hs-var hs-var hs-var">(&lt;&gt;)</span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Pipe m a b -&gt; Pipe m a b -&gt; Pipe m a b
forall (m :: * -&gt; *) a b.
Monad m =&gt;
Pipe m a b -&gt; Pipe m a b -&gt; Pipe m a b
</span><a href="Streamly.Internal.Data.Pipe.Types.html#tee"><span class="hs-identifier hs-var">tee</span></a></span></span></span></span><span>
</span><span id="line-327"></span><span>
</span><span id="line-328"></span><span class="hs-comment">-- | Lift a pure function to a 'Pipe'.</span><span>
</span><span id="line-329"></span><span class="hs-comment">--</span><span>
</span><span id="line-330"></span><span class="hs-comment">-- @since 0.7.0</span><span>
</span><span id="line-331"></span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Pipe.Types.html#map"><span class="hs-pragma hs-type">map</span></a></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-332"></span><span id="local-6989586621679364445"><span id="local-6989586621679364446"><span id="local-6989586621679364447"><span class="annot"><a href="Streamly.Internal.Data.Pipe.Types.html#map"><span class="hs-identifier hs-type">map</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621679364447"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679364446"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="#local-6989586621679364445"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Pipe.Types.html#Pipe"><span class="hs-identifier hs-type">Pipe</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679364447"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679364446"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679364445"><span class="hs-identifier hs-type">b</span></a></span></span></span></span><span>
</span><span id="line-333"></span><span id="map"><span class="annot"><span class="annottext">map :: (a -&gt; b) -&gt; Pipe m a b
</span><a href="Streamly.Internal.Data.Pipe.Types.html#map"><span class="hs-identifier hs-var hs-var">map</span></a></span></span><span> </span><span id="local-6989586621679364152"><span class="annot"><span class="annottext">f :: a -&gt; b
</span><a href="#local-6989586621679364152"><span class="hs-identifier hs-var">f</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(() -&gt; a -&gt; m (Step (PipeState () Any) b))
-&gt; (Any -&gt; m (Step (PipeState () Any) b)) -&gt; () -&gt; Pipe m a b
forall (m :: * -&gt; *) a b s1 s2.
(s1 -&gt; a -&gt; m (Step (PipeState s1 s2) b))
-&gt; (s2 -&gt; m (Step (PipeState s1 s2) b)) -&gt; s1 -&gt; Pipe m a b
</span><a href="Streamly.Internal.Data.Pipe.Types.html#Pipe"><span class="hs-identifier hs-var">Pipe</span></a></span><span> </span><span class="annot"><span class="annottext">() -&gt; a -&gt; m (Step (PipeState () Any) b)
forall (m :: * -&gt; *) p s2.
Monad m =&gt;
p -&gt; a -&gt; m (Step (PipeState () s2) b)
</span><a href="#local-6989586621679364151"><span class="hs-identifier hs-var">consume</span></a></span><span> </span><span class="annot"><span class="annottext">Any -&gt; m (Step (PipeState () Any) b)
forall a. HasCallStack =&gt; a
</span><span class="hs-identifier hs-var">undefined</span></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><span id="line-334"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-335"></span><span>    </span><span id="local-6989586621679364151"><span class="annot"><span class="annottext">consume :: p -&gt; a -&gt; m (Step (PipeState () s2) b)
</span><a href="#local-6989586621679364151"><span class="hs-identifier hs-var hs-var">consume</span></a></span></span><span> </span><span class="hs-identifier">_</span><span> </span><span id="local-6989586621679364150"><span class="annot"><span class="annottext">a :: a
</span><a href="#local-6989586621679364150"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Step (PipeState () s2) b -&gt; m (Step (PipeState () s2) b)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Step (PipeState () s2) b -&gt; m (Step (PipeState () s2) b))
-&gt; Step (PipeState () s2) b -&gt; m (Step (PipeState () s2) b)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">b -&gt; PipeState () s2 -&gt; Step (PipeState () s2) b
forall s a. a -&gt; s -&gt; Step s a
</span><a href="Streamly.Internal.Data.Pipe.Types.html#Yield"><span class="hs-identifier hs-var">Yield</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">a -&gt; b
</span><a href="#local-6989586621679364152"><span class="hs-identifier hs-var">f</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679364150"><span class="hs-identifier hs-var">a</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">() -&gt; PipeState () s2
forall s1 s2. s1 -&gt; PipeState s1 s2
</span><a href="Streamly.Internal.Data.Pipe.Types.html#Consume"><span class="hs-identifier hs-var">Consume</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><span id="line-336"></span><span>
</span><span id="line-337"></span><span class="hs-comment">{-
-- | A hollow or identity 'Pipe' passes through everything that comes in.
--
-- @since 0.7.0
{-# INLINE id #-}
id :: Monad m =&gt; Pipe m a a
id = map Prelude.id
-}</span><span>
</span><span id="line-345"></span><span>
</span><span id="line-346"></span><span class="hs-comment">-- | Compose two pipes such that the output of the second pipe is attached to</span><span>
</span><span id="line-347"></span><span class="hs-comment">-- the input of the first pipe.</span><span>
</span><span id="line-348"></span><span class="hs-comment">--</span><span>
</span><span id="line-349"></span><span class="hs-comment">-- @since 0.7.0</span><span>
</span><span id="line-350"></span><span class="hs-pragma">{-# INLINE_NORMAL compose #-}</span><span>
</span><span id="line-351"></span><span id="local-6989586621679364437"><span id="local-6989586621679364438"><span id="local-6989586621679364439"><span id="local-6989586621679364440"><span class="annot"><a href="Streamly.Internal.Data.Pipe.Types.html#compose"><span class="hs-identifier hs-type">compose</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621679364440"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Pipe.Types.html#Pipe"><span class="hs-identifier hs-type">Pipe</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679364440"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679364439"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679364438"><span class="hs-identifier hs-type">c</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Pipe.Types.html#Pipe"><span class="hs-identifier hs-type">Pipe</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679364440"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679364437"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679364439"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Pipe.Types.html#Pipe"><span class="hs-identifier hs-type">Pipe</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679364440"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679364437"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679364438"><span class="hs-identifier hs-type">c</span></a></span></span></span></span></span><span>
</span><span id="line-352"></span><span id="compose"><span class="annot"><span class="annottext">compose :: Pipe m b c -&gt; Pipe m a b -&gt; Pipe m a c
</span><a href="Streamly.Internal.Data.Pipe.Types.html#compose"><span class="hs-identifier hs-var hs-var">compose</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Streamly.Internal.Data.Pipe.Types.html#Pipe"><span class="hs-identifier hs-type">Pipe</span></a></span><span> </span><span id="local-6989586621679364149"><span class="annot"><span class="annottext">consumeL :: s1 -&gt; b -&gt; m (Step (PipeState s1 s2) c)
</span><a href="#local-6989586621679364149"><span class="hs-identifier hs-var">consumeL</span></a></span></span><span> </span><span id="local-6989586621679364148"><span class="annot"><span class="annottext">produceL :: s2 -&gt; m (Step (PipeState s1 s2) c)
</span><a href="#local-6989586621679364148"><span class="hs-identifier hs-var">produceL</span></a></span></span><span> </span><span id="local-6989586621679364147"><span class="annot"><span class="annottext">stateL :: s1
</span><a href="#local-6989586621679364147"><span class="hs-identifier hs-var">stateL</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Streamly.Internal.Data.Pipe.Types.html#Pipe"><span class="hs-identifier hs-type">Pipe</span></a></span><span> </span><span id="local-6989586621679364146"><span class="annot"><span class="annottext">consumeR :: s1 -&gt; a -&gt; m (Step (PipeState s1 s2) b)
</span><a href="#local-6989586621679364146"><span class="hs-identifier hs-var">consumeR</span></a></span></span><span> </span><span id="local-6989586621679364145"><span class="annot"><span class="annottext">produceR :: s2 -&gt; m (Step (PipeState s1 s2) b)
</span><a href="#local-6989586621679364145"><span class="hs-identifier hs-var">produceR</span></a></span></span><span> </span><span id="local-6989586621679364144"><span class="annot"><span class="annottext">stateR :: s1
</span><a href="#local-6989586621679364144"><span class="hs-identifier hs-var">stateR</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-353"></span><span>    </span><span class="annot"><span class="annottext">(Tuple' (PipeState s1 s2) (PipeState s1 s2)
 -&gt; a
 -&gt; m (Step
         (PipeState
            (Tuple' (PipeState s1 s2) (PipeState s1 s2))
            (Tuple' (PipeState s1 s2) (PipeState s1 s2)))
         c))
-&gt; (Tuple' (PipeState s1 s2) (PipeState s1 s2)
    -&gt; m (Step
            (PipeState
               (Tuple' (PipeState s1 s2) (PipeState s1 s2))
               (Tuple' (PipeState s1 s2) (PipeState s1 s2)))
            c))
-&gt; Tuple' (PipeState s1 s2) (PipeState s1 s2)
-&gt; Pipe m a c
forall (m :: * -&gt; *) a b s1 s2.
(s1 -&gt; a -&gt; m (Step (PipeState s1 s2) b))
-&gt; (s2 -&gt; m (Step (PipeState s1 s2) b)) -&gt; s1 -&gt; Pipe m a b
</span><a href="Streamly.Internal.Data.Pipe.Types.html#Pipe"><span class="hs-identifier hs-var">Pipe</span></a></span><span> </span><span class="annot"><span class="annottext">Tuple' (PipeState s1 s2) (PipeState s1 s2)
-&gt; a
-&gt; m (Step
        (PipeState
           (Tuple' (PipeState s1 s2) (PipeState s1 s2))
           (Tuple' (PipeState s1 s2) (PipeState s1 s2)))
        c)
forall s2.
Tuple' (PipeState s1 s2) (PipeState s1 s2)
-&gt; a
-&gt; m (Step
        (PipeState
           (Tuple' (PipeState s1 s2) (PipeState s1 s2))
           (Tuple' (PipeState s1 s2) (PipeState s1 s2)))
        c)
</span><a href="#local-6989586621679364143"><span class="hs-identifier hs-var">consume</span></a></span><span> </span><span class="annot"><span class="annottext">Tuple' (PipeState s1 s2) (PipeState s1 s2)
-&gt; m (Step
        (PipeState
           (Tuple' (PipeState s1 s2) (PipeState s1 s2))
           (Tuple' (PipeState s1 s2) (PipeState s1 s2)))
        c)
</span><a href="#local-6989586621679364142"><span class="hs-identifier hs-var">produce</span></a></span><span> </span><span class="annot"><span class="annottext">Tuple' (PipeState s1 s2) (PipeState s1 s2)
forall s2 s2. Tuple' (PipeState s1 s2) (PipeState s1 s2)
</span><a href="#local-6989586621679364141"><span class="hs-identifier hs-var">state</span></a></span><span>
</span><span id="line-354"></span><span>
</span><span id="line-355"></span><span>    </span><span class="hs-keyword">where</span><span>
</span><span id="line-356"></span><span>
</span><span id="line-357"></span><span>    </span><span id="local-6989586621679364141"><span class="annot"><span class="annottext">state :: Tuple' (PipeState s1 s2) (PipeState s1 s2)
</span><a href="#local-6989586621679364141"><span class="hs-identifier hs-var hs-var">state</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">PipeState s1 s2
-&gt; PipeState s1 s2 -&gt; Tuple' (PipeState s1 s2) (PipeState s1 s2)
forall a b. a -&gt; b -&gt; Tuple' a b
</span><a href="Streamly.Internal.Data.Tuple.Strict.html#Tuple%27"><span class="hs-identifier hs-var">Tuple'</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">s1 -&gt; PipeState s1 s2
forall s1 s2. s1 -&gt; PipeState s1 s2
</span><a href="Streamly.Internal.Data.Pipe.Types.html#Consume"><span class="hs-identifier hs-var">Consume</span></a></span><span> </span><span class="annot"><span class="annottext">s1
</span><a href="#local-6989586621679364147"><span class="hs-identifier hs-var">stateL</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">s1 -&gt; PipeState s1 s2
forall s1 s2. s1 -&gt; PipeState s1 s2
</span><a href="Streamly.Internal.Data.Pipe.Types.html#Consume"><span class="hs-identifier hs-var">Consume</span></a></span><span> </span><span class="annot"><span class="annottext">s1
</span><a href="#local-6989586621679364144"><span class="hs-identifier hs-var">stateR</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-358"></span><span>
</span><span id="line-359"></span><span>    </span><span id="local-6989586621679364143"><span class="annot"><span class="annottext">consume :: Tuple' (PipeState s1 s2) (PipeState s1 s2)
-&gt; a
-&gt; m (Step
        (PipeState
           (Tuple' (PipeState s1 s2) (PipeState s1 s2))
           (Tuple' (PipeState s1 s2) (PipeState s1 s2)))
        c)
</span><a href="#local-6989586621679364143"><span class="hs-identifier hs-var hs-var">consume</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Streamly.Internal.Data.Tuple.Strict.html#Tuple%27"><span class="hs-identifier hs-type">Tuple'</span></a></span><span> </span><span id="local-6989586621679364140"><span class="annot"><span class="annottext">sL :: PipeState s1 s2
</span><a href="#local-6989586621679364140"><span class="hs-identifier hs-var">sL</span></a></span></span><span> </span><span id="local-6989586621679364139"><span class="annot"><span class="annottext">sR :: PipeState s1 s2
</span><a href="#local-6989586621679364139"><span class="hs-identifier hs-var">sR</span></a></span></span><span class="hs-special">)</span><span> </span><span id="local-6989586621679364138"><span class="annot"><span class="annottext">a :: a
</span><a href="#local-6989586621679364138"><span class="hs-identifier hs-var">a</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-360"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">PipeState s1 s2
</span><a href="#local-6989586621679364140"><span class="hs-identifier hs-var">sL</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-361"></span><span>            </span><span class="annot"><a href="Streamly.Internal.Data.Pipe.Types.html#Consume"><span class="hs-identifier hs-type">Consume</span></a></span><span> </span><span id="local-6989586621679364137"><span class="annot"><span class="annottext">stt :: s1
</span><a href="#local-6989586621679364137"><span class="hs-identifier hs-var">stt</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-362"></span><span>                </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">PipeState s1 s2
</span><a href="#local-6989586621679364139"><span class="hs-identifier hs-var">sR</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-363"></span><span>                    </span><span class="annot"><a href="Streamly.Internal.Data.Pipe.Types.html#Consume"><span class="hs-identifier hs-type">Consume</span></a></span><span> </span><span id="local-6989586621679364136"><span class="annot"><span class="annottext">st :: s1
</span><a href="#local-6989586621679364136"><span class="hs-identifier hs-var">st</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-364"></span><span>                        </span><span id="local-6989586621679364135"><span class="annot"><span class="annottext">Step (PipeState s1 s2) b
</span><a href="#local-6989586621679364135"><span class="hs-identifier hs-var">rres</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">s1 -&gt; a -&gt; m (Step (PipeState s1 s2) b)
</span><a href="#local-6989586621679364146"><span class="hs-identifier hs-var">consumeR</span></a></span><span> </span><span class="annot"><span class="annottext">s1
</span><a href="#local-6989586621679364136"><span class="hs-identifier hs-var">st</span></a></span><span> </span><span class="annot"><span class="annottext">a
</span><a href="#local-6989586621679364138"><span class="hs-identifier hs-var">a</span></a></span><span>
</span><span id="line-365"></span><span>                        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Step (PipeState s1 s2) b
</span><a href="#local-6989586621679364135"><span class="hs-identifier hs-var">rres</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-366"></span><span>                            </span><span class="annot"><a href="Streamly.Internal.Data.Pipe.Types.html#Yield"><span class="hs-identifier hs-type">Yield</span></a></span><span> </span><span id="local-6989586621679364134"><span class="annot"><span class="annottext">x :: b
</span><a href="#local-6989586621679364134"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621679364133"><span class="annot"><span class="annottext">sR' :: PipeState s1 s2
</span><a href="#local-6989586621679364133"><span class="hs-identifier hs-var">sR'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-367"></span><span>                                </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679364132"><span class="annot"><span class="annottext">next :: s1 -&gt; PipeState s1 s1
</span><a href="#local-6989586621679364132"><span class="hs-identifier hs-var hs-var">next</span></a></span></span><span> </span><span id="local-6989586621679364131"><span class="annot"><span class="annottext">s :: s1
</span><a href="#local-6989586621679364131"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-368"></span><span>                                        </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">PipeState s1 s2 -&gt; Bool
forall s1 s2. PipeState s1 s2 -&gt; Bool
</span><a href="Streamly.Internal.Data.Pipe.Types.html#isProduce"><span class="hs-identifier hs-var">isProduce</span></a></span><span> </span><span class="annot"><span class="annottext">PipeState s1 s2
</span><a href="#local-6989586621679364133"><span class="hs-identifier hs-var">sR'</span></a></span><span>
</span><span id="line-369"></span><span>                                        </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">s1 -&gt; PipeState s1 s1
forall s1 s2. s2 -&gt; PipeState s1 s2
</span><a href="Streamly.Internal.Data.Pipe.Types.html#Produce"><span class="hs-identifier hs-var">Produce</span></a></span><span> </span><span class="annot"><span class="annottext">s1
</span><a href="#local-6989586621679364131"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-370"></span><span>                                        </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">s1 -&gt; PipeState s1 s1
forall s1 s2. s1 -&gt; PipeState s1 s2
</span><a href="Streamly.Internal.Data.Pipe.Types.html#Consume"><span class="hs-identifier hs-var">Consume</span></a></span><span> </span><span class="annot"><span class="annottext">s1
</span><a href="#local-6989586621679364131"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-371"></span><span>                                </span><span id="local-6989586621679364130"><span class="annot"><span class="annottext">Step (PipeState s1 s2) c
</span><a href="#local-6989586621679364130"><span class="hs-identifier hs-var">lres</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">s1 -&gt; b -&gt; m (Step (PipeState s1 s2) c)
</span><a href="#local-6989586621679364149"><span class="hs-identifier hs-var">consumeL</span></a></span><span> </span><span class="annot"><span class="annottext">s1
</span><a href="#local-6989586621679364137"><span class="hs-identifier hs-var">stt</span></a></span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679364134"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-372"></span><span>                                </span><span class="annot"><span class="annottext">Step
  (PipeState
     (Tuple' (PipeState s1 s2) (PipeState s1 s2))
     (Tuple' (PipeState s1 s2) (PipeState s1 s2)))
  c
-&gt; m (Step
        (PipeState
           (Tuple' (PipeState s1 s2) (PipeState s1 s2))
           (Tuple' (PipeState s1 s2) (PipeState s1 s2)))
        c)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Step
   (PipeState
      (Tuple' (PipeState s1 s2) (PipeState s1 s2))
      (Tuple' (PipeState s1 s2) (PipeState s1 s2)))
   c
 -&gt; m (Step
         (PipeState
            (Tuple' (PipeState s1 s2) (PipeState s1 s2))
            (Tuple' (PipeState s1 s2) (PipeState s1 s2)))
         c))
-&gt; Step
     (PipeState
        (Tuple' (PipeState s1 s2) (PipeState s1 s2))
        (Tuple' (PipeState s1 s2) (PipeState s1 s2)))
     c
-&gt; m (Step
        (PipeState
           (Tuple' (PipeState s1 s2) (PipeState s1 s2))
           (Tuple' (PipeState s1 s2) (PipeState s1 s2)))
        c)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Step (PipeState s1 s2) c
</span><a href="#local-6989586621679364130"><span class="hs-identifier hs-var">lres</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-373"></span><span>                                    </span><span class="annot"><a href="Streamly.Internal.Data.Pipe.Types.html#Yield"><span class="hs-identifier hs-type">Yield</span></a></span><span> </span><span id="local-6989586621679364129"><span class="annot"><span class="annottext">y :: c
</span><a href="#local-6989586621679364129"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span id="local-6989586621679364128"><span class="annot"><span class="annottext">s1 :: PipeState s1 s2
</span><a href="#local-6989586621679364128"><span class="hs-identifier hs-var">s1</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Streamly.Internal.Data.Pipe.Types.html#Consume"><span class="hs-identifier hs-type">Consume</span></a></span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-374"></span><span>                                        </span><span class="annot"><span class="annottext">c
-&gt; PipeState
     (Tuple' (PipeState s1 s2) (PipeState s1 s2))
     (Tuple' (PipeState s1 s2) (PipeState s1 s2))
-&gt; Step
     (PipeState
        (Tuple' (PipeState s1 s2) (PipeState s1 s2))
        (Tuple' (PipeState s1 s2) (PipeState s1 s2)))
     c
forall s a. a -&gt; s -&gt; Step s a
</span><a href="Streamly.Internal.Data.Pipe.Types.html#Yield"><span class="hs-identifier hs-var">Yield</span></a></span><span> </span><span class="annot"><span class="annottext">c
</span><a href="#local-6989586621679364129"><span class="hs-identifier hs-var">y</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Tuple' (PipeState s1 s2) (PipeState s1 s2)
-&gt; PipeState
     (Tuple' (PipeState s1 s2) (PipeState s1 s2))
     (Tuple' (PipeState s1 s2) (PipeState s1 s2))
forall s1. s1 -&gt; PipeState s1 s1
</span><a href="#local-6989586621679364132"><span class="hs-identifier hs-var">next</span></a></span><span> </span><span class="annot"><span class="annottext">(Tuple' (PipeState s1 s2) (PipeState s1 s2)
 -&gt; PipeState
      (Tuple' (PipeState s1 s2) (PipeState s1 s2))
      (Tuple' (PipeState s1 s2) (PipeState s1 s2)))
-&gt; Tuple' (PipeState s1 s2) (PipeState s1 s2)
-&gt; PipeState
     (Tuple' (PipeState s1 s2) (PipeState s1 s2))
     (Tuple' (PipeState s1 s2) (PipeState s1 s2))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PipeState s1 s2
-&gt; PipeState s1 s2 -&gt; Tuple' (PipeState s1 s2) (PipeState s1 s2)
forall a b. a -&gt; b -&gt; Tuple' a b
</span><a href="Streamly.Internal.Data.Tuple.Strict.html#Tuple%27"><span class="hs-identifier hs-var">Tuple'</span></a></span><span> </span><span class="annot"><span class="annottext">PipeState s1 s2
</span><a href="#local-6989586621679364128"><span class="hs-identifier hs-var">s1</span></a></span><span> </span><span class="annot"><span class="annottext">PipeState s1 s2
</span><a href="#local-6989586621679364133"><span class="hs-identifier hs-var">sR'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-375"></span><span>                                    </span><span class="annot"><a href="Streamly.Internal.Data.Pipe.Types.html#Yield"><span class="hs-identifier hs-type">Yield</span></a></span><span> </span><span id="local-6989586621679364127"><span class="annot"><span class="annottext">y :: c
</span><a href="#local-6989586621679364127"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span id="local-6989586621679364126"><span class="annot"><span class="annottext">s1 :: PipeState s1 s2
</span><a href="#local-6989586621679364126"><span class="hs-identifier hs-var">s1</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Streamly.Internal.Data.Pipe.Types.html#Produce"><span class="hs-identifier hs-type">Produce</span></a></span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-376"></span><span>                                        </span><span class="annot"><span class="annottext">c
-&gt; PipeState
     (Tuple' (PipeState s1 s2) (PipeState s1 s2))
     (Tuple' (PipeState s1 s2) (PipeState s1 s2))
-&gt; Step
     (PipeState
        (Tuple' (PipeState s1 s2) (PipeState s1 s2))
        (Tuple' (PipeState s1 s2) (PipeState s1 s2)))
     c
forall s a. a -&gt; s -&gt; Step s a
</span><a href="Streamly.Internal.Data.Pipe.Types.html#Yield"><span class="hs-identifier hs-var">Yield</span></a></span><span> </span><span class="annot"><span class="annottext">c
</span><a href="#local-6989586621679364127"><span class="hs-identifier hs-var">y</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Tuple' (PipeState s1 s2) (PipeState s1 s2)
-&gt; PipeState
     (Tuple' (PipeState s1 s2) (PipeState s1 s2))
     (Tuple' (PipeState s1 s2) (PipeState s1 s2))
forall s1 s2. s2 -&gt; PipeState s1 s2
</span><a href="Streamly.Internal.Data.Pipe.Types.html#Produce"><span class="hs-identifier hs-var">Produce</span></a></span><span> </span><span class="annot"><span class="annottext">(Tuple' (PipeState s1 s2) (PipeState s1 s2)
 -&gt; PipeState
      (Tuple' (PipeState s1 s2) (PipeState s1 s2))
      (Tuple' (PipeState s1 s2) (PipeState s1 s2)))
-&gt; Tuple' (PipeState s1 s2) (PipeState s1 s2)
-&gt; PipeState
     (Tuple' (PipeState s1 s2) (PipeState s1 s2))
     (Tuple' (PipeState s1 s2) (PipeState s1 s2))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PipeState s1 s2
-&gt; PipeState s1 s2 -&gt; Tuple' (PipeState s1 s2) (PipeState s1 s2)
forall a b. a -&gt; b -&gt; Tuple' a b
</span><a href="Streamly.Internal.Data.Tuple.Strict.html#Tuple%27"><span class="hs-identifier hs-var">Tuple'</span></a></span><span> </span><span class="annot"><span class="annottext">PipeState s1 s2
</span><a href="#local-6989586621679364126"><span class="hs-identifier hs-var">s1</span></a></span><span> </span><span class="annot"><span class="annottext">PipeState s1 s2
</span><a href="#local-6989586621679364133"><span class="hs-identifier hs-var">sR'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-377"></span><span>                                    </span><span class="annot"><a href="Streamly.Internal.Data.Pipe.Types.html#Continue"><span class="hs-identifier hs-type">Continue</span></a></span><span> </span><span id="local-6989586621679364125"><span class="annot"><span class="annottext">s1 :: PipeState s1 s2
</span><a href="#local-6989586621679364125"><span class="hs-identifier hs-var">s1</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Streamly.Internal.Data.Pipe.Types.html#Consume"><span class="hs-identifier hs-type">Consume</span></a></span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-378"></span><span>                                        </span><span class="annot"><span class="annottext">PipeState
  (Tuple' (PipeState s1 s2) (PipeState s1 s2))
  (Tuple' (PipeState s1 s2) (PipeState s1 s2))
-&gt; Step
     (PipeState
        (Tuple' (PipeState s1 s2) (PipeState s1 s2))
        (Tuple' (PipeState s1 s2) (PipeState s1 s2)))
     c
forall s a. s -&gt; Step s a
</span><a href="Streamly.Internal.Data.Pipe.Types.html#Continue"><span class="hs-identifier hs-var">Continue</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Tuple' (PipeState s1 s2) (PipeState s1 s2)
-&gt; PipeState
     (Tuple' (PipeState s1 s2) (PipeState s1 s2))
     (Tuple' (PipeState s1 s2) (PipeState s1 s2))
forall s1. s1 -&gt; PipeState s1 s1
</span><a href="#local-6989586621679364132"><span class="hs-identifier hs-var">next</span></a></span><span> </span><span class="annot"><span class="annottext">(Tuple' (PipeState s1 s2) (PipeState s1 s2)
 -&gt; PipeState
      (Tuple' (PipeState s1 s2) (PipeState s1 s2))
      (Tuple' (PipeState s1 s2) (PipeState s1 s2)))
-&gt; Tuple' (PipeState s1 s2) (PipeState s1 s2)
-&gt; PipeState
     (Tuple' (PipeState s1 s2) (PipeState s1 s2))
     (Tuple' (PipeState s1 s2) (PipeState s1 s2))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PipeState s1 s2
-&gt; PipeState s1 s2 -&gt; Tuple' (PipeState s1 s2) (PipeState s1 s2)
forall a b. a -&gt; b -&gt; Tuple' a b
</span><a href="Streamly.Internal.Data.Tuple.Strict.html#Tuple%27"><span class="hs-identifier hs-var">Tuple'</span></a></span><span> </span><span class="annot"><span class="annottext">PipeState s1 s2
</span><a href="#local-6989586621679364125"><span class="hs-identifier hs-var">s1</span></a></span><span> </span><span class="annot"><span class="annottext">PipeState s1 s2
</span><a href="#local-6989586621679364133"><span class="hs-identifier hs-var">sR'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-379"></span><span>                                    </span><span class="annot"><a href="Streamly.Internal.Data.Pipe.Types.html#Continue"><span class="hs-identifier hs-type">Continue</span></a></span><span> </span><span id="local-6989586621679364124"><span class="annot"><span class="annottext">s1 :: PipeState s1 s2
</span><a href="#local-6989586621679364124"><span class="hs-identifier hs-var">s1</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Streamly.Internal.Data.Pipe.Types.html#Produce"><span class="hs-identifier hs-type">Produce</span></a></span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-380"></span><span>                                        </span><span class="annot"><span class="annottext">PipeState
  (Tuple' (PipeState s1 s2) (PipeState s1 s2))
  (Tuple' (PipeState s1 s2) (PipeState s1 s2))
-&gt; Step
     (PipeState
        (Tuple' (PipeState s1 s2) (PipeState s1 s2))
        (Tuple' (PipeState s1 s2) (PipeState s1 s2)))
     c
forall s a. s -&gt; Step s a
</span><a href="Streamly.Internal.Data.Pipe.Types.html#Continue"><span class="hs-identifier hs-var">Continue</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Tuple' (PipeState s1 s2) (PipeState s1 s2)
-&gt; PipeState
     (Tuple' (PipeState s1 s2) (PipeState s1 s2))
     (Tuple' (PipeState s1 s2) (PipeState s1 s2))
forall s1 s2. s2 -&gt; PipeState s1 s2
</span><a href="Streamly.Internal.Data.Pipe.Types.html#Produce"><span class="hs-identifier hs-var">Produce</span></a></span><span> </span><span class="annot"><span class="annottext">(Tuple' (PipeState s1 s2) (PipeState s1 s2)
 -&gt; PipeState
      (Tuple' (PipeState s1 s2) (PipeState s1 s2))
      (Tuple' (PipeState s1 s2) (PipeState s1 s2)))
-&gt; Tuple' (PipeState s1 s2) (PipeState s1 s2)
-&gt; PipeState
     (Tuple' (PipeState s1 s2) (PipeState s1 s2))
     (Tuple' (PipeState s1 s2) (PipeState s1 s2))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PipeState s1 s2
-&gt; PipeState s1 s2 -&gt; Tuple' (PipeState s1 s2) (PipeState s1 s2)
forall a b. a -&gt; b -&gt; Tuple' a b
</span><a href="Streamly.Internal.Data.Tuple.Strict.html#Tuple%27"><span class="hs-identifier hs-var">Tuple'</span></a></span><span> </span><span class="annot"><span class="annottext">PipeState s1 s2
</span><a href="#local-6989586621679364124"><span class="hs-identifier hs-var">s1</span></a></span><span> </span><span class="annot"><span class="annottext">PipeState s1 s2
</span><a href="#local-6989586621679364133"><span class="hs-identifier hs-var">sR'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-381"></span><span>                            </span><span class="annot"><a href="Streamly.Internal.Data.Pipe.Types.html#Continue"><span class="hs-identifier hs-type">Continue</span></a></span><span> </span><span id="local-6989586621679364123"><span class="annot"><span class="annottext">s1 :: PipeState s1 s2
</span><a href="#local-6989586621679364123"><span class="hs-identifier hs-var">s1</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Streamly.Internal.Data.Pipe.Types.html#Consume"><span class="hs-identifier hs-type">Consume</span></a></span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-382"></span><span>                                </span><span class="annot"><span class="annottext">Step
  (PipeState
     (Tuple' (PipeState s1 s2) (PipeState s1 s2))
     (Tuple' (PipeState s1 s2) (PipeState s1 s2)))
  c
-&gt; m (Step
        (PipeState
           (Tuple' (PipeState s1 s2) (PipeState s1 s2))
           (Tuple' (PipeState s1 s2) (PipeState s1 s2)))
        c)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Step
   (PipeState
      (Tuple' (PipeState s1 s2) (PipeState s1 s2))
      (Tuple' (PipeState s1 s2) (PipeState s1 s2)))
   c
 -&gt; m (Step
         (PipeState
            (Tuple' (PipeState s1 s2) (PipeState s1 s2))
            (Tuple' (PipeState s1 s2) (PipeState s1 s2)))
         c))
-&gt; Step
     (PipeState
        (Tuple' (PipeState s1 s2) (PipeState s1 s2))
        (Tuple' (PipeState s1 s2) (PipeState s1 s2)))
     c
-&gt; m (Step
        (PipeState
           (Tuple' (PipeState s1 s2) (PipeState s1 s2))
           (Tuple' (PipeState s1 s2) (PipeState s1 s2)))
        c)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PipeState
  (Tuple' (PipeState s1 s2) (PipeState s1 s2))
  (Tuple' (PipeState s1 s2) (PipeState s1 s2))
-&gt; Step
     (PipeState
        (Tuple' (PipeState s1 s2) (PipeState s1 s2))
        (Tuple' (PipeState s1 s2) (PipeState s1 s2)))
     c
forall s a. s -&gt; Step s a
</span><a href="Streamly.Internal.Data.Pipe.Types.html#Continue"><span class="hs-identifier hs-var">Continue</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Tuple' (PipeState s1 s2) (PipeState s1 s2)
-&gt; PipeState
     (Tuple' (PipeState s1 s2) (PipeState s1 s2))
     (Tuple' (PipeState s1 s2) (PipeState s1 s2))
forall s1 s2. s1 -&gt; PipeState s1 s2
</span><a href="Streamly.Internal.Data.Pipe.Types.html#Consume"><span class="hs-identifier hs-var">Consume</span></a></span><span> </span><span class="annot"><span class="annottext">(Tuple' (PipeState s1 s2) (PipeState s1 s2)
 -&gt; PipeState
      (Tuple' (PipeState s1 s2) (PipeState s1 s2))
      (Tuple' (PipeState s1 s2) (PipeState s1 s2)))
-&gt; Tuple' (PipeState s1 s2) (PipeState s1 s2)
-&gt; PipeState
     (Tuple' (PipeState s1 s2) (PipeState s1 s2))
     (Tuple' (PipeState s1 s2) (PipeState s1 s2))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PipeState s1 s2
-&gt; PipeState s1 s2 -&gt; Tuple' (PipeState s1 s2) (PipeState s1 s2)
forall a b. a -&gt; b -&gt; Tuple' a b
</span><a href="Streamly.Internal.Data.Tuple.Strict.html#Tuple%27"><span class="hs-identifier hs-var">Tuple'</span></a></span><span> </span><span class="annot"><span class="annottext">PipeState s1 s2
</span><a href="#local-6989586621679364140"><span class="hs-identifier hs-var">sL</span></a></span><span> </span><span class="annot"><span class="annottext">PipeState s1 s2
</span><a href="#local-6989586621679364123"><span class="hs-identifier hs-var">s1</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-383"></span><span>                            </span><span class="annot"><a href="Streamly.Internal.Data.Pipe.Types.html#Continue"><span class="hs-identifier hs-type">Continue</span></a></span><span> </span><span id="local-6989586621679364122"><span class="annot"><span class="annottext">s1 :: PipeState s1 s2
</span><a href="#local-6989586621679364122"><span class="hs-identifier hs-var">s1</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Streamly.Internal.Data.Pipe.Types.html#Produce"><span class="hs-identifier hs-type">Produce</span></a></span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-384"></span><span>                                </span><span class="annot"><span class="annottext">Step
  (PipeState
     (Tuple' (PipeState s1 s2) (PipeState s1 s2))
     (Tuple' (PipeState s1 s2) (PipeState s1 s2)))
  c
-&gt; m (Step
        (PipeState
           (Tuple' (PipeState s1 s2) (PipeState s1 s2))
           (Tuple' (PipeState s1 s2) (PipeState s1 s2)))
        c)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Step
   (PipeState
      (Tuple' (PipeState s1 s2) (PipeState s1 s2))
      (Tuple' (PipeState s1 s2) (PipeState s1 s2)))
   c
 -&gt; m (Step
         (PipeState
            (Tuple' (PipeState s1 s2) (PipeState s1 s2))
            (Tuple' (PipeState s1 s2) (PipeState s1 s2)))
         c))
-&gt; Step
     (PipeState
        (Tuple' (PipeState s1 s2) (PipeState s1 s2))
        (Tuple' (PipeState s1 s2) (PipeState s1 s2)))
     c
-&gt; m (Step
        (PipeState
           (Tuple' (PipeState s1 s2) (PipeState s1 s2))
           (Tuple' (PipeState s1 s2) (PipeState s1 s2)))
        c)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PipeState
  (Tuple' (PipeState s1 s2) (PipeState s1 s2))
  (Tuple' (PipeState s1 s2) (PipeState s1 s2))
-&gt; Step
     (PipeState
        (Tuple' (PipeState s1 s2) (PipeState s1 s2))
        (Tuple' (PipeState s1 s2) (PipeState s1 s2)))
     c
forall s a. s -&gt; Step s a
</span><a href="Streamly.Internal.Data.Pipe.Types.html#Continue"><span class="hs-identifier hs-var">Continue</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Tuple' (PipeState s1 s2) (PipeState s1 s2)
-&gt; PipeState
     (Tuple' (PipeState s1 s2) (PipeState s1 s2))
     (Tuple' (PipeState s1 s2) (PipeState s1 s2))
forall s1 s2. s2 -&gt; PipeState s1 s2
</span><a href="Streamly.Internal.Data.Pipe.Types.html#Produce"><span class="hs-identifier hs-var">Produce</span></a></span><span> </span><span class="annot"><span class="annottext">(Tuple' (PipeState s1 s2) (PipeState s1 s2)
 -&gt; PipeState
      (Tuple' (PipeState s1 s2) (PipeState s1 s2))
      (Tuple' (PipeState s1 s2) (PipeState s1 s2)))
-&gt; Tuple' (PipeState s1 s2) (PipeState s1 s2)
-&gt; PipeState
     (Tuple' (PipeState s1 s2) (PipeState s1 s2))
     (Tuple' (PipeState s1 s2) (PipeState s1 s2))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PipeState s1 s2
-&gt; PipeState s1 s2 -&gt; Tuple' (PipeState s1 s2) (PipeState s1 s2)
forall a b. a -&gt; b -&gt; Tuple' a b
</span><a href="Streamly.Internal.Data.Tuple.Strict.html#Tuple%27"><span class="hs-identifier hs-var">Tuple'</span></a></span><span> </span><span class="annot"><span class="annottext">PipeState s1 s2
</span><a href="#local-6989586621679364140"><span class="hs-identifier hs-var">sL</span></a></span><span> </span><span class="annot"><span class="annottext">PipeState s1 s2
</span><a href="#local-6989586621679364122"><span class="hs-identifier hs-var">s1</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-385"></span><span>                    </span><span class="annot"><a href="Streamly.Internal.Data.Pipe.Types.html#Produce"><span class="hs-identifier hs-type">Produce</span></a></span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">m (Step
     (PipeState
        (Tuple' (PipeState s1 s2) (PipeState s1 s2))
        (Tuple' (PipeState s1 s2) (PipeState s1 s2)))
     c)
forall a. HasCallStack =&gt; a
</span><span class="hs-identifier hs-var">undefined</span></span><span>
</span><span id="line-386"></span><span>            </span><span class="hs-comment">-- XXX we should never come here unless the initial state of the</span><span>
</span><span id="line-387"></span><span>            </span><span class="hs-comment">-- first pipe is set to &quot;Right&quot;.</span><span>
</span><span id="line-388"></span><span>            </span><span class="annot"><a href="Streamly.Internal.Data.Pipe.Types.html#Produce"><span class="hs-identifier hs-type">Produce</span></a></span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">m (Step
     (PipeState
        (Tuple' (PipeState s1 s2) (PipeState s1 s2))
        (Tuple' (PipeState s1 s2) (PipeState s1 s2)))
     c)
forall a. HasCallStack =&gt; a
</span><span class="hs-identifier hs-var">undefined</span></span><span>
</span><span id="line-389"></span><span>
</span><span id="line-390"></span><span>    </span><span class="hs-comment">-- XXX we need to write the code in mor optimized fashion. Use Continue</span><span>
</span><span id="line-391"></span><span>    </span><span class="hs-comment">-- more and less yield points.</span><span>
</span><span id="line-392"></span><span>    </span><span id="local-6989586621679364142"><span class="annot"><span class="annottext">produce :: Tuple' (PipeState s1 s2) (PipeState s1 s2)
-&gt; m (Step
        (PipeState
           (Tuple' (PipeState s1 s2) (PipeState s1 s2))
           (Tuple' (PipeState s1 s2) (PipeState s1 s2)))
        c)
</span><a href="#local-6989586621679364142"><span class="hs-identifier hs-var hs-var">produce</span></a></span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Streamly.Internal.Data.Tuple.Strict.html#Tuple%27"><span class="hs-identifier hs-type">Tuple'</span></a></span><span> </span><span id="local-6989586621679364121"><span class="annot"><span class="annottext">sL :: PipeState s1 s2
</span><a href="#local-6989586621679364121"><span class="hs-identifier hs-var">sL</span></a></span></span><span> </span><span id="local-6989586621679364120"><span class="annot"><span class="annottext">sR :: PipeState s1 s2
</span><a href="#local-6989586621679364120"><span class="hs-identifier hs-var">sR</span></a></span></span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-393"></span><span>        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">PipeState s1 s2
</span><a href="#local-6989586621679364121"><span class="hs-identifier hs-var">sL</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-394"></span><span>            </span><span class="annot"><a href="Streamly.Internal.Data.Pipe.Types.html#Produce"><span class="hs-identifier hs-type">Produce</span></a></span><span> </span><span id="local-6989586621679364119"><span class="annot"><span class="annottext">st :: s2
</span><a href="#local-6989586621679364119"><span class="hs-identifier hs-var">st</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-395"></span><span>                </span><span id="local-6989586621679364118"><span class="annot"><span class="annottext">Step (PipeState s1 s2) c
</span><a href="#local-6989586621679364118"><span class="hs-identifier hs-var">r</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">s2 -&gt; m (Step (PipeState s1 s2) c)
</span><a href="#local-6989586621679364148"><span class="hs-identifier hs-var">produceL</span></a></span><span> </span><span class="annot"><span class="annottext">s2
</span><a href="#local-6989586621679364119"><span class="hs-identifier hs-var">st</span></a></span><span>
</span><span id="line-396"></span><span>                </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679364117"><span class="annot"><span class="annottext">next :: s1 -&gt; PipeState s1 s1
</span><a href="#local-6989586621679364117"><span class="hs-identifier hs-var hs-var">next</span></a></span></span><span> </span><span id="local-6989586621679364116"><span class="annot"><span class="annottext">s :: s1
</span><a href="#local-6989586621679364116"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">PipeState s1 s2 -&gt; Bool
forall s1 s2. PipeState s1 s2 -&gt; Bool
</span><a href="Streamly.Internal.Data.Pipe.Types.html#isProduce"><span class="hs-identifier hs-var">isProduce</span></a></span><span> </span><span class="annot"><span class="annottext">PipeState s1 s2
</span><a href="#local-6989586621679364120"><span class="hs-identifier hs-var">sR</span></a></span><span> </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">s1 -&gt; PipeState s1 s1
forall s1 s2. s2 -&gt; PipeState s1 s2
</span><a href="Streamly.Internal.Data.Pipe.Types.html#Produce"><span class="hs-identifier hs-var">Produce</span></a></span><span> </span><span class="annot"><span class="annottext">s1
</span><a href="#local-6989586621679364116"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">s1 -&gt; PipeState s1 s1
forall s1 s2. s1 -&gt; PipeState s1 s2
</span><a href="Streamly.Internal.Data.Pipe.Types.html#Consume"><span class="hs-identifier hs-var">Consume</span></a></span><span> </span><span class="annot"><span class="annottext">s1
</span><a href="#local-6989586621679364116"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-397"></span><span>                </span><span class="annot"><span class="annottext">Step
  (PipeState
     (Tuple' (PipeState s1 s2) (PipeState s1 s2))
     (Tuple' (PipeState s1 s2) (PipeState s1 s2)))
  c
-&gt; m (Step
        (PipeState
           (Tuple' (PipeState s1 s2) (PipeState s1 s2))
           (Tuple' (PipeState s1 s2) (PipeState s1 s2)))
        c)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Step
   (PipeState
      (Tuple' (PipeState s1 s2) (PipeState s1 s2))
      (Tuple' (PipeState s1 s2) (PipeState s1 s2)))
   c
 -&gt; m (Step
         (PipeState
            (Tuple' (PipeState s1 s2) (PipeState s1 s2))
            (Tuple' (PipeState s1 s2) (PipeState s1 s2)))
         c))
-&gt; Step
     (PipeState
        (Tuple' (PipeState s1 s2) (PipeState s1 s2))
        (Tuple' (PipeState s1 s2) (PipeState s1 s2)))
     c
-&gt; m (Step
        (PipeState
           (Tuple' (PipeState s1 s2) (PipeState s1 s2))
           (Tuple' (PipeState s1 s2) (PipeState s1 s2)))
        c)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Step (PipeState s1 s2) c
</span><a href="#local-6989586621679364118"><span class="hs-identifier hs-var">r</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-398"></span><span>                    </span><span class="annot"><a href="Streamly.Internal.Data.Pipe.Types.html#Yield"><span class="hs-identifier hs-type">Yield</span></a></span><span> </span><span id="local-6989586621679364115"><span class="annot"><span class="annottext">x :: c
</span><a href="#local-6989586621679364115"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621679364114"><span class="annot"><span class="annottext">s :: PipeState s1 s2
</span><a href="#local-6989586621679364114"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Streamly.Internal.Data.Pipe.Types.html#Consume"><span class="hs-identifier hs-type">Consume</span></a></span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">c
-&gt; PipeState
     (Tuple' (PipeState s1 s2) (PipeState s1 s2))
     (Tuple' (PipeState s1 s2) (PipeState s1 s2))
-&gt; Step
     (PipeState
        (Tuple' (PipeState s1 s2) (PipeState s1 s2))
        (Tuple' (PipeState s1 s2) (PipeState s1 s2)))
     c
forall s a. a -&gt; s -&gt; Step s a
</span><a href="Streamly.Internal.Data.Pipe.Types.html#Yield"><span class="hs-identifier hs-var">Yield</span></a></span><span> </span><span class="annot"><span class="annottext">c
</span><a href="#local-6989586621679364115"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Tuple' (PipeState s1 s2) (PipeState s1 s2)
-&gt; PipeState
     (Tuple' (PipeState s1 s2) (PipeState s1 s2))
     (Tuple' (PipeState s1 s2) (PipeState s1 s2))
forall s1. s1 -&gt; PipeState s1 s1
</span><a href="#local-6989586621679364117"><span class="hs-identifier hs-var">next</span></a></span><span> </span><span class="annot"><span class="annottext">(Tuple' (PipeState s1 s2) (PipeState s1 s2)
 -&gt; PipeState
      (Tuple' (PipeState s1 s2) (PipeState s1 s2))
      (Tuple' (PipeState s1 s2) (PipeState s1 s2)))
-&gt; Tuple' (PipeState s1 s2) (PipeState s1 s2)
-&gt; PipeState
     (Tuple' (PipeState s1 s2) (PipeState s1 s2))
     (Tuple' (PipeState s1 s2) (PipeState s1 s2))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PipeState s1 s2
-&gt; PipeState s1 s2 -&gt; Tuple' (PipeState s1 s2) (PipeState s1 s2)
forall a b. a -&gt; b -&gt; Tuple' a b
</span><a href="Streamly.Internal.Data.Tuple.Strict.html#Tuple%27"><span class="hs-identifier hs-var">Tuple'</span></a></span><span> </span><span class="annot"><span class="annottext">PipeState s1 s2
</span><a href="#local-6989586621679364114"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">PipeState s1 s2
</span><a href="#local-6989586621679364120"><span class="hs-identifier hs-var">sR</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-399"></span><span>                    </span><span class="annot"><a href="Streamly.Internal.Data.Pipe.Types.html#Yield"><span class="hs-identifier hs-type">Yield</span></a></span><span> </span><span id="local-6989586621679364113"><span class="annot"><span class="annottext">x :: c
</span><a href="#local-6989586621679364113"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621679364112"><span class="annot"><span class="annottext">s :: PipeState s1 s2
</span><a href="#local-6989586621679364112"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Streamly.Internal.Data.Pipe.Types.html#Produce"><span class="hs-identifier hs-type">Produce</span></a></span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">c
-&gt; PipeState
     (Tuple' (PipeState s1 s2) (PipeState s1 s2))
     (Tuple' (PipeState s1 s2) (PipeState s1 s2))
-&gt; Step
     (PipeState
        (Tuple' (PipeState s1 s2) (PipeState s1 s2))
        (Tuple' (PipeState s1 s2) (PipeState s1 s2)))
     c
forall s a. a -&gt; s -&gt; Step s a
</span><a href="Streamly.Internal.Data.Pipe.Types.html#Yield"><span class="hs-identifier hs-var">Yield</span></a></span><span> </span><span class="annot"><span class="annottext">c
</span><a href="#local-6989586621679364113"><span class="hs-identifier hs-var">x</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Tuple' (PipeState s1 s2) (PipeState s1 s2)
-&gt; PipeState
     (Tuple' (PipeState s1 s2) (PipeState s1 s2))
     (Tuple' (PipeState s1 s2) (PipeState s1 s2))
forall s1 s2. s2 -&gt; PipeState s1 s2
</span><a href="Streamly.Internal.Data.Pipe.Types.html#Produce"><span class="hs-identifier hs-var">Produce</span></a></span><span> </span><span class="annot"><span class="annottext">(Tuple' (PipeState s1 s2) (PipeState s1 s2)
 -&gt; PipeState
      (Tuple' (PipeState s1 s2) (PipeState s1 s2))
      (Tuple' (PipeState s1 s2) (PipeState s1 s2)))
-&gt; Tuple' (PipeState s1 s2) (PipeState s1 s2)
-&gt; PipeState
     (Tuple' (PipeState s1 s2) (PipeState s1 s2))
     (Tuple' (PipeState s1 s2) (PipeState s1 s2))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PipeState s1 s2
-&gt; PipeState s1 s2 -&gt; Tuple' (PipeState s1 s2) (PipeState s1 s2)
forall a b. a -&gt; b -&gt; Tuple' a b
</span><a href="Streamly.Internal.Data.Tuple.Strict.html#Tuple%27"><span class="hs-identifier hs-var">Tuple'</span></a></span><span> </span><span class="annot"><span class="annottext">PipeState s1 s2
</span><a href="#local-6989586621679364112"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">PipeState s1 s2
</span><a href="#local-6989586621679364120"><span class="hs-identifier hs-var">sR</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-400"></span><span>                    </span><span class="annot"><a href="Streamly.Internal.Data.Pipe.Types.html#Continue"><span class="hs-identifier hs-type">Continue</span></a></span><span> </span><span id="local-6989586621679364111"><span class="annot"><span class="annottext">s :: PipeState s1 s2
</span><a href="#local-6989586621679364111"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Streamly.Internal.Data.Pipe.Types.html#Consume"><span class="hs-identifier hs-type">Consume</span></a></span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PipeState
  (Tuple' (PipeState s1 s2) (PipeState s1 s2))
  (Tuple' (PipeState s1 s2) (PipeState s1 s2))
-&gt; Step
     (PipeState
        (Tuple' (PipeState s1 s2) (PipeState s1 s2))
        (Tuple' (PipeState s1 s2) (PipeState s1 s2)))
     c
forall s a. s -&gt; Step s a
</span><a href="Streamly.Internal.Data.Pipe.Types.html#Continue"><span class="hs-identifier hs-var">Continue</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Tuple' (PipeState s1 s2) (PipeState s1 s2)
-&gt; PipeState
     (Tuple' (PipeState s1 s2) (PipeState s1 s2))
     (Tuple' (PipeState s1 s2) (PipeState s1 s2))
forall s1. s1 -&gt; PipeState s1 s1
</span><a href="#local-6989586621679364117"><span class="hs-identifier hs-var">next</span></a></span><span> </span><span class="annot"><span class="annottext">(Tuple' (PipeState s1 s2) (PipeState s1 s2)
 -&gt; PipeState
      (Tuple' (PipeState s1 s2) (PipeState s1 s2))
      (Tuple' (PipeState s1 s2) (PipeState s1 s2)))
-&gt; Tuple' (PipeState s1 s2) (PipeState s1 s2)
-&gt; PipeState
     (Tuple' (PipeState s1 s2) (PipeState s1 s2))
     (Tuple' (PipeState s1 s2) (PipeState s1 s2))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PipeState s1 s2
-&gt; PipeState s1 s2 -&gt; Tuple' (PipeState s1 s2) (PipeState s1 s2)
forall a b. a -&gt; b -&gt; Tuple' a b
</span><a href="Streamly.Internal.Data.Tuple.Strict.html#Tuple%27"><span class="hs-identifier hs-var">Tuple'</span></a></span><span> </span><span class="annot"><span class="annottext">PipeState s1 s2
</span><a href="#local-6989586621679364111"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">PipeState s1 s2
</span><a href="#local-6989586621679364120"><span class="hs-identifier hs-var">sR</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-401"></span><span>                    </span><span class="annot"><a href="Streamly.Internal.Data.Pipe.Types.html#Continue"><span class="hs-identifier hs-type">Continue</span></a></span><span> </span><span id="local-6989586621679364110"><span class="annot"><span class="annottext">s :: PipeState s1 s2
</span><a href="#local-6989586621679364110"><span class="hs-identifier hs-var">s</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Streamly.Internal.Data.Pipe.Types.html#Produce"><span class="hs-identifier hs-type">Produce</span></a></span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">PipeState
  (Tuple' (PipeState s1 s2) (PipeState s1 s2))
  (Tuple' (PipeState s1 s2) (PipeState s1 s2))
-&gt; Step
     (PipeState
        (Tuple' (PipeState s1 s2) (PipeState s1 s2))
        (Tuple' (PipeState s1 s2) (PipeState s1 s2)))
     c
forall s a. s -&gt; Step s a
</span><a href="Streamly.Internal.Data.Pipe.Types.html#Continue"><span class="hs-identifier hs-var">Continue</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Tuple' (PipeState s1 s2) (PipeState s1 s2)
-&gt; PipeState
     (Tuple' (PipeState s1 s2) (PipeState s1 s2))
     (Tuple' (PipeState s1 s2) (PipeState s1 s2))
forall s1 s2. s2 -&gt; PipeState s1 s2
</span><a href="Streamly.Internal.Data.Pipe.Types.html#Produce"><span class="hs-identifier hs-var">Produce</span></a></span><span> </span><span class="annot"><span class="annottext">(Tuple' (PipeState s1 s2) (PipeState s1 s2)
 -&gt; PipeState
      (Tuple' (PipeState s1 s2) (PipeState s1 s2))
      (Tuple' (PipeState s1 s2) (PipeState s1 s2)))
-&gt; Tuple' (PipeState s1 s2) (PipeState s1 s2)
-&gt; PipeState
     (Tuple' (PipeState s1 s2) (PipeState s1 s2))
     (Tuple' (PipeState s1 s2) (PipeState s1 s2))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PipeState s1 s2
-&gt; PipeState s1 s2 -&gt; Tuple' (PipeState s1 s2) (PipeState s1 s2)
forall a b. a -&gt; b -&gt; Tuple' a b
</span><a href="Streamly.Internal.Data.Tuple.Strict.html#Tuple%27"><span class="hs-identifier hs-var">Tuple'</span></a></span><span> </span><span class="annot"><span class="annottext">PipeState s1 s2
</span><a href="#local-6989586621679364110"><span class="hs-identifier hs-var">s</span></a></span><span> </span><span class="annot"><span class="annottext">PipeState s1 s2
</span><a href="#local-6989586621679364120"><span class="hs-identifier hs-var">sR</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-402"></span><span>            </span><span class="annot"><a href="Streamly.Internal.Data.Pipe.Types.html#Consume"><span class="hs-identifier hs-type">Consume</span></a></span><span> </span><span id="local-6989586621679364109"><span class="annot"><span class="annottext">stt :: s1
</span><a href="#local-6989586621679364109"><span class="hs-identifier hs-var">stt</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-403"></span><span>                </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">PipeState s1 s2
</span><a href="#local-6989586621679364120"><span class="hs-identifier hs-var">sR</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-404"></span><span>                    </span><span class="annot"><a href="Streamly.Internal.Data.Pipe.Types.html#Produce"><span class="hs-identifier hs-type">Produce</span></a></span><span> </span><span id="local-6989586621679364108"><span class="annot"><span class="annottext">st :: s2
</span><a href="#local-6989586621679364108"><span class="hs-identifier hs-var">st</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-405"></span><span>                        </span><span id="local-6989586621679364107"><span class="annot"><span class="annottext">Step (PipeState s1 s2) b
</span><a href="#local-6989586621679364107"><span class="hs-identifier hs-var">rR</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">s2 -&gt; m (Step (PipeState s1 s2) b)
</span><a href="#local-6989586621679364145"><span class="hs-identifier hs-var">produceR</span></a></span><span> </span><span class="annot"><span class="annottext">s2
</span><a href="#local-6989586621679364108"><span class="hs-identifier hs-var">st</span></a></span><span>
</span><span id="line-406"></span><span>                        </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Step (PipeState s1 s2) b
</span><a href="#local-6989586621679364107"><span class="hs-identifier hs-var">rR</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-407"></span><span>                            </span><span class="annot"><a href="Streamly.Internal.Data.Pipe.Types.html#Yield"><span class="hs-identifier hs-type">Yield</span></a></span><span> </span><span id="local-6989586621679364106"><span class="annot"><span class="annottext">x :: b
</span><a href="#local-6989586621679364106"><span class="hs-identifier hs-var">x</span></a></span></span><span> </span><span id="local-6989586621679364105"><span class="annot"><span class="annottext">sR' :: PipeState s1 s2
</span><a href="#local-6989586621679364105"><span class="hs-identifier hs-var">sR'</span></a></span></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">do</span><span>
</span><span id="line-408"></span><span>                                </span><span class="hs-keyword">let</span><span> </span><span id="local-6989586621679364104"><span class="annot"><span class="annottext">next :: s1 -&gt; PipeState s1 s1
</span><a href="#local-6989586621679364104"><span class="hs-identifier hs-var hs-var">next</span></a></span></span><span> </span><span id="local-6989586621679364103"><span class="annot"><span class="annottext">s :: s1
</span><a href="#local-6989586621679364103"><span class="hs-identifier hs-var">s</span></a></span></span><span> </span><span class="hs-glyph">=</span><span>
</span><span id="line-409"></span><span>                                        </span><span class="hs-keyword">if</span><span> </span><span class="annot"><span class="annottext">PipeState s1 s2 -&gt; Bool
forall s1 s2. PipeState s1 s2 -&gt; Bool
</span><a href="Streamly.Internal.Data.Pipe.Types.html#isProduce"><span class="hs-identifier hs-var">isProduce</span></a></span><span> </span><span class="annot"><span class="annottext">PipeState s1 s2
</span><a href="#local-6989586621679364105"><span class="hs-identifier hs-var">sR'</span></a></span><span>
</span><span id="line-410"></span><span>                                        </span><span class="hs-keyword">then</span><span> </span><span class="annot"><span class="annottext">s1 -&gt; PipeState s1 s1
forall s1 s2. s2 -&gt; PipeState s1 s2
</span><a href="Streamly.Internal.Data.Pipe.Types.html#Produce"><span class="hs-identifier hs-var">Produce</span></a></span><span> </span><span class="annot"><span class="annottext">s1
</span><a href="#local-6989586621679364103"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-411"></span><span>                                        </span><span class="hs-keyword">else</span><span> </span><span class="annot"><span class="annottext">s1 -&gt; PipeState s1 s1
forall s1 s2. s1 -&gt; PipeState s1 s2
</span><a href="Streamly.Internal.Data.Pipe.Types.html#Consume"><span class="hs-identifier hs-var">Consume</span></a></span><span> </span><span class="annot"><span class="annottext">s1
</span><a href="#local-6989586621679364103"><span class="hs-identifier hs-var">s</span></a></span><span>
</span><span id="line-412"></span><span>                                </span><span id="local-6989586621679364102"><span class="annot"><span class="annottext">Step (PipeState s1 s2) c
</span><a href="#local-6989586621679364102"><span class="hs-identifier hs-var">rL</span></a></span></span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="annot"><span class="annottext">s1 -&gt; b -&gt; m (Step (PipeState s1 s2) c)
</span><a href="#local-6989586621679364149"><span class="hs-identifier hs-var">consumeL</span></a></span><span> </span><span class="annot"><span class="annottext">s1
</span><a href="#local-6989586621679364109"><span class="hs-identifier hs-var">stt</span></a></span><span> </span><span class="annot"><span class="annottext">b
</span><a href="#local-6989586621679364106"><span class="hs-identifier hs-var">x</span></a></span><span>
</span><span id="line-413"></span><span>                                </span><span class="annot"><span class="annottext">Step
  (PipeState
     (Tuple' (PipeState s1 s2) (PipeState s1 s2))
     (Tuple' (PipeState s1 s2) (PipeState s1 s2)))
  c
-&gt; m (Step
        (PipeState
           (Tuple' (PipeState s1 s2) (PipeState s1 s2))
           (Tuple' (PipeState s1 s2) (PipeState s1 s2)))
        c)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Step
   (PipeState
      (Tuple' (PipeState s1 s2) (PipeState s1 s2))
      (Tuple' (PipeState s1 s2) (PipeState s1 s2)))
   c
 -&gt; m (Step
         (PipeState
            (Tuple' (PipeState s1 s2) (PipeState s1 s2))
            (Tuple' (PipeState s1 s2) (PipeState s1 s2)))
         c))
-&gt; Step
     (PipeState
        (Tuple' (PipeState s1 s2) (PipeState s1 s2))
        (Tuple' (PipeState s1 s2) (PipeState s1 s2)))
     c
-&gt; m (Step
        (PipeState
           (Tuple' (PipeState s1 s2) (PipeState s1 s2))
           (Tuple' (PipeState s1 s2) (PipeState s1 s2)))
        c)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="hs-keyword">case</span><span> </span><span class="annot"><span class="annottext">Step (PipeState s1 s2) c
</span><a href="#local-6989586621679364102"><span class="hs-identifier hs-var">rL</span></a></span><span> </span><span class="hs-keyword">of</span><span>
</span><span id="line-414"></span><span>                                    </span><span class="annot"><a href="Streamly.Internal.Data.Pipe.Types.html#Yield"><span class="hs-identifier hs-type">Yield</span></a></span><span> </span><span id="local-6989586621679364101"><span class="annot"><span class="annottext">y :: c
</span><a href="#local-6989586621679364101"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span id="local-6989586621679364100"><span class="annot"><span class="annottext">s1 :: PipeState s1 s2
</span><a href="#local-6989586621679364100"><span class="hs-identifier hs-var">s1</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Streamly.Internal.Data.Pipe.Types.html#Consume"><span class="hs-identifier hs-type">Consume</span></a></span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-415"></span><span>                                        </span><span class="annot"><span class="annottext">c
-&gt; PipeState
     (Tuple' (PipeState s1 s2) (PipeState s1 s2))
     (Tuple' (PipeState s1 s2) (PipeState s1 s2))
-&gt; Step
     (PipeState
        (Tuple' (PipeState s1 s2) (PipeState s1 s2))
        (Tuple' (PipeState s1 s2) (PipeState s1 s2)))
     c
forall s a. a -&gt; s -&gt; Step s a
</span><a href="Streamly.Internal.Data.Pipe.Types.html#Yield"><span class="hs-identifier hs-var">Yield</span></a></span><span> </span><span class="annot"><span class="annottext">c
</span><a href="#local-6989586621679364101"><span class="hs-identifier hs-var">y</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Tuple' (PipeState s1 s2) (PipeState s1 s2)
-&gt; PipeState
     (Tuple' (PipeState s1 s2) (PipeState s1 s2))
     (Tuple' (PipeState s1 s2) (PipeState s1 s2))
forall s1. s1 -&gt; PipeState s1 s1
</span><a href="#local-6989586621679364104"><span class="hs-identifier hs-var">next</span></a></span><span> </span><span class="annot"><span class="annottext">(Tuple' (PipeState s1 s2) (PipeState s1 s2)
 -&gt; PipeState
      (Tuple' (PipeState s1 s2) (PipeState s1 s2))
      (Tuple' (PipeState s1 s2) (PipeState s1 s2)))
-&gt; Tuple' (PipeState s1 s2) (PipeState s1 s2)
-&gt; PipeState
     (Tuple' (PipeState s1 s2) (PipeState s1 s2))
     (Tuple' (PipeState s1 s2) (PipeState s1 s2))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PipeState s1 s2
-&gt; PipeState s1 s2 -&gt; Tuple' (PipeState s1 s2) (PipeState s1 s2)
forall a b. a -&gt; b -&gt; Tuple' a b
</span><a href="Streamly.Internal.Data.Tuple.Strict.html#Tuple%27"><span class="hs-identifier hs-var">Tuple'</span></a></span><span> </span><span class="annot"><span class="annottext">PipeState s1 s2
</span><a href="#local-6989586621679364100"><span class="hs-identifier hs-var">s1</span></a></span><span> </span><span class="annot"><span class="annottext">PipeState s1 s2
</span><a href="#local-6989586621679364105"><span class="hs-identifier hs-var">sR'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-416"></span><span>                                    </span><span class="annot"><a href="Streamly.Internal.Data.Pipe.Types.html#Yield"><span class="hs-identifier hs-type">Yield</span></a></span><span> </span><span id="local-6989586621679364099"><span class="annot"><span class="annottext">y :: c
</span><a href="#local-6989586621679364099"><span class="hs-identifier hs-var">y</span></a></span></span><span> </span><span id="local-6989586621679364098"><span class="annot"><span class="annottext">s1 :: PipeState s1 s2
</span><a href="#local-6989586621679364098"><span class="hs-identifier hs-var">s1</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Streamly.Internal.Data.Pipe.Types.html#Produce"><span class="hs-identifier hs-type">Produce</span></a></span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-417"></span><span>                                        </span><span class="annot"><span class="annottext">c
-&gt; PipeState
     (Tuple' (PipeState s1 s2) (PipeState s1 s2))
     (Tuple' (PipeState s1 s2) (PipeState s1 s2))
-&gt; Step
     (PipeState
        (Tuple' (PipeState s1 s2) (PipeState s1 s2))
        (Tuple' (PipeState s1 s2) (PipeState s1 s2)))
     c
forall s a. a -&gt; s -&gt; Step s a
</span><a href="Streamly.Internal.Data.Pipe.Types.html#Yield"><span class="hs-identifier hs-var">Yield</span></a></span><span> </span><span class="annot"><span class="annottext">c
</span><a href="#local-6989586621679364099"><span class="hs-identifier hs-var">y</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Tuple' (PipeState s1 s2) (PipeState s1 s2)
-&gt; PipeState
     (Tuple' (PipeState s1 s2) (PipeState s1 s2))
     (Tuple' (PipeState s1 s2) (PipeState s1 s2))
forall s1 s2. s2 -&gt; PipeState s1 s2
</span><a href="Streamly.Internal.Data.Pipe.Types.html#Produce"><span class="hs-identifier hs-var">Produce</span></a></span><span> </span><span class="annot"><span class="annottext">(Tuple' (PipeState s1 s2) (PipeState s1 s2)
 -&gt; PipeState
      (Tuple' (PipeState s1 s2) (PipeState s1 s2))
      (Tuple' (PipeState s1 s2) (PipeState s1 s2)))
-&gt; Tuple' (PipeState s1 s2) (PipeState s1 s2)
-&gt; PipeState
     (Tuple' (PipeState s1 s2) (PipeState s1 s2))
     (Tuple' (PipeState s1 s2) (PipeState s1 s2))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PipeState s1 s2
-&gt; PipeState s1 s2 -&gt; Tuple' (PipeState s1 s2) (PipeState s1 s2)
forall a b. a -&gt; b -&gt; Tuple' a b
</span><a href="Streamly.Internal.Data.Tuple.Strict.html#Tuple%27"><span class="hs-identifier hs-var">Tuple'</span></a></span><span> </span><span class="annot"><span class="annottext">PipeState s1 s2
</span><a href="#local-6989586621679364098"><span class="hs-identifier hs-var">s1</span></a></span><span> </span><span class="annot"><span class="annottext">PipeState s1 s2
</span><a href="#local-6989586621679364105"><span class="hs-identifier hs-var">sR'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-418"></span><span>                                    </span><span class="annot"><a href="Streamly.Internal.Data.Pipe.Types.html#Continue"><span class="hs-identifier hs-type">Continue</span></a></span><span> </span><span id="local-6989586621679364097"><span class="annot"><span class="annottext">s1 :: PipeState s1 s2
</span><a href="#local-6989586621679364097"><span class="hs-identifier hs-var">s1</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Streamly.Internal.Data.Pipe.Types.html#Consume"><span class="hs-identifier hs-type">Consume</span></a></span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-419"></span><span>                                        </span><span class="annot"><span class="annottext">PipeState
  (Tuple' (PipeState s1 s2) (PipeState s1 s2))
  (Tuple' (PipeState s1 s2) (PipeState s1 s2))
-&gt; Step
     (PipeState
        (Tuple' (PipeState s1 s2) (PipeState s1 s2))
        (Tuple' (PipeState s1 s2) (PipeState s1 s2)))
     c
forall s a. s -&gt; Step s a
</span><a href="Streamly.Internal.Data.Pipe.Types.html#Continue"><span class="hs-identifier hs-var">Continue</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Tuple' (PipeState s1 s2) (PipeState s1 s2)
-&gt; PipeState
     (Tuple' (PipeState s1 s2) (PipeState s1 s2))
     (Tuple' (PipeState s1 s2) (PipeState s1 s2))
forall s1. s1 -&gt; PipeState s1 s1
</span><a href="#local-6989586621679364104"><span class="hs-identifier hs-var">next</span></a></span><span> </span><span class="annot"><span class="annottext">(Tuple' (PipeState s1 s2) (PipeState s1 s2)
 -&gt; PipeState
      (Tuple' (PipeState s1 s2) (PipeState s1 s2))
      (Tuple' (PipeState s1 s2) (PipeState s1 s2)))
-&gt; Tuple' (PipeState s1 s2) (PipeState s1 s2)
-&gt; PipeState
     (Tuple' (PipeState s1 s2) (PipeState s1 s2))
     (Tuple' (PipeState s1 s2) (PipeState s1 s2))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PipeState s1 s2
-&gt; PipeState s1 s2 -&gt; Tuple' (PipeState s1 s2) (PipeState s1 s2)
forall a b. a -&gt; b -&gt; Tuple' a b
</span><a href="Streamly.Internal.Data.Tuple.Strict.html#Tuple%27"><span class="hs-identifier hs-var">Tuple'</span></a></span><span> </span><span class="annot"><span class="annottext">PipeState s1 s2
</span><a href="#local-6989586621679364097"><span class="hs-identifier hs-var">s1</span></a></span><span> </span><span class="annot"><span class="annottext">PipeState s1 s2
</span><a href="#local-6989586621679364105"><span class="hs-identifier hs-var">sR'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-420"></span><span>                                    </span><span class="annot"><a href="Streamly.Internal.Data.Pipe.Types.html#Continue"><span class="hs-identifier hs-type">Continue</span></a></span><span> </span><span id="local-6989586621679364096"><span class="annot"><span class="annottext">s1 :: PipeState s1 s2
</span><a href="#local-6989586621679364096"><span class="hs-identifier hs-var">s1</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Streamly.Internal.Data.Pipe.Types.html#Produce"><span class="hs-identifier hs-type">Produce</span></a></span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-421"></span><span>                                        </span><span class="annot"><span class="annottext">PipeState
  (Tuple' (PipeState s1 s2) (PipeState s1 s2))
  (Tuple' (PipeState s1 s2) (PipeState s1 s2))
-&gt; Step
     (PipeState
        (Tuple' (PipeState s1 s2) (PipeState s1 s2))
        (Tuple' (PipeState s1 s2) (PipeState s1 s2)))
     c
forall s a. s -&gt; Step s a
</span><a href="Streamly.Internal.Data.Pipe.Types.html#Continue"><span class="hs-identifier hs-var">Continue</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Tuple' (PipeState s1 s2) (PipeState s1 s2)
-&gt; PipeState
     (Tuple' (PipeState s1 s2) (PipeState s1 s2))
     (Tuple' (PipeState s1 s2) (PipeState s1 s2))
forall s1 s2. s2 -&gt; PipeState s1 s2
</span><a href="Streamly.Internal.Data.Pipe.Types.html#Produce"><span class="hs-identifier hs-var">Produce</span></a></span><span> </span><span class="annot"><span class="annottext">(Tuple' (PipeState s1 s2) (PipeState s1 s2)
 -&gt; PipeState
      (Tuple' (PipeState s1 s2) (PipeState s1 s2))
      (Tuple' (PipeState s1 s2) (PipeState s1 s2)))
-&gt; Tuple' (PipeState s1 s2) (PipeState s1 s2)
-&gt; PipeState
     (Tuple' (PipeState s1 s2) (PipeState s1 s2))
     (Tuple' (PipeState s1 s2) (PipeState s1 s2))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PipeState s1 s2
-&gt; PipeState s1 s2 -&gt; Tuple' (PipeState s1 s2) (PipeState s1 s2)
forall a b. a -&gt; b -&gt; Tuple' a b
</span><a href="Streamly.Internal.Data.Tuple.Strict.html#Tuple%27"><span class="hs-identifier hs-var">Tuple'</span></a></span><span> </span><span class="annot"><span class="annottext">PipeState s1 s2
</span><a href="#local-6989586621679364096"><span class="hs-identifier hs-var">s1</span></a></span><span> </span><span class="annot"><span class="annottext">PipeState s1 s2
</span><a href="#local-6989586621679364105"><span class="hs-identifier hs-var">sR'</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-422"></span><span>                            </span><span class="annot"><a href="Streamly.Internal.Data.Pipe.Types.html#Continue"><span class="hs-identifier hs-type">Continue</span></a></span><span> </span><span id="local-6989586621679364095"><span class="annot"><span class="annottext">s1 :: PipeState s1 s2
</span><a href="#local-6989586621679364095"><span class="hs-identifier hs-var">s1</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Streamly.Internal.Data.Pipe.Types.html#Consume"><span class="hs-identifier hs-type">Consume</span></a></span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-423"></span><span>                                </span><span class="annot"><span class="annottext">Step
  (PipeState
     (Tuple' (PipeState s1 s2) (PipeState s1 s2))
     (Tuple' (PipeState s1 s2) (PipeState s1 s2)))
  c
-&gt; m (Step
        (PipeState
           (Tuple' (PipeState s1 s2) (PipeState s1 s2))
           (Tuple' (PipeState s1 s2) (PipeState s1 s2)))
        c)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Step
   (PipeState
      (Tuple' (PipeState s1 s2) (PipeState s1 s2))
      (Tuple' (PipeState s1 s2) (PipeState s1 s2)))
   c
 -&gt; m (Step
         (PipeState
            (Tuple' (PipeState s1 s2) (PipeState s1 s2))
            (Tuple' (PipeState s1 s2) (PipeState s1 s2)))
         c))
-&gt; Step
     (PipeState
        (Tuple' (PipeState s1 s2) (PipeState s1 s2))
        (Tuple' (PipeState s1 s2) (PipeState s1 s2)))
     c
-&gt; m (Step
        (PipeState
           (Tuple' (PipeState s1 s2) (PipeState s1 s2))
           (Tuple' (PipeState s1 s2) (PipeState s1 s2)))
        c)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PipeState
  (Tuple' (PipeState s1 s2) (PipeState s1 s2))
  (Tuple' (PipeState s1 s2) (PipeState s1 s2))
-&gt; Step
     (PipeState
        (Tuple' (PipeState s1 s2) (PipeState s1 s2))
        (Tuple' (PipeState s1 s2) (PipeState s1 s2)))
     c
forall s a. s -&gt; Step s a
</span><a href="Streamly.Internal.Data.Pipe.Types.html#Continue"><span class="hs-identifier hs-var">Continue</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Tuple' (PipeState s1 s2) (PipeState s1 s2)
-&gt; PipeState
     (Tuple' (PipeState s1 s2) (PipeState s1 s2))
     (Tuple' (PipeState s1 s2) (PipeState s1 s2))
forall s1 s2. s1 -&gt; PipeState s1 s2
</span><a href="Streamly.Internal.Data.Pipe.Types.html#Consume"><span class="hs-identifier hs-var">Consume</span></a></span><span> </span><span class="annot"><span class="annottext">(Tuple' (PipeState s1 s2) (PipeState s1 s2)
 -&gt; PipeState
      (Tuple' (PipeState s1 s2) (PipeState s1 s2))
      (Tuple' (PipeState s1 s2) (PipeState s1 s2)))
-&gt; Tuple' (PipeState s1 s2) (PipeState s1 s2)
-&gt; PipeState
     (Tuple' (PipeState s1 s2) (PipeState s1 s2))
     (Tuple' (PipeState s1 s2) (PipeState s1 s2))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PipeState s1 s2
-&gt; PipeState s1 s2 -&gt; Tuple' (PipeState s1 s2) (PipeState s1 s2)
forall a b. a -&gt; b -&gt; Tuple' a b
</span><a href="Streamly.Internal.Data.Tuple.Strict.html#Tuple%27"><span class="hs-identifier hs-var">Tuple'</span></a></span><span> </span><span class="annot"><span class="annottext">PipeState s1 s2
</span><a href="#local-6989586621679364121"><span class="hs-identifier hs-var">sL</span></a></span><span> </span><span class="annot"><span class="annottext">PipeState s1 s2
</span><a href="#local-6989586621679364095"><span class="hs-identifier hs-var">s1</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-424"></span><span>                            </span><span class="annot"><a href="Streamly.Internal.Data.Pipe.Types.html#Continue"><span class="hs-identifier hs-type">Continue</span></a></span><span> </span><span id="local-6989586621679364094"><span class="annot"><span class="annottext">s1 :: PipeState s1 s2
</span><a href="#local-6989586621679364094"><span class="hs-identifier hs-var">s1</span></a></span></span><span class="hs-glyph">@</span><span class="hs-special">(</span><span class="annot"><a href="Streamly.Internal.Data.Pipe.Types.html#Produce"><span class="hs-identifier hs-type">Produce</span></a></span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><span id="line-425"></span><span>                                </span><span class="annot"><span class="annottext">Step
  (PipeState
     (Tuple' (PipeState s1 s2) (PipeState s1 s2))
     (Tuple' (PipeState s1 s2) (PipeState s1 s2)))
  c
-&gt; m (Step
        (PipeState
           (Tuple' (PipeState s1 s2) (PipeState s1 s2))
           (Tuple' (PipeState s1 s2) (PipeState s1 s2)))
        c)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Step
   (PipeState
      (Tuple' (PipeState s1 s2) (PipeState s1 s2))
      (Tuple' (PipeState s1 s2) (PipeState s1 s2)))
   c
 -&gt; m (Step
         (PipeState
            (Tuple' (PipeState s1 s2) (PipeState s1 s2))
            (Tuple' (PipeState s1 s2) (PipeState s1 s2)))
         c))
-&gt; Step
     (PipeState
        (Tuple' (PipeState s1 s2) (PipeState s1 s2))
        (Tuple' (PipeState s1 s2) (PipeState s1 s2)))
     c
-&gt; m (Step
        (PipeState
           (Tuple' (PipeState s1 s2) (PipeState s1 s2))
           (Tuple' (PipeState s1 s2) (PipeState s1 s2)))
        c)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PipeState
  (Tuple' (PipeState s1 s2) (PipeState s1 s2))
  (Tuple' (PipeState s1 s2) (PipeState s1 s2))
-&gt; Step
     (PipeState
        (Tuple' (PipeState s1 s2) (PipeState s1 s2))
        (Tuple' (PipeState s1 s2) (PipeState s1 s2)))
     c
forall s a. s -&gt; Step s a
</span><a href="Streamly.Internal.Data.Pipe.Types.html#Continue"><span class="hs-identifier hs-var">Continue</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Tuple' (PipeState s1 s2) (PipeState s1 s2)
-&gt; PipeState
     (Tuple' (PipeState s1 s2) (PipeState s1 s2))
     (Tuple' (PipeState s1 s2) (PipeState s1 s2))
forall s1 s2. s2 -&gt; PipeState s1 s2
</span><a href="Streamly.Internal.Data.Pipe.Types.html#Produce"><span class="hs-identifier hs-var">Produce</span></a></span><span> </span><span class="annot"><span class="annottext">(Tuple' (PipeState s1 s2) (PipeState s1 s2)
 -&gt; PipeState
      (Tuple' (PipeState s1 s2) (PipeState s1 s2))
      (Tuple' (PipeState s1 s2) (PipeState s1 s2)))
-&gt; Tuple' (PipeState s1 s2) (PipeState s1 s2)
-&gt; PipeState
     (Tuple' (PipeState s1 s2) (PipeState s1 s2))
     (Tuple' (PipeState s1 s2) (PipeState s1 s2))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PipeState s1 s2
-&gt; PipeState s1 s2 -&gt; Tuple' (PipeState s1 s2) (PipeState s1 s2)
forall a b. a -&gt; b -&gt; Tuple' a b
</span><a href="Streamly.Internal.Data.Tuple.Strict.html#Tuple%27"><span class="hs-identifier hs-var">Tuple'</span></a></span><span> </span><span class="annot"><span class="annottext">PipeState s1 s2
</span><a href="#local-6989586621679364121"><span class="hs-identifier hs-var">sL</span></a></span><span> </span><span class="annot"><span class="annottext">PipeState s1 s2
</span><a href="#local-6989586621679364094"><span class="hs-identifier hs-var">s1</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-426"></span><span>                    </span><span class="annot"><a href="Streamly.Internal.Data.Pipe.Types.html#Consume"><span class="hs-identifier hs-type">Consume</span></a></span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><span class="annottext">Step
  (PipeState
     (Tuple' (PipeState s1 s2) (PipeState s1 s2))
     (Tuple' (PipeState s1 s2) (PipeState s1 s2)))
  c
-&gt; m (Step
        (PipeState
           (Tuple' (PipeState s1 s2) (PipeState s1 s2))
           (Tuple' (PipeState s1 s2) (PipeState s1 s2)))
        c)
forall (m :: * -&gt; *) a. Monad m =&gt; a -&gt; m a
</span><span class="hs-identifier hs-var">return</span></span><span> </span><span class="annot"><span class="annottext">(Step
   (PipeState
      (Tuple' (PipeState s1 s2) (PipeState s1 s2))
      (Tuple' (PipeState s1 s2) (PipeState s1 s2)))
   c
 -&gt; m (Step
         (PipeState
            (Tuple' (PipeState s1 s2) (PipeState s1 s2))
            (Tuple' (PipeState s1 s2) (PipeState s1 s2)))
         c))
-&gt; Step
     (PipeState
        (Tuple' (PipeState s1 s2) (PipeState s1 s2))
        (Tuple' (PipeState s1 s2) (PipeState s1 s2)))
     c
-&gt; m (Step
        (PipeState
           (Tuple' (PipeState s1 s2) (PipeState s1 s2))
           (Tuple' (PipeState s1 s2) (PipeState s1 s2)))
        c)
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PipeState
  (Tuple' (PipeState s1 s2) (PipeState s1 s2))
  (Tuple' (PipeState s1 s2) (PipeState s1 s2))
-&gt; Step
     (PipeState
        (Tuple' (PipeState s1 s2) (PipeState s1 s2))
        (Tuple' (PipeState s1 s2) (PipeState s1 s2)))
     c
forall s a. s -&gt; Step s a
</span><a href="Streamly.Internal.Data.Pipe.Types.html#Continue"><span class="hs-identifier hs-var">Continue</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><span class="annottext">Tuple' (PipeState s1 s2) (PipeState s1 s2)
-&gt; PipeState
     (Tuple' (PipeState s1 s2) (PipeState s1 s2))
     (Tuple' (PipeState s1 s2) (PipeState s1 s2))
forall s1 s2. s1 -&gt; PipeState s1 s2
</span><a href="Streamly.Internal.Data.Pipe.Types.html#Consume"><span class="hs-identifier hs-var">Consume</span></a></span><span> </span><span class="annot"><span class="annottext">(Tuple' (PipeState s1 s2) (PipeState s1 s2)
 -&gt; PipeState
      (Tuple' (PipeState s1 s2) (PipeState s1 s2))
      (Tuple' (PipeState s1 s2) (PipeState s1 s2)))
-&gt; Tuple' (PipeState s1 s2) (PipeState s1 s2)
-&gt; PipeState
     (Tuple' (PipeState s1 s2) (PipeState s1 s2))
     (Tuple' (PipeState s1 s2) (PipeState s1 s2))
forall a b. (a -&gt; b) -&gt; a -&gt; b
</span><span class="hs-operator hs-var">$</span></span><span> </span><span class="annot"><span class="annottext">PipeState s1 s2
-&gt; PipeState s1 s2 -&gt; Tuple' (PipeState s1 s2) (PipeState s1 s2)
forall a b. a -&gt; b -&gt; Tuple' a b
</span><a href="Streamly.Internal.Data.Tuple.Strict.html#Tuple%27"><span class="hs-identifier hs-var">Tuple'</span></a></span><span> </span><span class="annot"><span class="annottext">PipeState s1 s2
</span><a href="#local-6989586621679364121"><span class="hs-identifier hs-var">sL</span></a></span><span> </span><span class="annot"><span class="annottext">PipeState s1 s2
</span><a href="#local-6989586621679364120"><span class="hs-identifier hs-var">sR</span></a></span><span class="hs-special">)</span><span>
</span><span id="line-427"></span><span>
</span><span id="line-428"></span><span id="local-6989586621679364093"><span class="hs-keyword">instance</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621679364093"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Category</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Streamly.Internal.Data.Pipe.Types.html#Pipe"><span class="hs-identifier hs-type">Pipe</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679364093"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-429"></span><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><span class="hs-pragma hs-type">id</span></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-430"></span><span>    </span><span id="local-6989586621679364089"><span class="annot"><span class="annottext">id :: Pipe m a a
</span><a href="#local-6989586621679364089"><span class="hs-identifier hs-var hs-var hs-var hs-var">id</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(a -&gt; a) -&gt; Pipe m a a
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; b) -&gt; Pipe m a b
</span><a href="Streamly.Internal.Data.Pipe.Types.html#map"><span class="hs-identifier hs-var">map</span></a></span><span> </span><span class="annot"><span class="annottext">a -&gt; a
forall a. a -&gt; a
</span><span class="hs-identifier hs-var">Prelude.id</span></span><span>
</span><span id="line-431"></span><span>
</span><span id="line-432"></span><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">(</span><span class="hs-pragma">.</span><span class="hs-pragma">)</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-433"></span><span>    </span><span id="local-6989586621679364087"><span class="annot"><span class="annottext">. :: Pipe m b c -&gt; Pipe m a b -&gt; Pipe m a c
</span><a href="#local-6989586621679364087"><span class="hs-operator hs-var hs-var hs-var hs-var">(.)</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Pipe m b c -&gt; Pipe m a b -&gt; Pipe m a c
forall (m :: * -&gt; *) b c a.
Monad m =&gt;
Pipe m b c -&gt; Pipe m a b -&gt; Pipe m a c
</span><a href="Streamly.Internal.Data.Pipe.Types.html#compose"><span class="hs-identifier hs-var">compose</span></a></span></span><span>
</span><span id="line-434"></span><span>
</span><span id="line-435"></span><span id="local-6989586621679364397"><span id="local-6989586621679364398"><span id="local-6989586621679364399"><span id="local-6989586621679364400"><span id="local-6989586621679364401"><span class="annot"><a href="Streamly.Internal.Data.Pipe.Types.html#unzip"><span class="hs-identifier hs-type">unzip</span></a></span><span> </span><span class="hs-glyph">::</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Pipe.Types.html#Pipe"><span class="hs-identifier hs-type">Pipe</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679364401"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679364400"><span class="hs-identifier hs-type">a</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679364399"><span class="hs-identifier hs-type">x</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Pipe.Types.html#Pipe"><span class="hs-identifier hs-type">Pipe</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679364401"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679364398"><span class="hs-identifier hs-type">b</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679364397"><span class="hs-identifier hs-type">y</span></a></span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="annot"><a href="Streamly.Internal.Data.Pipe.Types.html#Pipe"><span class="hs-identifier hs-type">Pipe</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679364401"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679364400"><span class="hs-identifier hs-type">a</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679364398"><span class="hs-identifier hs-type">b</span></a></span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="annot"><a href="#local-6989586621679364399"><span class="hs-identifier hs-type">x</span></a></span><span class="hs-special">,</span><span> </span><span class="annot"><a href="#local-6989586621679364397"><span class="hs-identifier hs-type">y</span></a></span><span class="hs-special">)</span></span></span></span></span></span><span>
</span><span id="line-436"></span><span id="unzip"><span class="annot"><span class="annottext">unzip :: Pipe m a x -&gt; Pipe m b y -&gt; Pipe m (a, b) (x, y)
</span><a href="Streamly.Internal.Data.Pipe.Types.html#unzip"><span class="hs-identifier hs-var hs-var">unzip</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Pipe m a x -&gt; Pipe m b y -&gt; Pipe m (a, b) (x, y)
forall a. HasCallStack =&gt; a
</span><span class="hs-identifier hs-var">undefined</span></span><span>
</span><span id="line-437"></span><span>
</span><span id="line-438"></span><span id="local-6989586621679364085"><span class="hs-keyword">instance</span><span> </span><span id="local-6989586621679364079"><span id="local-6989586621679364081"><span class="annot"><span class="hs-identifier hs-type">Monad</span></span><span> </span><span class="annot"><a href="#local-6989586621679364085"><span class="hs-identifier hs-type">m</span></a></span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="annot"><span class="hs-identifier hs-type">Arrow</span></span><span> </span><span class="hs-special">(</span><span class="annot"><a href="Streamly.Internal.Data.Pipe.Types.html#Pipe"><span class="hs-identifier hs-type">Pipe</span></a></span><span> </span><span class="annot"><a href="#local-6989586621679364085"><span class="hs-identifier hs-type">m</span></a></span><span class="hs-special">)</span></span></span><span> </span><span class="hs-keyword">where</span><span>
</span><span id="line-439"></span><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="annot"><span class="hs-pragma hs-type">arr</span></span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-440"></span><span>    </span><span id="local-6989586621679364075"><span class="annot"><span class="annottext">arr :: (b -&gt; c) -&gt; Pipe m b c
</span><span class="hs-identifier hs-var hs-var hs-var hs-var">arr</span></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(b -&gt; c) -&gt; Pipe m b c
forall (m :: * -&gt; *) a b. Monad m =&gt; (a -&gt; b) -&gt; Pipe m a b
</span><a href="Streamly.Internal.Data.Pipe.Types.html#map"><span class="hs-identifier hs-var">map</span></a></span><span>
</span><span id="line-441"></span><span>
</span><span id="line-442"></span><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">(</span><span class="hs-pragma">***</span><span class="hs-pragma">)</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-443"></span><span>    </span><span id="local-6989586621679364073"><span class="annot"><span class="annottext">*** :: Pipe m b c -&gt; Pipe m b' c' -&gt; Pipe m (b, b') (c, c')
</span><a href="#local-6989586621679364073"><span class="hs-operator hs-var hs-var hs-var hs-var">(***)</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">Pipe m b c -&gt; Pipe m b' c' -&gt; Pipe m (b, b') (c, c')
forall (m :: * -&gt; *) a x b y.
Pipe m a x -&gt; Pipe m b y -&gt; Pipe m (a, b) (x, y)
</span><a href="Streamly.Internal.Data.Pipe.Types.html#unzip"><span class="hs-identifier hs-var">unzip</span></a></span><span>
</span><span id="line-444"></span><span>
</span><span id="line-445"></span><span>    </span><span class="hs-pragma">{-# INLINE</span><span> </span><span class="hs-pragma">(</span><span class="hs-pragma">&amp;&amp;&amp;</span><span class="hs-pragma">)</span><span> </span><span class="hs-pragma">#-}</span><span>
</span><span id="line-446"></span><span>    </span><span id="local-6989586621679364071"><span class="annot"><span class="annottext">&amp;&amp;&amp; :: Pipe m b c -&gt; Pipe m b c' -&gt; Pipe m b (c, c')
</span><a href="#local-6989586621679364071"><span class="hs-operator hs-var hs-var hs-var hs-var">(&amp;&amp;&amp;)</span></a></span></span><span> </span><span class="hs-glyph">=</span><span> </span><span class="annot"><span class="annottext">(c -&gt; c' -&gt; (c, c'))
-&gt; Pipe m b c -&gt; Pipe m b c' -&gt; Pipe m b (c, c')
forall (m :: * -&gt; *) a b c i.
Monad m =&gt;
(a -&gt; b -&gt; c) -&gt; Pipe m i a -&gt; Pipe m i b -&gt; Pipe m i c
</span><a href="Streamly.Internal.Data.Pipe.Types.html#zipWith"><span class="hs-identifier hs-var">zipWith</span></a></span><span> </span><span class="hs-special">(</span><span class="hs-special">,</span><span class="hs-special">)</span></span><span>
</span><span id="line-447"></span></pre></body></html>